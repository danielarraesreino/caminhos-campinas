This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: **/*.json, **/node_modules/**, **/.git/**, **/dist/**, **/.next/**
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.husky/
  pre-commit
public/
  avatars/
    avatar_1.png
    avatar_2.png
  file.svg
  globe.svg
  next.svg
  sw.js
  vercel.svg
  window.svg
scripts/
  verify-structure.js
src/
  app/
    api/
      auth/
        [...nextauth]/
          route.ts
      chat/
        route.ts
      groq/
        route.ts
      metrics/
        route.ts
    apoie/
      page.tsx
    impacto/
      page.tsx
    jogar/
      page.tsx
    recursos/
      page.tsx
    sobre/
      page.tsx
    test-features/
      page.tsx
    favicon.ico
    globals.css
    layout.tsx
    page.tsx
  components/
    ui/
      button.tsx
      card.tsx
      dialog.tsx
      EcoButton.tsx
      EcoCard.tsx
      input.tsx
      Navbar.tsx
      progress.tsx
    Providers.tsx
  contexts/
    GameContext.tsx
    ServicesContext.tsx
  features/
    dashboard/
      ImpactDashboard.tsx
      MaslowComparison.tsx
      ODSExplainer.tsx
    game-loop/
      dilemmas.ts
      eventEngine.ts
      gameOverConditions.ts
      index.ts
      useGameLoop.ts
    offline-db/
      db.ts
      index.ts
      useOfflineDB.ts
    survival-map/
      index.ts
      MapCore.tsx
      NearbyList.tsx
      SurvivalMap.tsx
    ui/
      AvatarCreation.tsx
      DilemmaModal.tsx
      GameChat.tsx
      GameHUD.tsx
      GameOverModal.tsx
      index.ts
      LandingPage.tsx
      SurvivalModeContext.tsx
      SurvivalToggle.tsx
  hooks/
    useEventEngine.ts
    useODSMetrics.ts
    useSurvivalLogic.ts
    useTelemetry.ts
  lib/
    utils.ts
  services/
    telemetry.ts
  utils/
    anonymization.ts
    apiMetrics.ts
    dilemmaCache.ts
    generateMockMetrics.ts
  auth.ts
.aiexclude
.cursorrules
.env.example
.gitignore
A RUA TEM VOZ- projeto.docx.md
Architecture_Map.md
Avalia√ß√£o e Melhorias de Projeto de Jogo.md
Core_Mechanics.md
eslint.config.mjs
jogo.code-workspace
Narrative_DB.md
next.config.ts
postcss.config.mjs
projeto teorico.md
README.md
REDE_APOIO_CAMPINAS.md
SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md
Tech_Stack.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/features/game-loop/gameOverConditions.ts">
"use client";

import type { GameState } from "@/contexts/GameContext";

export interface GameOverResult {
isGameOver: boolean;
reason: string;
narrative: string;
statistics?: {
umber;
eyEarned: number;
ityFinal: number;
al: number;
};
}

export function checkGameOver(state: GameState): GameOverResult {
const playerName = state.avatar?.name || "Voc√™";

if (state.dignity <= 0) {
 {
: "DESIST√äNCIA",
arrative: `${playerName} n√£o aguenta mais.

A invisibilidade doeu mais que a fome. Cada humilha√ß√£o retirou um peda√ßo da sua humanidade.

Voc√™ decide parar de lutar.

**Fim de jogo.** ${state.day} dias sobrevividos.

*"A morte social precede a morte f√≠sica."* - Castel, 1998`,
state.day,
eyEarned: state.money,
ityFinal: state.dignity,
al: state.socialStigma,
0) {
 {
: "√ìBITO",
arrative: `${playerName} n√£o resistiu.

Estat√≠stica do IBGE. Sem nome no jornal, sem t√∫mulo, sem not√≠cia.

**${state.day} dias nas ruas de Campinas.**

*"A expectativa de vida da popula√ß√£o de rua √© de 45 anos."* - IPEA, 2020`,
state.day,
eyEarned: state.money,
ityFinal: state.dignity,
al: state.socialStigma,
 {
: "",
arrative: "",
};
}
</file>

<file path="src/features/ui/GameOverModal.tsx">
\"use client\";

import { AlertCircle, Heart, TrendingDown, X } from \"lucide-react\";
import { Button } from \"@/components/ui/button\";
import type { GameOverResult } from \"@/features/game-loop/gameOverConditions\";

interface GameOverModalProps {
    \tgameOverResult: GameOverResult;
    \tonRestart: () => void;
}

export function GameOverModal({ gameOverResult, onRestart }: GameOverModalProps) {
    \tconst { reason, narrative, statistics } = gameOverResult;

    \t// Determina cor e √≠cone baseado no motivo
    \tconst getReasonColor = () => {
        \t\tswitch(reason) {
            \t\t\tcase \"DESIST√äNCIA\":
            \t\t\t\treturn \"bg-purple-900/90\";
            \t\t\tcase \"√ìBITO\":
            \t\t\t\treturn \"bg-red-900/90\";
            \t\t\tcase \"HIPOTERMIA\":
            \t\t\t\treturn \"bg-blue-900/90\";
            \t\t\tcase \"DESNUTRI√á√ÉO\":
            \t\t\t\treturn \"bg-orange-900/90\";
            \t\t\tdefault:
            \t\t\t\treturn \"bg-gray-900/90\";
            \t\t
        }
        \t
    };

    \tconst getReasonIcon = () => {
        \t\tswitch(reason) {
            \t\t\tcase \"DESIST√äNCIA\":
            \t\t\t\treturn < TrendingDown className =\"h-12 w-12\" />;
            \t\t\tcase \"√ìBITO\":
            \t\t\t\treturn < X className =\"h-12 w-12\" />;
            \t\t\tcase \"HIPOTERMIA\":
            \t\t\t\treturn < AlertCircle className =\"h-12 w-12\" />;
            \t\t\tcase \"DESNUTRI√á√ÉO\":
            \t\t\t\treturn < Heart className =\"h-12 w-12\" />;
            \t\t\tdefault:
            \t\t\t\treturn < AlertCircle className =\"h-12 w-12\" />;
            \t\t
        }
        \t
    };

    \treturn(
        \t\t < div className =\"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/95 backdrop-blur-md animate-fade-in\">
        \t\t\t < div className =\"w-full max-w-2xl bg-gradient-to-b from-gray-900 to-black border-2 border-red-800 rounded-3xl overflow-hidden shadow-2xl shadow-red-900/50\">
        \t\t\t\t{/* Header com motivo */ }
        \t\t\t\t < div className = {`${getReasonColor()} p-8 text-center border-b-4 border-red-700`}>
\t\t\t\t\t < div className =\"flex justify-center mb-4 text-red-200\">
\t\t\t\t\t\t{ getReasonIcon() }
\t\t\t\t\t</div >
\t\t\t\t\t < h2 className =\"text-4xl font-black text-white mb-2 uppercase tracking-wider\">
\t\t\t\t\t\tFim de Jogo
\t\t\t\t\t</h2 >
\t\t\t\t\t < p className =\"text-2xl font-bold text-red-300 uppercase tracking-widest\">
\t\t\t\t\t\t{ reason }
\t\t\t\t\t</p >
\t\t\t\t</div >

\t\t\t\t{/* Narrativa */ }
\t\t\t\t < div className =\"p-8 space-y-6\">
\t\t\t\t\t < div className =\"prose prose-invert max-w-none\">
\t\t\t\t\t\t{
    narrative.split(\"\\n\\n\").map((paragraph, idx) => {
        \t\t\t\t\t\t\t// Detecta cita√ß√µes (linhas que come√ßam com *)
        \t\t\t\t\t\t\tif(paragraph.trim().startsWith(\"*\")) {
            \t\t\t\t\t\t\t\treturn(
                \t\t\t\t\t\t\t\t\t < blockquote
                \t\t\t\t\t\t\t\t\t\tkey = { idx }
                \t\t\t\t\t\t\t\t\t\tclassName =\"border-l-4 border-blue-500 pl-4 italic text-blue-300 text-sm mt-4\"
                \t\t\t\t\t\t\t\t\t >
                \t\t\t\t\t\t\t\t\t\t{
                    paragraph.replace(/^\\*|\\*$/g, \"\")}
                        \t\t\t\t\t\t\t\t\t</blockquote >
                        \t\t\t\t\t\t\t\t);
                \t\t\t\t\t\t\t
            }

                \t\t\t\t\t\t\t// Detecta texto em negrito (linhas com **)
                \t\t\t\t\t\t\tconst boldRegex = /\\*\\*(.*?)\\*\\*/g;
    \t\t\t\t\t\t\tconst parts = paragraph.split(boldRegex);

    \t\t\t\t\t\t\treturn(
        \t\t\t\t\t\t\t\t < p
        \t\t\t\t\t\t\t\t\tkey = { idx }
        \t\t\t\t\t\t\t\t\tclassName =\"text-gray-200 leading-relaxed whitespace-pre-line\"
        \t\t\t\t\t\t\t\t >
        \t\t\t\t\t\t\t\t\t{
            parts.map((part, partIdx) =>
                \t\t\t\t\t\t\t\t\t\tpartIdx % 2 === 1 ? (
                \t\t\t\t\t\t\t\t\t\t\t < strong key = { partIdx } className =\"text-white font-bold\">
                \t\t\t\t\t\t\t\t\t\t\t\t{ part }
                \t\t\t\t\t\t\t\t\t\t\t</strong >
                \t\t\t\t\t\t\t\t\t\t) : (
                    \t\t\t\t\t\t\t\t\t\t\tpart
                    \t\t\t\t\t\t\t\t\t\t),
        \t\t\t\t\t\t\t\t\t)
}
\t\t\t\t\t\t\t\t</p >
\t\t\t\t\t\t\t);
\t\t\t\t\t\t})}
\t\t\t\t\t</div >

\t\t\t\t\t{/* Estat√≠sticas */ }
\t\t\t\t\t{
    statistics && (
    \t\t\t\t\t\t < div className =\"grid grid-cols-2 sm:grid-cols-4 gap-4 mt-8 p-6 bg-gray-800/50 rounded-xl border border-gray-700\">
    \t\t\t\t\t\t\t < div className =\"text-center\">
    \t\t\t\t\t\t\t\t < p className =\"text-sm text-gray-400 uppercase tracking-wider mb-1\">
    \t\t\t\t\t\t\t\t\tDias
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t\t < p className =\"text-3xl font-black text-white\">{statistics.daysSurvived}</p>
    \t\t\t\t\t\t\t</div >
    \t\t\t\t\t\t\t < div className =\"text-center\">
    \t\t\t\t\t\t\t\t < p className =\"text-sm text-gray-400 uppercase tracking-wider mb-1\">
    \t\t\t\t\t\t\t\t\tDinheiro
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t\t < p className =\"text-3xl font-black text-green-400\">
    \t\t\t\t\t\t\t\t\tR$ { statistics.moneyEarned }
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t</div >
    \t\t\t\t\t\t\t < div className =\"text-center\">
    \t\t\t\t\t\t\t\t < p className =\"text-sm text-gray-400 uppercase tracking-wider mb-1\">
    \t\t\t\t\t\t\t\t\tDignidade
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t\t < p className =\"text-3xl font-black text-purple-400\">
    \t\t\t\t\t\t\t\t\t{ statistics.dignityFinal }
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t</div >
    \t\t\t\t\t\t\t < div className =\"text-center\">
    \t\t\t\t\t\t\t\t < p className =\"text-sm text-gray-400 uppercase tracking-wider mb-1\">
    \t\t\t\t\t\t\t\t\tEstigma
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t\t < p className =\"text-3xl font-black text-red-400\">
    \t\t\t\t\t\t\t\t\t{ statistics.stigmaFinal }
    \t\t\t\t\t\t\t\t</p >
    \t\t\t\t\t\t\t</div >
    \t\t\t\t\t\t</div >
    \t\t\t\t\t)
}

\t\t\t\t\t{/* Bot√£o de reiniciar */ }
\t\t\t\t\t < div className =\"flex flex-col gap-3 mt-8\">
\t\t\t\t\t\t < Button
\t\t\t\t\t\t\tonClick = { onRestart }
\t\t\t\t\t\t\tclassName =\"w-full bg-blue-600 hover:bg-blue-700 text-white py-6 text-lg font-black uppercase tracking-wider rounded-xl shadow-lg shadow-blue-900/50 transition-all\"
\t\t\t\t\t\t >
\t\t\t\t\t\t\tüîÑ Tentar Novamente
\t\t\t\t\t\t</Button >
\t\t\t\t\t\t < p className =\"text-xs text-center text-gray-500 italic\">
\t\t\t\t\t\t\t\"A cada jogo, uma nova hist√≥ria. A cada hist√≥ria, uma reflex√£o.\"
\t\t\t\t\t\t</p >
\t\t\t\t\t</div >
\t\t\t\t</div >
\t\t\t</div >
\t\t</div >
\t);
}
</file>

<file path="Avalia√ß√£o e Melhorias de Projeto de Jogo.md">
# **Impacto e Viabilidade Sociot√©cnica de Jogos S√©rios para Popula√ß√£o em Situa√ß√£o de Rua: Uma An√°lise em Profundidade**

## **1\. Introdu√ß√£o: A Converg√™ncia entre Tecnologia C√≠vica e Realidade Social**

A presente an√°lise t√©cnica e sociol√≥gica debru√ßa-se sobre as propostas para o desenvolvimento de um *serious game* (jogo s√©rio) voltado √† popula√ß√£o em situa√ß√£o de rua na cidade de Campinas, S√£o Paulo. O projeto, intitulado em uma das propostas como "Arquitetura da Invisibilidade", busca operar em duas frentes distintas, por√©m complementares: como uma ferramenta de sensibiliza√ß√£o ("m√°quina de empatia") para a sociedade civil e como um utilit√°rio de sobreviv√™ncia ("b√∫ssola de servi√ßos") para a popula√ß√£o vulner√°vel. A avalia√ß√£o a seguir disseca a viabilidade das escolhas tecnol√≥gicas ‚Äî especificamente o uso de desenvolvimento ag√™ntico via Google Antigravity e modelos de IA como Gemini 3 ‚Äî em contraste com a infraestrutura material dispon√≠vel para os usu√°rios finais. Al√©m disso, prop√µe-se um roteiro detalhado para a integra√ß√£o de m√©tricas alinhadas aos Objetivos de Desenvolvimento Sustent√°vel (ODS) da Agenda 2030, transformando a intera√ß√£o l√∫dica em dados audit√°veis para pol√≠ticas p√∫blicas.

O contexto urbano de Campinas serve como um laborat√≥rio cr√≠tico para esta interven√ß√£o. Com uma popula√ß√£o de rua estimada em crescimento, identificada pelo Censo de 2024 em cerca de 1.300 indiv√≠duos 1, a cidade apresenta uma rede de servi√ßos assistenciais que, embora robusta, enfrenta desafios de acessibilidade informacional. A premissa de utilizar jogos s√©rios, historicamente eficazes em simula√ß√µes de gest√£o de escassez como *Spent* ou *Hobson‚Äôs Choice* 3, √© aqui expandida para incluir uma funcionalidade operacional in√©dita. No entanto, a tens√£o entre o "estado da arte" do c√≥digo proposto e a "tecnologia do poss√≠vel" nas ruas exige uma revis√£o arquitetural profunda.

## **2\. Fundamentos Te√≥ricos e Contextualiza√ß√£o Sociot√©cnica**

### **2.1. O Paradigma dos Jogos S√©rios e a Engenharia da Empatia**

Os jogos s√©rios transcendem o entretenimento puro, posicionando-se como ferramentas pedag√≥gicas e de engenharia social. No contexto da assist√™ncia social, a mec√¢nica central destes jogos reside frequentemente na simula√ß√£o da impot√™ncia. T√≠tulos como *Spent* funcionam colocando o jogador diante de escolhas imposs√≠veis (ex: "Pagar o aluguel ou o conserto do carro para ir trabalhar?"), desmantelando a fal√°cia meritocr√°tica de que a pobreza √© fruto de m√° gest√£o pessoal.3

A proposta "Arquitetura da Invisibilidade" avan√ßa este paradigma ao introduzir a "viv√™ncia do desenvolvedor" como um ativo de legitimidade. A convers√£o da "mem√≥ria da rua" em algoritmos n√£o apenas enriquece a narrativa com verossimilhan√ßa crua, mas tamb√©m atua como um mecanismo de den√∫ncia contra a aporofobia (avers√£o aos pobres) e a arquitetura hostil da cidade.3 Contudo, para que essa empatia computacional se traduza em impacto real, o software deve romper a barreira da tela e oferecer utilidade tang√≠vel.

A dualidade do p√∫blico-alvo ‚Äî doadores em busca de conex√£o emocional e usu√°rios em busca de recursos vitais ‚Äî imp√µe um desafio de design de interface (UI) e experi√™ncia do usu√°rio (UX) significativo. O c√≥digo deve, portanto, gerenciar dois estados de opera√ß√£o distintos: o **Modo Narrativo**, rico em m√≠dia e interatividade para dispositivos modernos, e o **Modo Utilit√°rio**, austero e eficiente para dispositivos legados.

### **2.2. A Realidade Material de Campinas: Mapeamento da Exclus√£o**

A efic√°cia do projeto depende da precis√£o com que a infraestrutura de Campinas √© digitalizada. A cidade n√£o √© um cen√°rio gen√©rico; √© um ecossistema de "hubs" de sobreviv√™ncia com regras r√≠gidas.

* **Rede Governamental:** Os Centros POP (I e II) funcionam como n√≥s centrais para higiene e documenta√ß√£o. A diferencia√ß√£o geogr√°fica entre a unidade da Rua Regente Feij√≥ (Centro Pop I) e a da Rua Jos√© Paulino (Centro Pop II) √© cr√≠tica, pois determina o tempo de deslocamento e o acesso a servi√ßos espec√≠ficos como banho, que possuem janelas temporais estritas (ex: encerramento √†s 16h).3 O Albergue Municipal (Samim) opera com l√≥gicas de *check-in* que variam conforme a sazonalidade, estendendo hor√°rios durante a Opera√ß√£o Inverno.5  
* **Economia da Doa√ß√£o:** A rede de suporte informal, composta por ONGs como Toca de Assis e grupos religiosos, preenche as lacunas do estado. A localiza√ß√£o destes pontos e a volatilidade de seus hor√°rios de atendimento exigem que o banco de dados do jogo seja din√¢mico e, idealmente, alimentado pela comunidade.3

A transposi√ß√£o destes elementos para o c√≥digo n√£o pode ser procedimental (aleat√≥ria). Ela exige um *Level Design* documental, onde cada "miss√£o" no jogo corresponde a um desafio burocr√°tico ou log√≠stico real enfrentado na cidade.

### **2.3. O Paradoxo da Conectividade e o Hardware Dispon√≠vel**

Um erro comum em interven√ß√µes digitais para popula√ß√µes vulner√°veis √© a presun√ß√£o de acesso tecnol√≥gico uniforme. Embora pesquisas indiquem que uma parcela significativa da popula√ß√£o de rua possui smartphones (cerca de 58% a 70% em alguns estudos, com predomin√¢ncia absoluta de Android), estes dispositivos s√£o frequentemente modelos de entrada, antigos (Android 8/9/10), com baterias degradadas e telas danificadas.8

A conectividade √© igualmente prec√°ria. O acesso √† internet depende quase exclusivamente de pontos de Wi-Fi p√∫blicos ou compartilhados. Em Campinas, o programa "Campinas Digital" oferece pontos gratuitos em locais estrat√©gicos como o Largo do Ros√°rio e Terminais, mas imp√µe barreiras de autentica√ß√£o (cadastro de CPF) e limites de tempo (sess√µes de 40 minutos).10 O c√≥digo do aplicativo deve, portanto, ser resiliente a interrup√ß√µes abruptas de rede e capaz de realizar opera√ß√µes complexas (como tra√ßar rotas ou consultar guias) em modo totalmente *offline*.

## **3\. Avalia√ß√£o da Arquitetura T√©cnica Proposta**

A an√°lise da proposta "Arquitetura da Invisibilidade" revela uma ambi√ß√£o t√©cnica louv√°vel, mas perigosamente desalinhada com a realidade de hardware do p√∫blico-alvo. A sugest√£o de utilizar o *Google Antigravity IDE* e o modelo *Gemini 3* como espinha dorsal do projeto apresenta riscos estruturais que precisam ser mitigados.

### **3.1. O Risco do "Overengineering" com IA Generativa On-Device**

A proposta sugere a implementa√ß√£o do modelo **Gemini Nano** rodando localmente nos dispositivos (*on-device*) para garantir funcionalidades de IA *offline*.3 Esta escolha t√©cnica, embora na vanguarda da inova√ß√£o, √© invi√°vel para o contexto espec√≠fico.

An√°lise de Requisitos de Hardware do Gemini Nano:  
Documenta√ß√£o t√©cnica recente indica que o Gemini Nano √© otimizado para dispositivos de alta performance, exigindo chipsets com Unidades de Processamento Neural (NPUs) dedicadas, como o Google Tensor G3/G4 (s√©rie Pixel 8 e 9\) ou Snapdragon 8 Gen 3 (s√©rie Galaxy S24).12 Al√©m disso, a execu√ß√£o eficiente do modelo requer quantidades substanciais de mem√≥ria RAM ‚Äî frequentemente acima de 8GB, com aloca√ß√£o din√¢mica que pode consumir 2GB a 4GB apenas para o modelo.14  
Incompatibilidade com o P√∫blico-Alvo:  
Aplicar esta tecnologia em smartphones de entrada ou antigos (com 2GB ou 3GB de RAM e processadores sem NPU) resultar√° em:

1. **Impossibilidade de Execu√ß√£o:** O servi√ßo de sistema *Android AICore*, necess√°rio para orquestrar o Gemini Nano, n√£o √© distribu√≠do para vers√µes antigas do Android ou dispositivos de baixo custo.16  
2. **Degrada√ß√£o de Performance:** Se for√ßado (via *pollyfills* ou vers√µes n√£o otimizadas), o processamento causar√° travamento do sistema operacional e aquecimento excessivo.  
3. **Drenagem de Bateria:** O processamento de infer√™ncia de IA √© intensivo em energia. Em um contexto onde a carga da bateria √© um recurso cr√≠tico de sobreviv√™ncia, um aplicativo que consome 20% da bateria para responder a uma pergunta simples ser√° desinstalado imediatamente.18

**Conclus√£o da Avalia√ß√£o:** A depend√™ncia do Gemini Nano deve ser removida da arquitetura para a vers√£o do usu√°rio final (popula√ß√£o de rua). Ela pode ser mantida, opcionalmente, apenas para a vers√£o de "Empatia" destinada a doadores com hardware de ponta.

### **3.2. Desenvolvimento Ag√™ntico e a Manutenibilidade do C√≥digo**

O uso do *Google Antigravity IDE* ‚Äî um ambiente de desenvolvimento que integra agentes de IA aut√¥nomos para planejar, codificar e testar 20 ‚Äî oferece velocidade de produ√ß√£o, mas introduz riscos de "Caixa Preta".

* **C√≥digo N√£o Determin√≠stico:** Agentes de IA (como o *Coding Agent* do Antigravity) geram c√≥digo baseados em probabilidades. Isso pode introduzir bugs sutis ou l√≥gicas de navega√ß√£o que funcionam na maioria dos casos, mas falham em situa√ß√µes de borda cr√≠ticas (ex: transi√ß√£o de *online* para *offline* durante uma opera√ß√£o de banco de dados).  
* **Depend√™ncia de Plataforma:** O Antigravity √© uma ferramenta propriet√°ria (embora baseada no VS Code).21 Construir todo o fluxo de trabalho em torno de seus agentes espec√≠ficos pode criar um *vendor lock-in*, dificultando a migra√ß√£o do projeto para uma comunidade *open-source* no futuro, o que √© essencial para a sustentabilidade de projetos sociais.

### **3.3. Riscos de Alucina√ß√£o em Contextos Cr√≠ticos**

A proposta de um "Chatbot de Direitos" baseado em IA generativa (Gemini 3\) para orientar sobre leis e documentos carrega um risco √©tico e legal severo. Modelos de linguagem tendem a "alucinar" ‚Äî inventar fatos ou leis com alta confian√ßa ‚Äî quando n√£o possuem a informa√ß√£o exata no contexto.3  
Orientar um usu√°rio vulner√°vel a ir a um cart√≥rio inexistente ou citar uma lei revogada pode causar danos reais (perda de recursos financeiros e tempo). Portanto, a estrutura do c√≥digo n√£o pode confiar cegamente na sa√≠da gerada pela IA para informa√ß√µes factuais cr√≠ticas.

## **4\. Sugest√µes de Melhorias de Baixo Impacto Tecnol√≥gico e Refatora√ß√£o**

Para alinhar o projeto √† realidade das ruas e garantir sua fun√ß√£o social, sugere-se uma refatora√ß√£o da arquitetura focada na robustez, baixo consumo de recursos e tecnologias amplamente acess√≠veis.

### **4.1. Substitui√ß√£o da IA Generativa por L√≥gica Determin√≠stica Leve**

Em vez de processamento neural pesado no dispositivo, a intelig√™ncia do "Guia de Servi√ßos" e do "Chatbot" deve ser baseada em estruturas de dados leves e algoritmos determin√≠sticos.

* **√Årvores de Decis√£o (Decision Trees):** Implementar o fluxo de orienta√ß√£o jur√≠dica (ex: "Como tirar RG") como uma √°rvore de decis√£o est√°tica em formato JSON. O usu√°rio navega por op√ß√µes pr√©-definidas ("Tenho Certid√£o?" \-\> Sim/N√£o). Isso requer processamento √≠nfimo e garante 100% de precis√£o na informa√ß√£o, pois o conte√∫do √© curado por humanos e n√£o gerado por IA.24  
* **Busca Full-Text Local (FTS):** Para d√∫vidas gerais, utilizar a funcionalidade de busca textual (FTS) do banco de dados SQLite local. Isso permite encontrar "almo√ßo gr√°tis" ou "banho" instantaneamente sem necessidade de infer√™ncia sem√¢ntica pesada.26

### **4.2. Ado√ß√£o de Tecnologias Web Progressivas (PWA)**

Para maximizar o alcance, a interface utilit√°ria deve ser desenvolvida como um *Progressive Web App* (PWA).

* **Vantagens:** PWAs n√£o exigem download via loja de aplicativos (que requer conta Google ativa e espa√ßo livre), podem ser instalados diretamente do navegador e possuem capacidades *offline* robustas atrav√©s de *Service Workers*.27  
* **Cache Agressivo:** Configurar o *Service Worker* para armazenar todo o *shell* da aplica√ß√£o e o banco de dados de servi√ßos (via IndexedDB) no primeiro acesso. Isso garante que o app abra instantaneamente mesmo sem rede subsequente.29

### **4.3. Integra√ß√£o via USSD e SMS: A "Internet" dos Desconectados**

Para incluir a parcela da popula√ß√£o que possui apenas celulares b√°sicos (*feature phones*) sem internet, o sistema deve oferecer interfaces baseadas em telefonia GSM padr√£o.

* **Menu USSD Din√¢mico:** Implementar um servi√ßo USSD (ex: digitar \*123\#) que exibe um menu de texto simples: "1. Comida", "2. Abrigo", "3. Emerg√™ncia". O protocolo USSD funciona na banda de sinaliza√ß√£o de voz, n√£o consome plano de dados e √© compat√≠vel com praticamente qualquer celular fabricado nas √∫ltimas duas d√©cadas.30  
  * *Design do Menu:* O menu deve ser "unbundled" (desagregado), priorizando servi√ßos vitais no primeiro n√≠vel para reduzir o tempo de sess√£o e evitar *timeouts* da rede.32  
* **Gateways de SMS:** Utilizar gateways de SMS (como Twilio, Zenvia ou Infobip) para enviar alertas de broadcast (ex: "Alerta de Frio: Abrigo Extra na Igreja X aberto hoje"). O custo de SMS no Brasil varia (aprox. USD 0.05 a 0.06 por mensagem via API internacional, ou menos via brokers locais), mas o retorno em alcance √© inigual√°vel.34

### **4.4. Otimiza√ß√£o Extrema de Bateria e Interface**

O c√≥digo deve priorizar a efici√™ncia energ√©tica acima da est√©tica.

* **Modo "Super Economia":** Interface predominantemente preta (True Black \#000000) para telas AMOLED, desligando pixels e economizando bateria. Texto em alto contraste (Branco ou Amarelo) para legibilidade sob luz solar forte.37  
* **Gerenciamento de Processos:** O app n√£o deve ter processos em segundo plano (*background services*) que mantenham a CPU ativa (*wakelocks*) desnecessariamente. A sincroniza√ß√£o deve ser agendada via *WorkManager* do Android apenas quando o dispositivo estiver carregando ou detectar Wi-Fi est√°vel.18

## **5\. Estrat√©gia de Dados para os ODS (Objetivos de Desenvolvimento Sustent√°vel)**

A integra√ß√£o com os ODS √© o diferencial que transforma o aplicativo de uma ferramenta assistencialista para uma plataforma de intelig√™ncia urbana. A pergunta central √©: como medir impacto em um ambiente informal? A resposta reside na **telemetria de uso** como *proxy* para indicadores sociais.

O c√≥digo deve ser instrumentado para coletar eventos de intera√ß√£o (anonimizados) que correspondam diretamente a metas dos ODS. A tabela a seguir detalha essa correla√ß√£o, as fontes de dados e a metodologia de gera√ß√£o.

### **5.1. Mapeamento de Indicadores e Coleta de Dados**

| ODS e Meta | Indicador Oficial ONU | Indicador "Proxy" Digital (Gerado pelo App) | Fonte e M√©todo de Coleta |
| :---- | :---- | :---- | :---- |
| **ODS 1: Erradica√ß√£o da Pobreza** Meta 1.4: Acesso a servi√ßos b√°sicos e recursos. | **1.4.1:** Propor√ß√£o da popula√ß√£o com acesso a servi√ßos b√°sicos. | **Taxa de √äxito na Busca por Servi√ßos:** % de usu√°rios que buscaram um servi√ßo e clicaram em "Navegar" ou "Ligar". | **Gerado:** Log de eventos de UI (service\_click, navigation\_start). Se o usu√°rio clica, assume-se uma inten√ß√£o atendida preliminarmente. |
| **ODS 2: Fome Zero** Meta 2.1: Acesso a alimentos seguros. | Preval√™ncia de inseguran√ßa alimentar. | **Mapa de Calor de Demanda Alimentar:** Volume de buscas por "Comida/Jantar" vs. Oferta cadastrada na regi√£o/hor√°rio. | **Gerado:** Coordenadas GPS aproximadas das buscas por alimenta√ß√£o. Cruzamento com o banco de dados de locais abertos. Identifica "desertos alimentares" temporais. |
| **ODS 3: Sa√∫de e Bem-Estar** Meta 3.8: Cobertura de sa√∫de. | Cobertura de servi√ßos essenciais de sa√∫de. | **Conex√£o com Sa√∫de Prim√°ria:** N√∫mero de redirecionamentos para "Consult√≥rio na Rua" ou campanhas de vacina√ß√£o. | **Gerado:** Contagem de acessos √† categoria "Sa√∫de". **Obtido:** Integra√ß√£o com dados da Secretaria de Sa√∫de sobre a rota das vans do Consult√≥rio na Rua. |
| **ODS 10: Redu√ß√£o das Desigualdades** Meta 10.3: Igualdade de oportunidades. | Propor√ß√£o de pessoas que reportam discrimina√ß√£o/ass√©dio. | **√çndice de Acesso √† Cidadania:** N√∫mero de guias de documenta√ß√£o (RG, Certid√£o) completados ou acessados. | **Gerado:** Telemetria do tutorial "Quest da Burocracia". Cliques no link externo do Registro Civil.3 |
| **ODS 11: Cidades Sustent√°veis** Meta 11.1: Habita√ß√£o segura e adequada. | Propor√ß√£o de popula√ß√£o urbana vivendo em favelas/assentamentos. | **D√©ficit de Acolhimento Noturno:** Diferen√ßa entre buscas por "Abrigo" ap√≥s as 20h e n√∫mero de vagas dispon√≠veis. | **H√≠brido:** Dados gerados de busca vs. Dados obtidos (via *scraping* ou input manual) sobre a lota√ß√£o do Samim e abrigos parceiros. |

### **5.2. Fontes de Dados Externas e Integra√ß√£o (Onde e Como)**

Para que os indicadores acima tenham validade, o aplicativo precisa de uma base de dados "viva".

1. **Dados Oficiais e Portais de Transpar√™ncia:**  
   * **Fonte:** Portal de Dados Abertos de Campinas e Governo Federal (Cad√önico, Censo Pop Rua).1  
   * **Integra√ß√£o:** Scripts de *Web Scraping* ou consumo de APIs governamentais (onde dispon√≠veis, como a API de Dados do Portal da Transpar√™ncia) para atualizar a lista base de equipamentos p√∫blicos.41 Como muitas vezes esses dados s√£o est√°ticos (PDFs, tabelas), recomenda-se um *backend* administrativo onde volunt√°rios possam inserir dados extra√≠dos de editais e publica√ß√µes do Di√°rio Oficial.42  
2. **Crowdsourcing Comunit√°rio (A "Wazeza√ß√£o" da Assist√™ncia):**  
   * **Mecanismo:** Criar perfis de "Validadores" (assistentes sociais, l√≠deres de ONGs) que t√™m permiss√£o para atualizar o status de um servi√ßo em tempo real no app (ex: "Samim lotado", "Sopa da Pra√ßa X cancelada hoje").  
   * **Benef√≠cio:** Isso resolve o problema da falta de APIs em tempo real para servi√ßos informais, criando uma base de dados din√¢mica e confi√°vel.  
3. **Monitoramento Ambiental:**  
   * **Integra√ß√£o:** Conectar com APIs de previs√£o do tempo (OpenWeatherMap ou similares) para acionar automaticamente alertas de "Opera√ß√£o Inverno" quando a temperatura cair abaixo de um limiar (ex: 13¬∞C), orientando usu√°rios para abrigos de conting√™ncia.5

### **5.3. Privacidade e Prote√ß√£o de Dados (LGPD)**

A coleta de dados de popula√ß√µes vulner√°veis exige conformidade estrita com a LGPD.

* **Anonimiza√ß√£o na Fonte:** O aplicativo n√£o deve exigir login com dados reais (nome, CPF, telefone) para as fun√ß√µes b√°sicas. Identificadores √∫nicos devem ser *hashs* aleat√≥rios gerados no dispositivo, desvinculados da identidade civil.  
* **Consentimento Expl√≠cito e Simplificado:** Os termos de uso devem ser apresentados em linguagem simples e, preferencialmente, em formato de √°udio, explicando que os dados de uso ajudam a melhorar os servi√ßos da cidade, sem rastrear o indiv√≠duo.43  
* **Armazenamento Local:** Dados sens√≠veis (como fotos de documentos) devem permanecer estritamente no armazenamento local do dispositivo (*Sandboxed Storage*), nunca sendo enviados para a nuvem.

## **6\. Sustentabilidade, Governan√ßa e Impacto Econ√¥mico**

A viabilidade do projeto a longo prazo depende de um modelo econ√¥mico que transcenda o voluntarismo. A an√°lise da proposta de *crowdfunding* ("pagar um caf√©") revela potencial, mas tamb√©m limita√ß√µes de escala.

### **6.1. Monetiza√ß√£o de Dados ESG (B2B)**

Empresas e grandes corpora√ß√µes t√™m metas de ESG (*Environmental, Social, and Governance*) e ODS cada vez mais r√≠gidas. O projeto pode oferecer, como contrapartida a patroc√≠nios corporativos, relat√≥rios de impacto detalhados baseados nos dados coletados.

* **Produto de Dados:** Relat√≥rios trimestrais sobre "Manchas de Demanda Social em Campinas", mostrando onde a fome e a falta de abrigo s√£o mais cr√≠ticas. Isso √© valioso para direcionar a√ß√µes de responsabilidade social corporativa (ex: uma rede de supermercados patrocinar a distribui√ß√£o de alimentos em uma √°rea identificada como "deserto alimentar" pelo app).

### **6.2. Gamifica√ß√£o da Doa√ß√£o Recorrente**

Para a sociedade civil, a mec√¢nica de doa√ß√£o deve ser integrada ao ciclo de *feedback* do jogo.

* **Transpar√™ncia Radical:** Ao finalizar uma sess√£o do jogo, o doador v√™ exatamente para onde o dinheiro vai (ex: "R$ 5,00 mant√©m o servidor de mapas no ar por 2 horas").  
* **Feedback de Impacto:** Enviar notifica√ß√µes mensais com m√©tricas reais: "Gra√ßas aos apoiadores, este m√™s guiamos 500 pessoas para abrigos e 1.200 para refei√ß√µes". Isso tangibiliza a doa√ß√£o e reduz a taxa de cancelamento (*churn*) dos apoiadores.3

## **7\. Conclus√£o e Recomenda√ß√µes Finais**

As propostas analisadas demonstram uma inten√ß√£o nobre e inovadora de aplicar tecnologia para mitigar o sofrimento humano. No entanto, a an√°lise t√©cnica revela que a "Arquitetura da Invisibilidade", em sua concep√ß√£o original baseada em IA generativa pesada (*Gemini Nano*), corre o risco de ser invis√≠vel justamente para quem mais precisa dela, devido √†s barreiras de hardware.

A reorienta√ß√£o para uma arquitetura **"Offline-First e Determin√≠stica"**, utilizando bancos de dados locais, l√≥gica de regras simples e interfaces acess√≠veis (PWA, USSD), n√£o √© um retrocesso tecnol√≥gico, mas um avan√ßo em sofistica√ß√£o de engenharia social. Ao priorizar a robustez e a inclus√£o sobre o *hype* da IA, o projeto pode se tornar uma infraestrutura c√≠vica vital.

A integra√ß√£o profunda com os ODS, transformando cada clique em um dado de demanda social, oferece um caminho para a sustentabilidade financeira e pol√≠tica do projeto. O jogo deixa de ser apenas uma simula√ß√£o para se tornar um sensor vivo da cidade, dando voz ‚Äî atrav√©s de dados ‚Äî √†queles que s√£o frequentemente silenciados.

### **Tabela Consolidada de Recomenda√ß√µes Estruturais**

| Dom√≠nio | Proposta Original (Risco Identificado) | Recomenda√ß√£o T√©cnica (Solu√ß√£o) | Benef√≠cio Esperado |
| :---- | :---- | :---- | :---- |
| **Intelig√™ncia** | IA Generativa On-Device (Gemini Nano) | √Årvores de Decis√£o (JSON) \+ Busca FTS | Compatibilidade com hardware antigo; economia cr√≠tica de bateria. |
| **Plataforma** | App Nativo / IA Ag√™ntica | PWA (Web Progressivo) \+ Interfaces USSD/SMS | Acesso universal, inclusive sem internet ou smartphone. |
| **Dados** | Sincroniza√ß√£o Gen√©rica | Sync Incremental (Delta) \+ PouchDB | Resili√™ncia a redes inst√°veis; menor consumo de dados m√≥veis. |
| **Conte√∫do** | Gera√ß√£o via IA (Alucina√ß√£o) | Curadoria Humana \+ RAG (Base Confi√°vel) | Precis√£o jur√≠dica e seguran√ßa para o usu√°rio vulner√°vel. |
| **ODS** | N√£o Detalhado | Telemetria de Eventos como Proxies ODS | Gera√ß√£o de m√©tricas audit√°veis para relat√≥rios ESG e gest√£o p√∫blica. |

#### **Refer√™ncias citadas**

1. Censo da Popula√ß√£o em Situa√ß√£o de Rua \- Campinas/SP 2024 \- Funda√ß√£o FEAC, acessado em dezembro 16, 2025, [https://feac.org.br/wp-content/uploads/2025/06/Relatorio-Descritivo-e-Metodologico\_Versao\_25-10.pdf](https://feac.org.br/wp-content/uploads/2025/06/Relatorio-Descritivo-e-Metodologico_Versao_25-10.pdf)  
2. Campinas contabiliza no censo de 2024 cerca de 1300 moradores de rua, acessado em dezembro 16, 2025, [https://jat.jor.br/noticia/367/campinas-contabiliza-no-censo-de-2024-cerca-de-1300-moradores-de-rua](https://jat.jor.br/noticia/367/campinas-contabiliza-no-censo-de-2024-cerca-de-1300-moradores-de-rua)  
3. proposal\_2.txt  
4. Popula√ß√£o em situa√ß√£o de rua \- Portal PMC \- Administra√ß√£o, acessado em dezembro 16, 2025, [https://portal-api.campinas.sp.gov.br/sites/default/files/secretarias/arquivos-avulsos/7%20troque\_a\_esmola\_por\_cidadania.pdf](https://portal-api.campinas.sp.gov.br/sites/default/files/secretarias/arquivos-avulsos/7%20troque_a_esmola_por_cidadania.pdf)  
5. UX/UI Case Study ‚Äî Helping Home App | by Robert Jesse | Medium, acessado em dezembro 16, 2025, [https://medium.com/@robertjesse\_78011/ux-ui-case-study-helping-home-app-a46925236105](https://medium.com/@robertjesse_78011/ux-ui-case-study-helping-home-app-a46925236105)  
6. Campinas amplia vagas em abrigos para pessoas em situa√ß√£o de rua, acessado em dezembro 16, 2025, [https://horacampinas.com.br/campinas-amplia-vagas-em-abrigos-para-pessoas-em-situacao-de-rua/](https://horacampinas.com.br/campinas-amplia-vagas-em-abrigos-para-pessoas-em-situacao-de-rua/)  
7. Making digital inclusion a reality for underserved communities in Brazil | Viasat, acessado em dezembro 16, 2025, [https://www.viasat.com/perspectives/corporate/2023/making-digital-inclusion-a-reality-for-underserved-communities-in-brazil/](https://www.viasat.com/perspectives/corporate/2023/making-digital-inclusion-a-reality-for-underserved-communities-in-brazil/)  
8. Mobile Phone, Computer, and Internet Use Among Older Homeless Adults: Results from the HOPE HOME Cohort Study, acessado em dezembro 16, 2025, [https://mhealth.jmir.org/2018/12/e10049/](https://mhealth.jmir.org/2018/12/e10049/)  
9. No Digital Divide? Technology Use among Homeless Adults \- PMC \- NIH, acessado em dezembro 16, 2025, [https://pmc.ncbi.nlm.nih.gov/articles/PMC6516785/](https://pmc.ncbi.nlm.nih.gov/articles/PMC6516785/)  
10. Five rules in designing for a vulnerable population | by Pablo Portilla del Valle, acessado em dezembro 16, 2025, [https://uxdesign.cc/five-rules-in-designing-for-a-vulnerable-population-c94c8bb0f047](https://uxdesign.cc/five-rules-in-designing-for-a-vulnerable-population-c94c8bb0f047)  
11. Digital technologies to achieve the UN SDGs \- ITU, acessado em dezembro 16, 2025, [https://www.itu.int/en/mediacentre/backgrounders/Pages/icts-to-achieve-the-united-nations-sustainable-development-goals.aspx](https://www.itu.int/en/mediacentre/backgrounders/Pages/icts-to-achieve-the-united-nations-sustainable-development-goals.aspx)  
12. Gemini Nano | AI \- Android Developers, acessado em dezembro 16, 2025, [https://developer.android.com/ai/gemini-nano](https://developer.android.com/ai/gemini-nano)  
13. Galaxy AI features and supported models | Samsung LEVANT, acessado em dezembro 16, 2025, [https://www.samsung.com/levant/support/mobile-devices/expanded-model-support-for-galaxy-ai-features/](https://www.samsung.com/levant/support/mobile-devices/expanded-model-support-for-galaxy-ai-features/)  
14. Gemini Nano Guide: Edge AI Computing for Banana Pi & Mobile 2025 \- LaoZhang-AI, acessado em dezembro 16, 2025, [https://blog.laozhang.ai/ai-technology/gemini-nano-edge-ai-guide/](https://blog.laozhang.ai/ai-technology/gemini-nano-edge-ai-guide/)  
15. Here are all the Gemini Nano features, and the phones that support them \- Android Authority, acessado em dezembro 16, 2025, [https://www.androidauthority.com/gemini-nano-features-devices-3490062/](https://www.androidauthority.com/gemini-nano-features-devices-3490062/)  
16. Google AI Edge SDK \- Android Developers, acessado em dezembro 16, 2025, [https://developer.android.com/ai/gemini-nano/ai-edge-sdk](https://developer.android.com/ai/gemini-nano/ai-edge-sdk)  
17. On-device GenAI APIs as part of ML Kit help you easily build with Gemini Nano, acessado em dezembro 16, 2025, [https://android-developers.googleblog.com/2025/05/on-device-gen-ai-apis-ml-kit-gemini-nano.html](https://android-developers.googleblog.com/2025/05/on-device-gen-ai-apis-ml-kit-gemini-nano.html)  
18. Battery consumption for billions | Build for Billions \- Android Developers, acessado em dezembro 16, 2025, [https://developer.android.com/docs/quality-guidelines/build-for-billions/battery-consumption](https://developer.android.com/docs/quality-guidelines/build-for-billions/battery-consumption)  
19. android \- Building Time and Energy Consumption App \- Stack Overflow, acessado em dezembro 16, 2025, [https://stackoverflow.com/questions/20651601/building-time-and-energy-consumption-app](https://stackoverflow.com/questions/20651601/building-time-and-energy-consumption-app)  
20. Google Antigravity IDE: A Beginner‚Äôs Guide | by proflead | Nov, 2025, acessado em dezembro 16, 2025, [https://medium.com/@proflead/google-antigravity-ide-a-beginners-guide-9ed319b6bc01](https://medium.com/@proflead/google-antigravity-ide-a-beginners-guide-9ed319b6bc01)  
21. acessado em dezembro 16, 2025, [https://en.wikipedia.org/wiki/Google\_Antigravity](https://en.wikipedia.org/wiki/Google_Antigravity)  
22. Build with Google Antigravity, our new agentic development platform, acessado em dezembro 16, 2025, [https://developers.googleblog.com/build-with-google-antigravity-our-new-agentic-development-platform/](https://developers.googleblog.com/build-with-google-antigravity-our-new-agentic-development-platform/)  
23. Google's Antigravity IDE Sparks Forking Debate \- Visual Studio Magazine, acessado em dezembro 16, 2025, [https://visualstudiomagazine.com/articles/2025/11/21/googles-antigravity-ide-sparks-forking-debate.aspx](https://visualstudiomagazine.com/articles/2025/11/21/googles-antigravity-ide-sparks-forking-debate.aspx)  
24. What are the restrictions of running a completely offline chatbot? \[closed\] \- Stack Overflow, acessado em dezembro 16, 2025, [https://stackoverflow.com/questions/59773157/what-are-the-restrictions-of-running-a-completely-offline-chatbot](https://stackoverflow.com/questions/59773157/what-are-the-restrictions-of-running-a-completely-offline-chatbot)  
25. What are some options for an offline chatbot on Android? \- Data Science Stack Exchange, acessado em dezembro 16, 2025, [https://datascience.stackexchange.com/questions/26967/what-are-some-options-for-an-offline-chatbot-on-android](https://datascience.stackexchange.com/questions/26967/what-are-some-options-for-an-offline-chatbot-on-android)  
26. Offline App Architecture: Benefits of Building Offline-First Apps \- Codiant, acessado em dezembro 16, 2025, [https://codiant.com/blog/build-offline-first-app-architecture/](https://codiant.com/blog/build-offline-first-app-architecture/)  
27. From Speed to Offline Access: Pros and Cons of PWA \- Xmethod, acessado em dezembro 16, 2025, [https://www.xmethod.de/blog/from-speed-to-offline-access-pros-and-cons-of-pwa](https://www.xmethod.de/blog/from-speed-to-offline-access-pros-and-cons-of-pwa)  
28. Offline-First Apps: Why Enterprises Are Prioritizing Data Sync Capabilities \- Octal IT Solution, acessado em dezembro 16, 2025, [https://www.octalsoftware.com/blog/offline-first-apps](https://www.octalsoftware.com/blog/offline-first-apps)  
29. Offline data \- PWA \- web.dev, acessado em dezembro 16, 2025, [https://web.dev/learn/pwa/offline-data](https://web.dev/learn/pwa/offline-data)  
30. Designing User-Friendly USSD Interface for Digital Financial Services, acessado em dezembro 16, 2025, [https://www.microsave.net/2017/04/07/designing-user-friendly-ussd-interface-for-digital-financial-services/](https://www.microsave.net/2017/04/07/designing-user-friendly-ussd-interface-for-digital-financial-services/)  
31. Ussd Menu, USSD API & Ussd Gateway Service \- Beem, acessado em dezembro 16, 2025, [https://beem.africa/ussd-api/](https://beem.africa/ussd-api/)  
32. Designing an Effective User Interface for USSD: Part2 \- MicroSave Consulting (MSC), acessado em dezembro 16, 2025, [https://www.microsave.net/2015/09/15/designing-an-effective-user-interface-for-ussd-part2/](https://www.microsave.net/2015/09/15/designing-an-effective-user-interface-for-ussd-part2/)  
33. Back to basics: Optimising UX for USSD applications | by Charity Mbaka | UX Collective, acessado em dezembro 16, 2025, [https://uxdesign.cc/back-to-basics-optimising-ux-for-ussd-applications-d7096cfb8c0f](https://uxdesign.cc/back-to-basics-optimising-ux-for-ussd-applications-d7096cfb8c0f)  
34. WhatsApp Business API Pricing 2025 (Country-wise Guide: India, US, UK, etc.) \- TryowBOT, acessado em dezembro 16, 2025, [https://tryowbot.com/blog/whatsapp-business-api-pricing-2025-country-wise-guide-india-us-uk/](https://tryowbot.com/blog/whatsapp-business-api-pricing-2025-country-wise-guide-india-us-uk/)  
35. WhatsApp Business API Pricing Updates (Effective July 1, 2025\) \- ControlHippo, acessado em dezembro 16, 2025, [https://controlhippo.com/blog/whatsapp/whatsapp-business-api-pricing-update/](https://controlhippo.com/blog/whatsapp/whatsapp-business-api-pricing-update/)  
36. SMS Pricing in Brazil for Text Messaging | Twilio, acessado em dezembro 16, 2025, [https://www.twilio.com/en-us/sms/pricing/br](https://www.twilio.com/en-us/sms/pricing/br)  
37. What are the best practices to design user interfaces that are going to be used under direct sunlight? \- UX Stack Exchange, acessado em dezembro 16, 2025, [https://ux.stackexchange.com/questions/134227/what-are-the-best-practices-to-design-user-interfaces-that-are-going-to-be-used](https://ux.stackexchange.com/questions/134227/what-are-the-best-practices-to-design-user-interfaces-that-are-going-to-be-used)  
38. What color scheme is best for sunlight readability? \[closed\] \- Stack Overflow, acessado em dezembro 16, 2025, [https://stackoverflow.com/questions/5155903/what-color-scheme-is-best-for-sunlight-readability](https://stackoverflow.com/questions/5155903/what-color-scheme-is-best-for-sunlight-readability)  
39. How to Design Apps for Better Battery Efficiency | Sidekick Interactive, acessado em dezembro 16, 2025, [https://www.sidekickinteractive.com/mobile-app-strategy/how-to-design-apps-for-better-battery-efficiency/](https://www.sidekickinteractive.com/mobile-app-strategy/how-to-design-apps-for-better-battery-efficiency/)  
40. Dados Abertos SP: Bem vindo, acessado em dezembro 16, 2025, [https://dadosabertos.sp.gov.br/](https://dadosabertos.sp.gov.br/)  
41. API de Dados \- Portal da Transpar√™ncia do Governo Federal, acessado em dezembro 16, 2025, [https://portaldatransparencia.gov.br/api-de-dados](https://portaldatransparencia.gov.br/api-de-dados)  
42. Portal PMC \- Administra√ß√£o \- Prefeitura Municipal de Campinas, acessado em dezembro 16, 2025, [https://portal-api.campinas.sp.gov.br/sites/default/files/secretarias/arquivos-avulsos/131/2025/07/28-095400/Edital\_02.2025\_Abrigo\_Crianca\_e\_Adolescente.pdf](https://portal-api.campinas.sp.gov.br/sites/default/files/secretarias/arquivos-avulsos/131/2025/07/28-095400/Edital_02.2025_Abrigo_Crianca_e_Adolescente.pdf)  
43. FRAMEWORK DE ADEQUA√á√ÉO DE BANCOS DE DADOS LEGADOS √Ä LEI GERAL DE PROTE√á√ÉO DE DADOS PESSOAIS (LGPD): UM ESTUDO PARA √ìRG√ÉOS \- Reposit√≥rio Institucional da ENAP, acessado em dezembro 16, 2025, [https://repositorio.enap.gov.br/bitstream/1/8369/1/10941-Texto%20do%20Artigo-34656-1-10-20241226.pdf](https://repositorio.enap.gov.br/bitstream/1/8369/1/10941-Texto%20do%20Artigo-34656-1-10-20241226.pdf)  
44. Frequently Asked Questions: By-Name Data and Privacy \- Community Solutions, acessado em dezembro 16, 2025, [https://community.solutions/how-is-privacy-addressed-with-by-name-homlessness-data/](https://community.solutions/how-is-privacy-addressed-with-by-name-homlessness-data/)  
45. What Research Says About Gamification and Sustainability | Council Fire, acessado em dezembro 16, 2025, [https://www.councilfire.org/guides/what-research-says-about-gamification-and-sustainability/](https://www.councilfire.org/guides/what-research-says-about-gamification-and-sustainability/)
</file>

<file path=".husky/pre-commit">
npx lint-staged
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="scripts/verify-structure.js">
const fs = require("node:fs");
const path = require("node:path");

const COMPONENTS_DIR = path.join(__dirname, "../src/components");

function walkDir(dir, callback) {
	if (!fs.existsSync(dir)) return;
	fs.readdirSync(dir).forEach((f) => {
		const dirPath = path.join(dir, f);
		const isDirectory = fs.statSync(dirPath).isDirectory();
		if (isDirectory) {
			walkDir(dirPath, callback);
		} else {
			callback(path.join(dir, f));
		}
	});
}

console.log("Verificando componentes em:", COMPONENTS_DIR);
console.log("--------------------------------------------------");

let hasIssues = false;

walkDir(COMPONENTS_DIR, (filePath) => {
	if (!/\.(tsx|jsx)$/.test(filePath)) return;

	const content = fs.readFileSync(filePath, "utf8");

	// Check if file uses className
	const hasClassName = /className\s*=/.test(content);

	if (hasClassName) {
		// Check if it imports 'cn' from utils
		// Regex allows for import { cn } from ..., with various spacing and quotes
		// Also handles relative paths if someone used ../lib/utils (though @/lib/utils is preferred)
		const importsCn =
			/import\s+.*\{\s*cn\s*\}.*/.test(content) ||
			/import\s+.*cn\s+from/.test(content);

		// Strict check: if it has className but DOES NOT import cn, it's a warning.
		// Or if it uses className="..." (string literal) without cn()?
		// The requirement says "using manual classes without 'cn'".
		// Usually if they import cn, they are likely using it or intend to.
		// If they don't import it, they definitely aren't using it.

		if (!importsCn) {
			console.log(
				`Refatora√ß√£o Necess√°ria: ${path.relative(process.cwd(), filePath)}`,
			);
			console.log(`  -> Detectado 'className' mas sem importa√ß√£o de 'cn'.`);
			hasIssues = true;
		}
		// Optional: detect literal strings like className="foo" (harder to regex reliably without false positives on existing proper usage)
	}
});

if (!hasIssues) {
	console.log("Tudo certo! Nenhum problema de estrutura detectado.");
} else {
	console.log("--------------------------------------------------");
	console.log("Por favor, utilize a fun√ß√£o cn() de @/lib/utils para classes.");
	process.exit(1);
}
</file>

<file path="src/app/api/auth/[...nextauth]/route.ts">
import { handlers } from "@/auth";
export const { GET, POST } = handlers;
</file>

<file path="src/app/sobre/page.tsx">
import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default function SobrePage() {
	return (
		<div className="flex flex-col min-h-screen p-4 max-w-md mx-auto gap-4">
			<header className="flex items-center gap-2 mb-4">
				<Link href="/">
					<Button variant="ghost" size="icon">
						<ArrowLeft className="h-4 w-4" />
					</Button>
				</Link>
				<h1 className="text-xl font-bold">Sobre o Projeto</h1>
			</header>

			<article className="prose dark:prose-invert">
				<h3>A Invisibilidade √© uma Escolha?</h3>
				<p>
					Este n√£o √© apenas um jogo. √â uma ferramenta de{" "}
					<b>conscientiza√ß√£o e sobreviv√™ncia</b>.
				</p>
				<p>
					Baseado em dados reais da cidade de Campinas (SP), este aplicativo tem
					dois objetivos:
				</p>
				<ol>
					<li>
						<b>Para quem joga (Empatia):</b> Sentir na pele os dilemas di√°rios
						de quem vive na rua. Fome, frio, burocracia e olhares de julgamento.
					</li>
					<li>
						<b>Para quem vive (Utilidade):</b> Um mapa offline real com servi√ßos
						essenciais (Centro Pop, Bom Prato, Abrigos).
					</li>
				</ol>

				<div className="p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg my-4">
					<p className="text-sm font-bold">
						"N√£o olhe para o outro lado. Olhe nos olhos."
					</p>
				</div>

				<h4>Tecnologia Social</h4>
				<p className="text-sm">
					Desenvolvido como PWA (Progressive Web App) para rodar em qualquer
					celular, mesmo sem internet constante.
				</p>
			</article>

			<footer className="mt-8 text-center">
				<Link href="/apoie">
					<Button className="w-full">Seja um Apoiador</Button>
				</Link>
			</footer>
		</div>
	);
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

.survival-mode {
  --background: #000000;
  --foreground: #ffff00;
  --card: #000000;
  --card-foreground: #ffff00;
  --popover: #000000;
  --popover-foreground: #ffff00;
  --primary: #ffff00;
  --primary-foreground: #000000;
  --secondary: #000000;
  --secondary-foreground: #ffff00;
  --muted: #000000;
  --muted-foreground: #ffff00;
  --accent: #ffff00;
  --accent-foreground: #000000;
  --destructive: #ff0000;
  --border: #ffff00;
  --input: #ffff00;
  --ring: #ffff00;
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="src/app/page.tsx">
"use client";

import dynamic from "next/dynamic";

const LandingPage = dynamic(() => import("@/features/ui/LandingPage"), {
	ssr: false,
});

export default function Home() {
	return (
		<div className="min-h-screen bg-slate-50">
			<LandingPage />
		</div>
	);
}
</file>

<file path="src/components/ui/button.tsx">
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";
import type * as React from "react";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
	"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
	{
		variants: {
			variant: {
				default: "bg-primary text-primary-foreground hover:bg-primary/90",
				destructive:
					"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
				outline:
					"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
				secondary:
					"bg-secondary text-secondary-foreground hover:bg-secondary/80",
				ghost:
					"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
				link: "text-primary underline-offset-4 hover:underline",
			},
			size: {
				default: "h-9 px-4 py-2 has-[>svg]:px-3",
				sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
				lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
				icon: "size-9",
				"icon-sm": "size-8",
				"icon-lg": "size-10",
			},
		},
		defaultVariants: {
			variant: "default",
			size: "default",
		},
	},
);

function Button({
	className,
	variant = "default",
	size = "default",
	asChild = false,
	...props
}: React.ComponentProps<"button"> &
	VariantProps<typeof buttonVariants> & {
		asChild?: boolean;
	}) {
	const Comp = asChild ? Slot : "button";

	return (
		<Comp
			data-slot="button"
			data-variant={variant}
			data-size={size}
			className={cn(buttonVariants({ variant, size, className }))}
			{...props}
		/>
	);
}

export { Button, buttonVariants };
</file>

<file path="src/components/ui/card.tsx">
import type * as React from "react";

import { cn } from "@/lib/utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card"
			className={cn(
				"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
				className,
			)}
			{...props}
		/>
	);
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-header"
			className={cn(
				"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
				className,
			)}
			{...props}
		/>
	);
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-title"
			className={cn("leading-none font-semibold", className)}
			{...props}
		/>
	);
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-description"
			className={cn("text-muted-foreground text-sm", className)}
			{...props}
		/>
	);
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-action"
			className={cn(
				"col-start-2 row-span-2 row-start-1 self-start justify-self-end",
				className,
			)}
			{...props}
		/>
	);
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-content"
			className={cn("px-6", className)}
			{...props}
		/>
	);
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="card-footer"
			className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
			{...props}
		/>
	);
}

export {
	Card,
	CardHeader,
	CardFooter,
	CardTitle,
	CardAction,
	CardDescription,
	CardContent,
};
</file>

<file path="src/components/ui/dialog.tsx">
"use client";

import * as DialogPrimitive from "@radix-ui/react-dialog";
import { XIcon } from "lucide-react";
import type * as React from "react";

import { cn } from "@/lib/utils";

function Dialog({
	...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
	return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
	...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
	return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
	...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
	return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
	...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
	return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
	className,
	...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
	return (
		<DialogPrimitive.Overlay
			data-slot="dialog-overlay"
			className={cn(
				"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
				className,
			)}
			{...props}
		/>
	);
}

function DialogContent({
	className,
	children,
	showCloseButton = true,
	...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
	showCloseButton?: boolean;
}) {
	return (
		<DialogPortal data-slot="dialog-portal">
			<DialogOverlay />
			<DialogPrimitive.Content
				data-slot="dialog-content"
				className={cn(
					"bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 outline-none sm:max-w-lg",
					className,
				)}
				{...props}
			>
				{children}
				{showCloseButton && (
					<DialogPrimitive.Close
						data-slot="dialog-close"
						className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
					>
						<XIcon />
						<span className="sr-only">Close</span>
					</DialogPrimitive.Close>
				)}
			</DialogPrimitive.Content>
		</DialogPortal>
	);
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="dialog-header"
			className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
			{...props}
		/>
	);
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
	return (
		<div
			data-slot="dialog-footer"
			className={cn(
				"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
				className,
			)}
			{...props}
		/>
	);
}

function DialogTitle({
	className,
	...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
	return (
		<DialogPrimitive.Title
			data-slot="dialog-title"
			className={cn("text-lg leading-none font-semibold", className)}
			{...props}
		/>
	);
}

function DialogDescription({
	className,
	...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
	return (
		<DialogPrimitive.Description
			data-slot="dialog-description"
			className={cn("text-muted-foreground text-sm", className)}
			{...props}
		/>
	);
}

export {
	Dialog,
	DialogClose,
	DialogContent,
	DialogDescription,
	DialogFooter,
	DialogHeader,
	DialogOverlay,
	DialogPortal,
	DialogTitle,
	DialogTrigger,
};
</file>

<file path="src/components/ui/EcoButton.tsx">
import { cva, type VariantProps } from "class-variance-authority";
import { type ButtonHTMLAttributes, forwardRef } from "react";
import { cn } from "@/lib/utils";

const ecoButtonVariants = cva(
	"inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 min-h-[48px] min-w-[48px] px-4 py-2",
	{
		variants: {
			variant: {
				primary: "bg-black text-white border border-white hover:bg-neutral-900",
				danger:
					"bg-black text-red-500 border border-red-500 hover:bg-red-950/30",
				ghost: "bg-transparent text-white hover:bg-white/10 hover:text-white",
			},
			size: {
				default: "h-12 px-4 py-2",
				sm: "h-12 rounded-md px-3", // Forced min-height 48px even for small
				lg: "h-14 rounded-md px-8",
				icon: "h-12 w-12",
			},
		},
		defaultVariants: {
			variant: "primary",
			size: "default",
		},
	},
);

export interface EcoButtonProps
	extends ButtonHTMLAttributes<HTMLButtonElement>,
		VariantProps<typeof ecoButtonVariants> {}

const EcoButton = forwardRef<HTMLButtonElement, EcoButtonProps>(
	({ className, variant, size, ...props }, ref) => {
		return (
			<button
				type="button"
				className={cn(ecoButtonVariants({ variant, size, className }))}
				ref={ref}
				{...props}
			/>
		);
	},
);
EcoButton.displayName = "EcoButton";

export { EcoButton, ecoButtonVariants };
</file>

<file path="src/components/ui/EcoCard.tsx">
import { forwardRef, type HTMLAttributes } from "react";
import { cn } from "@/lib/utils";

export interface EcoCardProps extends HTMLAttributes<HTMLDivElement> {}

const EcoCard = forwardRef<HTMLDivElement, EcoCardProps>(
	({ className, ...props }, ref) => {
		return (
			<div
				ref={ref}
				className={cn(
					"rounded-xl border border-[#333333] bg-[#000000] p-4 text-white shadow-sm",
					className,
				)}
				{...props}
			/>
		);
	},
);
EcoCard.displayName = "EcoCard";

export { EcoCard };
</file>

<file path="src/components/ui/input.tsx">
import type * as React from "react";

import { cn } from "@/lib/utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
	return (
		<input
			type={type}
			data-slot="input"
			className={cn(
				"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
				"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
				"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
				className,
			)}
			{...props}
		/>
	);
}

export { Input };
</file>

<file path="src/components/ui/Navbar.tsx">
"use client";

import { BarChart3, MapPin, Menu, Sparkles, X } from "lucide-react";
import Link from "next/link";
import { usePathname, useRouter } from "next/navigation";
import { useSession } from "next-auth/react";
import { useEffect, useState } from "react";

export function Navbar() {
	const [isMenuOpen, setIsMenuOpen] = useState(false);
	const { data: _session, status } = useSession();
	const pathname = usePathname();
	const router = useRouter();

	// Close menu when route changes
	// biome-ignore lint/correctness/useExhaustiveDependencies: Trigger on route change
	useEffect(() => {
		setIsMenuOpen(false);
	}, [pathname]);

	const handleNavigation = (sectionId: string) => {
		if (pathname !== "/") {
			router.push(`/#${sectionId}`);
			return;
		}

		const element = document.getElementById(sectionId);
		if (element) {
			element.scrollIntoView({ behavior: "smooth" });
		}
		setIsMenuOpen(false);
	};

	return (
		<nav className="fixed w-full bg-white/90 backdrop-blur-sm z-50 border-b border-slate-200 shadow-sm">
			<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div className="flex justify-between items-center h-16">
					<Link href="/" className="flex items-center gap-2">
						<div className="bg-blue-600 p-2 rounded-lg">
							<MapPin className="h-6 w-6 text-white" />
						</div>
						<span className="font-bold text-xl tracking-tight text-slate-800">
							Caminhos <span className="text-blue-600">Campinas</span>
						</span>
					</Link>

					{/* Desktop Menu */}
					<div className="hidden md:flex items-center space-x-8">
						<button
							type="button"
							onClick={() => handleNavigation("projeto")}
							className="text-slate-600 hover:text-blue-600 font-bold transition-colors uppercase tracking-widest text-xs"
						>
							A Rua Tem Voz
						</button>
						<Link
							href="/impacto"
							className="text-blue-600 hover:text-blue-800 font-bold transition-colors flex items-center gap-1 uppercase tracking-widest text-xs"
						>
							<BarChart3 className="w-4 h-4" /> Painel de Impacto
						</Link>
						<Link
							href="/#mapa"
							className="text-slate-600 hover:text-blue-600 font-medium transition-colors flex items-center gap-1 uppercase tracking-widest text-xs"
						>
							<MapPin className="w-4 h-4 text-green-600" /> Mapa de Apoio
						</Link>
						<button
							type="button"
							onClick={() => handleNavigation("demo-ia")}
							className="text-slate-600 hover:text-blue-600 font-medium transition-colors flex items-center gap-1 uppercase tracking-widest text-xs"
						>
							<Sparkles className="w-4 h-4 text-purple-500" /> Demo IA
						</button>
						{status === "authenticated" ? (
							<Link
								href="/jogar"
								className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-full font-bold transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
							>
								Continuar Jornada
							</Link>
						) : (
							<button
								type="button"
								// Opens login modal only if on landing page, otherwise redirects to home (or login page if we had one)
								// Since logic for opening modal is in LandingPage, we might need a Global Context for LoginModal or just redirect to custom login page.
								// For now, if not on home, redirect to home with query param? Or just redirect to /api/auth/signin
								onClick={() => {
									if (pathname === "/") {
										// This is tricky because the modal state is inside LandingPage.
										// We might need to expose it or move it up.
										// For simplicity now:
										window.location.href = "/api/auth/signin";
									} else {
										window.location.href = "/api/auth/signin";
									}
								}}
								className="text-slate-600 hover:text-blue-600 font-bold uppercase tracking-widest text-xs"
							>
								Entrar
							</button>
						)}
					</div>

					{/* Mobile Menu Button */}
					<div className="md:hidden">
						<button
							type="button"
							onClick={() => setIsMenuOpen(!isMenuOpen)}
							className="text-slate-600 p-2"
							aria-label={isMenuOpen ? "Fechar menu" : "Abrir menu"}
						>
							{isMenuOpen ? (
								<X className="h-6 w-6" />
							) : (
								<Menu className="h-6 w-6" />
							)}
						</button>
					</div>
				</div>
			</div>

			{/* Mobile Menu */}
			{isMenuOpen && (
				<div className="md:hidden bg-white border-b border-slate-200 animate-fade-in">
					<div className="px-4 pt-2 pb-6 space-y-2">
						<button
							type="button"
							onClick={() => handleNavigation("projeto")}
							className="block w-full text-left px-3 py-3 text-slate-600 font-medium border-b border-slate-100"
						>
							O Projeto
						</button>
						<button
							type="button"
							onClick={() => handleNavigation("demo-ia")}
							className="block w-full text-left px-3 py-3 text-slate-600 font-medium border-b border-slate-100 flex items-center gap-2"
						>
							<Sparkles className="w-4 h-4 text-purple-500" /> Demo IA
						</button>
						<button
							type="button"
							onClick={() => handleNavigation("tecnologia")}
							className="block w-full text-left px-3 py-3 text-slate-600 font-medium border-b border-slate-100"
						>
							Tecnologia
						</button>
						<button
							type="button"
							onClick={() => {
								if (status === "authenticated") {
									router.push("/jogar");
								} else {
									window.location.href = "/api/auth/signin";
								}
							}}
							className="block w-full text-left px-3 py-3 text-slate-600 font-medium border-b border-slate-100"
						>
							{status === "authenticated" ? "Jogar" : "Entrar"}
						</button>
						<button
							type="button"
							onClick={() => handleNavigation("doar")}
							className="block w-full mt-4 text-center bg-blue-600 text-white px-3 py-3 rounded-lg font-bold"
						>
							Apoiar Agora
						</button>
					</div>
				</div>
			)}
		</nav>
	);
}
</file>

<file path="src/components/ui/progress.tsx">
"use client";

import * as ProgressPrimitive from "@radix-ui/react-progress";
import type * as React from "react";

import { cn } from "@/lib/utils";

function Progress({
	indicatorClassName,
	className,
	value,
	...props
}: React.ComponentProps<typeof ProgressPrimitive.Root> & {
	indicatorClassName?: string;
}) {
	return (
		<ProgressPrimitive.Root
			data-slot="progress"
			className={cn(
				"bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
				className,
			)}
			{...props}
		>
			<ProgressPrimitive.Indicator
				data-slot="progress-indicator"
				className={cn(
					"bg-primary h-full w-full flex-1 transition-all",
					indicatorClassName,
				)}
				style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
			/>
		</ProgressPrimitive.Root>
	);
}

export { Progress };
</file>

<file path="src/contexts/ServicesContext.tsx">
"use client";

import type React from "react";
import {
	createContext,
	useCallback,
	useContext,
	useEffect,
	useState,
} from "react";

export type ServiceType =
	| "food"
	| "shelter"
	| "health"
	| "assistance"
	| "com√©rcio"
	| "privado";

export interface ServiceLocation {
	id: string;
	name: string;
	type: ServiceType;
	coords: [number, number];
	opening_hours: string;
	address?: string;
	description?: string;
	effects?: {
		hunger?: number;
		health?: number;
		hygiene?: number;
		sanity?: number;
		energy?: number;
		dignity?: number;
		money?: number;
		stabilityGap?: number;
		addBuff?: string;
	};
}

interface ServicesContextProps {
	services: ServiceLocation[];
	loading: boolean;
	error: string | null;
	filterServices: (type: ServiceType | "all") => ServiceLocation[];
	refreshServices: () => Promise<void>;
}

const ServicesContext = createContext<ServicesContextProps | undefined>(
	undefined,
);

const STORAGE_KEY = "services_data";

export function ServicesProvider({ children }: { children: React.ReactNode }) {
	const [services, setServices] = useState<ServiceLocation[]>([]);
	const [loading, setLoading] = useState(true);
	const [error, setError] = useState<string | null>(null);

	const loadFromStorage = useCallback(() => {
		if (typeof window === "undefined") return null;
		try {
			const stored = localStorage.getItem(STORAGE_KEY);
			if (stored) {
				return JSON.parse(stored) as ServiceLocation[];
			}
		} catch (e) {
			console.warn("Failed to parse services from storage", e);
		}
		return null;
	}, []);

	const saveToStorage = useCallback((data: ServiceLocation[]) => {
		if (typeof window === "undefined") return;
		try {
			localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
		} catch (e) {
			console.warn("Failed to save services to storage", e);
		}
	}, []);

	const fetchServices = useCallback(async () => {
		try {
			setLoading(true);
			setError(null);

			// Try reading from storage first to show something immediately
			const cached = loadFromStorage();
			if (cached) {
				setServices(cached);
			}

			// If we are online, fetch fresh data
			// For this offline-first requirement, if we have cached data, we might not want to block or error hard.
			// But let's try to update it.
			if (navigator.onLine) {
				const response = await fetch("/data/services-campinas.json");
				if (!response.ok) throw new Error("Failed to fetch services");
				const data: ServiceLocation[] = await response.json();

				setServices(data);
				saveToStorage(data);
			} else if (!cached) {
				setError("Offline e nenhum dado salvo encontrado.");
			}
		} catch (err) {
			console.error(err);
			// If fetch fails but we had cache, we are fine, just maybe show a warning log.
			// If we didn't have cache, set error.
			if (!loadFromStorage()) {
				setError("Erro ao carregar servi√ßos.");
			}
		} finally {
			setLoading(false);
		}
	}, [loadFromStorage, saveToStorage]);

	useEffect(() => {
		fetchServices();
	}, [fetchServices]);

	const filterServices = useCallback(
		(type: ServiceType | "all") => {
			if (type === "all") return services;
			return services.filter((s) => s.type === type);
		},
		[services],
	);

	return (
		<ServicesContext.Provider
			value={{
				services,
				loading,
				error,
				filterServices,
				refreshServices: fetchServices,
			}}
		>
			{children}
		</ServicesContext.Provider>
	);
}

export function useServices() {
	const context = useContext(ServicesContext);
	if (context === undefined) {
		throw new Error("useServices must be used within a ServicesProvider");
	}
	return context;
}
</file>

<file path="src/features/game-loop/index.ts">
export * from "./useGameLoop";
</file>

<file path="src/features/offline-db/db.ts">
let dbInstance: PouchDB.Database | null = null;

export const getDB = async () => {
	// Strong SSR check - return null if running on server
	if (typeof window === "undefined") {
		return null;
	}

	// Only create instance once on client
	if (!dbInstance) {
		try {
			// Dynamic import to prevent SSR module evaluation
			const PouchDB = (await import("pouchdb-browser")).default;
			dbInstance = new PouchDB("pop_rua_game_db");
			console.log("‚úÖ PouchDB initialized successfully (client-side)");
		} catch (error) {
			console.error("‚ùå Failed to initialize PouchDB:", error);
			return null;
		}
	}

	return dbInstance;
};
</file>

<file path="src/features/offline-db/index.ts">
export * from "./db";
export * from "./useOfflineDB";
</file>

<file path="src/features/offline-db/useOfflineDB.ts">
import { useEffect, useState } from "react";
import { getDB } from "./db";

export const useOfflineDB = () => {
	const [db, setDb] = useState<PouchDB.Database | null>(null);

	useEffect(() => {
		// This only runs on client-side
		async function initDB() {
			try {
				const database = await getDB();
				if (database) {
					setDb(database);
				}
			} catch (error) {
				console.error("Error initializing offline DB:", error);
			}
		}

		initDB();
	}, []);

	return db;
};
</file>

<file path="src/features/survival-map/index.ts">
export { SurvivalMap } from "./SurvivalMap";
</file>

<file path="src/features/survival-map/MapCore.tsx">
"use client";

import L from "leaflet";
import { useEffect } from "react";
import { MapContainer, Marker, Popup, TileLayer, useMap } from "react-leaflet";

// Fix for default marker icon
// @ts-expect-error
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
	iconRetinaUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
	iconUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom Icons
const UserIcon = new L.Icon({
	iconUrl:
		"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
	iconSize: [25, 41],
	iconAnchor: [12, 41],
	popupAnchor: [1, -34],
	shadowSize: [41, 41],
});

const ResourceIcon = new L.Icon({
	iconUrl:
		"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
	iconSize: [25, 41],
	iconAnchor: [12, 41],
	popupAnchor: [1, -34],
	shadowSize: [41, 41],
});

function MapController({ center }: { center: [number, number] }) {
	const map = useMap();
	useEffect(() => {
		if (center) {
			map.flyTo(center, 15);
		}
	}, [center, map]);
	return null;
}

interface MapCoreProps {
	userPosition: [number, number] | null;
	resources: {
		id: string | number;
		name: string;
		type: string;
		lat: number;
		lng: number;
	}[];
}

export default function MapCore({ userPosition, resources }: MapCoreProps) {
	// Default to Campinas center if no user position
	const defaultPosition: [number, number] = [-22.90556, -47.06083];
	const initialPosition = userPosition || defaultPosition;

	return (
		<MapContainer
			center={initialPosition}
			zoom={13}
			scrollWheelZoom={true}
			className="h-full w-full z-0"
		>
			<TileLayer
				attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
				url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
			/>

			<MapController center={initialPosition} />

			{/* User Marker */}
			{userPosition && (
				<Marker position={userPosition} icon={UserIcon}>
					<Popup>
						<strong>Voc√™ est√° aqui</strong>
					</Popup>
				</Marker>
			)}

			{/* Resources Markers */}
			{resources.map((res) => (
				<Marker key={res.id} position={[res.lat, res.lng]} icon={ResourceIcon}>
					<Popup>
						<strong>{res.name}</strong>
						<br />
						<span className="text-xs text-gray-600">{res.type}</span>
					</Popup>
				</Marker>
			))}
		</MapContainer>
	);
}
</file>

<file path="src/features/survival-map/SurvivalMap.tsx">
"use client";

import dynamic from "next/dynamic";
import { useEffect, useState } from "react";
import { useServices } from "@/contexts/ServicesContext";
import { NearbyList } from "./NearbyList";

const MapCore = dynamic(() => import("./MapCore"), {
	loading: () => (
		<p className="text-center p-10">Carregando mapa interativo...</p>
	),
	ssr: false,
});

export function SurvivalMap() {
	const [userPosition, setUserPosition] = useState<[number, number] | null>(
		null,
	);
	const [loadingLocation, setLoadingLocation] = useState(false);

	// Use ServicesContext for real data
	const { services } = useServices();

	// Map services to resources format expected by MapCore (splitting coords [lat, lng] -> lat, lng)
	const resources = services.map((s) => ({
		id: s.id,
		name: s.name,
		type: s.type,
		lat: s.coords[0],
		lng: s.coords[1],
	}));

	useEffect(() => {
		setLoadingLocation(true);
		if ("geolocation" in navigator) {
			navigator.geolocation.getCurrentPosition(
				(position) => {
					setUserPosition([
						position.coords.latitude,
						position.coords.longitude,
					]);
					setLoadingLocation(false);
				},
				(error) => {
					console.error("Erro de geolocaliza√ß√£o:", error);
					setLoadingLocation(false);
				},
			);
		} else {
			setLoadingLocation(false);
		}
	}, []);

	return (
		<div className="flex flex-col h-full w-full bg-slate-100">
			<div className="relative w-full h-[55%] flex-none border-b-2 border-slate-200 shadow-inner overflow-hidden">
				{loadingLocation && (
					<div className="absolute top-2 right-2 z-[1000] bg-white/90 px-3 py-1 rounded-full shadow text-xs font-bold text-blue-600 animate-pulse">
						Buscando sua localiza√ß√£o...
					</div>
				)}

				{/* Floating SOS Button */}
				<a
					href={`https://wa.me/?text=SOS! Estou em situa√ß√£o de emerg√™ncia. Minha localiza√ß√£o aproximada: ${userPosition ? `${userPosition[0]},${userPosition[1]}` : "Desconhecida"}`}
					target="_blank"
					rel="noopener noreferrer"
					className="absolute top-4 left-4 z-[1000] bg-red-600 text-white font-bold px-4 py-2 rounded-full shadow-lg hover:bg-red-700 transition-transform hover:scale-105 flex items-center gap-2"
				>
					üö® SOS EMERG√äNCIA
				</a>

				<MapCore userPosition={userPosition} resources={resources} />
			</div>

			{/* Nearby List Area - Scrollable */}
			<div className="flex-1 overflow-y-auto p-4 bg-slate-900 border-t border-slate-800">
				<NearbyList userPosition={userPosition} />
			</div>
		</div>
	);
}
</file>

<file path="src/features/ui/index.ts">
export * from "./GameChat";
export * from "./GameHUD";
export * from "./SurvivalModeContext";
export * from "./SurvivalToggle";
export * from "./SurvivalToggle";
</file>

<file path="src/features/ui/SurvivalModeContext.tsx">
"use client";

import type React from "react";
import { createContext, useContext, useEffect, useState } from "react";

interface SurvivalModeContextType {
	isSurvivalMode: boolean;
	toggleSurvivalMode: () => void;
}

const SurvivalModeContext = createContext<SurvivalModeContextType | undefined>(
	undefined,
);

export function SurvivalModeProvider({
	children,
}: {
	children: React.ReactNode;
}) {
	const [isSurvivalMode, setIsSurvivalMode] = useState(false);

	useEffect(() => {
		// Check local storage or system preference
		const stored = localStorage.getItem("survival-mode");
		if (stored === "true") {
			setIsSurvivalMode(true);
			document.documentElement.classList.add("survival-mode");
		}
	}, []);

	const toggleSurvivalMode = () => {
		setIsSurvivalMode((prev) => {
			const newValue = !prev;
			if (newValue) {
				document.documentElement.classList.add("survival-mode");
				localStorage.setItem("survival-mode", "true");
			} else {
				document.documentElement.classList.remove("survival-mode");
				localStorage.setItem("survival-mode", "false");
			}
			return newValue;
		});
	};

	return (
		<SurvivalModeContext.Provider
			value={{ isSurvivalMode, toggleSurvivalMode }}
		>
			{children}
		</SurvivalModeContext.Provider>
	);
}

export function useSurvivalMode() {
	const context = useContext(SurvivalModeContext);
	if (context === undefined) {
		throw new Error(
			"useSurvivalMode must be used within a SurvivalModeProvider",
		);
	}
	return context;
}
</file>

<file path="src/features/ui/SurvivalToggle.tsx">
"use client";

import { Eye, EyeOff } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useSurvivalMode } from "./SurvivalModeContext";

export function SurvivalToggle() {
	const { isSurvivalMode, toggleSurvivalMode } = useSurvivalMode();

	return (
		<Button
			variant="outline"
			size="icon"
			onClick={toggleSurvivalMode}
			className={
				isSurvivalMode
					? "bg-yellow-400 text-black font-bold border-4 border-black"
					: ""
			}
			aria-label={
				isSurvivalMode
					? "Desativar Modo Sobreviv√™ncia"
					: "Ativar Modo Sobreviv√™ncia"
			}
		>
			{isSurvivalMode ? (
				<Eye className="h-4 w-4" />
			) : (
				<EyeOff className="h-4 w-4" />
			)}
		</Button>
	);
}
</file>

<file path="src/hooks/useEventEngine.ts">
import { useCallback, useEffect } from "react";
import { useGameContext } from "@/contexts/GameContext";
import { GAME_DILEMMAS } from "@/features/game-loop/dilemmas";

export function useEventEngine() {
	const {
		activeDilemmaId,
		workTool,
		modifyStat,
		addMoney,
		advanceTime,
		markDilemmaResolved,
		setActiveDilemma,
		addBuff,
		removeBuff,
		setWorkTool,
		addToInventory,
	} = useGameContext();

	const activeDilemma = GAME_DILEMMAS.find((d) => d.id === activeDilemmaId);

	// Limpeza de Dilemas obsoletos ou IDs que n√£o existem na vers√£o atual
	useEffect(() => {
		if (activeDilemmaId && !activeDilemma) {
			console.warn(
				`[EventEngine] Dilema obsoleto detectado (${activeDilemmaId}). Limpando estado...`,
			);
			setActiveDilemma(null);
		}
	}, [activeDilemmaId, activeDilemma, setActiveDilemma]);

	const clearActiveDilemma = useCallback(
		() => setActiveDilemma(null),
		[setActiveDilemma],
	);

	const resolveDilemma = useCallback(
		(optionIndex: number) => {
			if (!activeDilemma) return;

			const option = activeDilemma.options[optionIndex];
			if (!option) return;
			const { effect } = option;

			// 1. Aplicar stats b√°sicos
			Object.entries(effect).forEach(([key, value]) => {
				if (typeof value === "number" && key !== "timeAdvance") {
					modifyStat(key as any, value);
				}
			});

			// 2. Efeitos Especializados
			if (effect.money) addMoney(effect.money);
			if (effect.timeAdvance) advanceTime(effect.timeAdvance);
			if (effect.inventoryAdd) addToInventory(effect.inventoryAdd);

			// 3. Efeitos Sociais Campinas
			if (effect.addBuff) addBuff(effect.addBuff);
			if (effect.removeBuff) removeBuff(effect.removeBuff);
			if (effect.workToolUpdate) {
				setWorkTool({
					...workTool,
					...effect.workToolUpdate,
				} as any);
			}

			// Finalizar evento
			markDilemmaResolved(activeDilemma.id);
			setActiveDilemma(null);
		},
		[
			activeDilemma,
			modifyStat,
			addMoney,
			advanceTime,
			addToInventory,
			addBuff,
			removeBuff,
			setWorkTool,
			workTool,
			markDilemmaResolved,
			setActiveDilemma,
		],
	);

	return {
		activeDilemma,
		resolveDilemma,
		clearActiveDilemma,
	};
}
</file>

<file path="src/hooks/useTelemetry.ts">
import { useCallback, useEffect } from "react";
import { type TelemetryAction, telemetryService } from "../services/telemetry";

export const useTelemetry = () => {
	const sync = useCallback(async () => {
		if (!navigator.onLine) return;

		try {
			const unsynced = await telemetryService.getUnsyncedEvents();
			if (unsynced.length === 0) return;

			// Send to dummy endpoint
			const response = await fetch("/api/sync", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify(unsynced),
			});

			if (response.ok) {
				const ids = unsynced.map((e) => e.id);
				await telemetryService.markAsSynced(ids);
				console.log(`Synced ${ids.length} telemetry events`);
			}
		} catch (error) {
			console.error("Telemetry sync failed:", error);
		}
	}, []);

	const trackAction = useCallback(
		async (action: TelemetryAction, data: Record<string, any> = {}) => {
			await telemetryService.track(action, data);

			// Try to sync immediately if online
			if (navigator.onLine) {
				// Debounce or just fire and forget?
				// For requirement "attempt to send", we call sync.
				// We catch errors inside sync so it won't crash the app.
				sync();
			}
		},
		[sync],
	);

	// Sync on online event
	useEffect(() => {
		const handleOnline = () => {
			sync();
		};

		window.addEventListener("online", handleOnline);

		// Also sync on mount
		sync();

		return () => {
			window.removeEventListener("online", handleOnline);
		};
	}, [sync]);

	return {
		trackAction,
	};
};
</file>

<file path="src/lib/utils.ts">
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
	return twMerge(clsx(inputs));
}
</file>

<file path=".aiexclude">
# .aiexclude - Redu√ß√£o de Ru√≠do Sem√¢ntico para o Gemini
node_modules/
dist/
build/
.git/
.cache/
coverage/
*.log
*.lock
package-lock.json
yarn.lock
# Exclua assets bin√°rios pesados que confundem o modelo
*.png
*.jpg
*.mp3
*.wav
*.mp4
</file>

<file path=".cursorrules">
# REGRAS DO PROJETO (LEIA ANTES DE CODAR)

## 1. Gerenciamento de Estado
- **Obrigat√≥rio:** Use apenas a **React Context API** nativa.
- **Hook Principal:** `useGameContext` (importado de `@/contexts/GameContext`).
- **Proibido:** N√£o use Zustand, Redux ou MobX. Reverter qualquer tentativa de introduzir estas libs.
- **Persist√™ncia:** O estado deve persistir no `localStorage` via l√≥gica interna do Context.

## 2. Design: "Realismo S√≥brio"
- **Filosofia:** Minimalismo t√°tico, urg√™ncia e crueza.
- **HUD:** "Survival Strip" fixa no topo. Sem sombras, sem gradientes excessivos.
- **Cores:** Use apenas a paleta Slate/Zinc com acentos funcionais (Rose para perigo, Emerald para vida alta, Amber para alerta).
- **√çcones:** Use `lucide-react` de forma s√≥bria.
- **Efeitos:** Use filtros de `grayscale`, `blur` e bordas internas (`ring-inset`) para comunicar deteriora√ß√£o de status (sa√∫de/sanidade baixa).

## 3. Desenvolvimento & Arquitetura
- **Estrutura:** Siga o padr√£o de pastas existente (features, contexts, components).
- **Importa√ß√µes:** Sempre use *absolute imports* (`@/...`). Verifique importa√ß√µes antes de salvar.
- **Qualidade:** TypeScript estrito. Use `clsx` e `tailwind-merge` para classes.
- **Sem Placeholders:** Nomes reais de servi√ßos de Campinas (SAMIM, CAPS AD, etc).
</file>

<file path="A RUA TEM VOZ- projeto.docx.md">
**A RUA TEM VOZ? 1**

DIREITOS HUMANOS PARA A POPULA√á√ÉO EM SITUA√á√ÉO DE RUA  
						

Daniel Arraes Reino

**Introdu√ß√£o**

O ano de 2023 para a popula√ß√£o em situa√ß√£o de rua parece promissor. Alguns compromissos assumidos publicamente pelo Estado t√™m repercutido em todo o territ√≥rio nacional. O Minist√©rio dos Direitos Humanos do ent√£o Governo Lula por meio de seu Ministro Silvio de Almeida junto ao Supremo Tribunal Federal, e do Desenvolvimento Social, Fam√≠lia e Combate √† Fome, Wellington Dias re√∫nem-se no dia 2 de julho do corrente ano em Bras√≠lia no intuito de pensar em uma pauta conjunta de a√ß√£o voltada a popula√ß√£o em situa√ß√£o de rua. Esta pauta surge ap√≥s a decis√£o do ministro do Supremo, Alexandre de Moraes, determinar o cumprimento de a√ß√µes voltadas a essa popula√ß√£o.

O abandono dado a esta popula√ß√£o, no que concerne a seus direitos, principalmente durante a pandemia (que no Brasil teve seu in√≠cio em 2020), consolidaram a ideia de que a sociedade brasileira afunila as desigualdades sociais, deixando a merc√™ da sorte os invis√≠veis, ou seja, os exclu√≠dos, aqueles a quem ela (a sociedade) n√£o quer ver, j√° que s√£o consequ√™ncia de sua pr√≥pria ina√ß√£o.  

A necessidade de assegurar os direitos voltados √† popula√ß√£o em situa√ß√£o de rua em uma sociedade desigual e injusta como a brasileira torna-se imediata. A den√∫ncia sobre pr√°ticas brutais cometidas contra os segmentos mais pobres da popula√ß√£o n√£o tem tido consequ√™ncias suficientes o que acaba por legitimar a omiss√£o de alguns, o medo de outros quanto a medidas alternativas que possam de fato, propor pol√≠ticas p√∫blicas que respeitem as necessidades locais. O abuso da seguran√ßa p√∫blica na retirada dos objetos pessoais, diariamente, dessa popula√ß√£o √© apontado como uma viol√™ncia institucionalizada em que o abuso de poder foi citado pelo ministro do STF- Superior Tribunal Federal, Alexandre de Moraes, em 25 de julho de 2023 e solicitado que fosse apresentado um plano de a√ß√£o e monitoramento para a implementa√ß√£o de uma pol√≠tica nacional para a popula√ß√£o em situa√ß√£o de rua.  
O neoliberalismo cujo modelo das privatiza√ß√µes adotado na Am√©rica Latina e no Brasil como modernizador, e a Globaliza√ß√£o excludente com seu desemprego estrutural veio aumentar a diferen√ßa entre ricos e pobres tornando o conceito de democracia e cidadania inofensivos em uma sociedade que se esvazia na privatiza√ß√£o de suas institui√ß√µes e na indiferen√ßa a fatos que tornam as crian√ßas, jovens e adultos que vivem na pobreza, nas ruas, no narcotr√°fico, e na prostitui√ß√£o ainda mais invis√≠veis.   
Al√©m disso, como bem afirma Gohn (2021:33) a pandemia desnudou a desigualdade existente tanto nos pa√≠ses ricos como nos pobres, ela desnaturalizou a pobreza e trouxe √† luz a vida cotidiana de milhares de invis√≠veis.  
Santos (2006), ao analisar as diversas formas de pobreza ou de d√≠vida social, vivida nos pa√≠ses subdesenvolvidos, enfatiza que no √∫ltimo meio s√©culo tiveram a pobreza inclu√≠da, ou seja, uma pobreza acidental que ocorre de tempos em tempos; uma segunda denominada marginalidade, produzida pelo processo econ√¥mico da divis√£o do trabalho; e o terceiro tipo que √© a pobreza estrutural que do ponto de vista moral e pol√≠tico equivale a uma d√≠vida social. A √∫ltima est√° diretamente ligada ao processo de globaliza√ß√£o, √© uma a√ß√£o deliberada, tornando-se, portanto, natural com a colabora√ß√£o consciente dos governos nacionais e locais.  
Segundo Wanderley (1999: 20-21) existem conceitos que comp√µem o universo em que pobreza e exclus√£o n√£o podem ser tomadas como sin√¥nimos. Estes conceitos surgem de diferentes formas, √© a *desqualifica√ß√£o*, a *desinser√ß√£o*, a *desafilia√ß√£o*, e a *aparta√ß√£o social*. A *desqualifica√ß√£o* est√° relacionada ao fracasso da integra√ß√£o, √© o indiv√≠duo respons√°vel pela n√£o inser√ß√£o. Em nosso pa√≠s existem representa√ß√µes sociais que afirmam que o jovem n√£o aprende, pois √© malandro, pregui√ßoso, portanto est√° desqualificado a entrar no mercado de trabalho. Este conceito exige que o Estado crie pol√≠ticas de inser√ß√£o social. A *desinser√ß√£o* est√° associada aos valores de uma determinada sociedade, s√£o fatores simb√≥licos que definem quem est√° fora da norma, quem n√£o tem utilidade social. torna-se *her√≥i*, escreve livro e demonstra o quanto o Estado d√° oportunidades iguais, portanto, negro, pobre at√© podem cursar o ensino superior. A *desafilia√ß√£o* significa a falta de pertencimento, de v√≠nculo social. S√£o rupturas em rela√ß√£o a estados de equil√≠brio anteriores, √© a aus√™ncia de v√≠nculos em estruturas que tem sentido. E a *aparta√ß√£o social* √© aquele conceito que entende o outro como um ser √† parte, n√£o apenas como um desigual, mas como um n√£o semelhante, um ser exclu√≠do dos bens de consumo, dos servi√ßos, da educa√ß√£o etc. √â um fen√¥meno que justifica a falta de pol√≠ticas estatais, a cria√ß√£o de grupos de exterm√≠nio etc.

Xiberras (1993:19) enfatiza que existem diferentes processos que levam a exclus√£o e que *existem formas de exclus√£o vis√≠veis e outras apenas percept√≠veis, porque n√£o excluem nem materialmente, nem simbolicamente: os exclu√≠dos est√£o simplesmente ausentes ou invis√≠veis.*	

      √â esta invisibilidade que faz com que no Brasil, muitas crian√ßas e adolescentes, cometam atos infracionais, pois perderam sua identidade. 

Na mesma linha de pensamento, Bauman (2004) afirma que a crise da identidade est√° ligada n√£o s√≥ ao processo da Globaliza√ß√£o, mas ao esvaziamento das institui√ß√µes democr√°ticas e a privatiza√ß√£o da esfera p√∫blica. A pol√≠tica da identidade justifica a exclus√£o, portanto a ideia de pertencimento n√£o est√° s√≥lida e n√£o √© garantida para toda a vida. O que parece estar em jogo √© a ideia de direitos, ou processo de acesso √† cidadania, em uma sociedade que sempre viveu √† merc√™ de mandat√°rios, l√≠deres populistas e autorit√°rios.

A democracia pressup√µe que os direitos do cidad√£o sejam assegurados. Ao mesmo tempo pensar em democracia significa pensar em direitos e possibilidades iguais.  Faoro (1982) salienta a import√¢ncia da distin√ß√£o entre a legalidade e a legitimidade no governo das leis do Estado de Direito, pois o poder, no momento em que transp√µe o Estado, qualifica-o pelo direito ao disciplinar a for√ßa por meio de regras jur√≠dicas formalmente reconhecidas como lei. 

O poder vem do alto, de uma minoria da sociedade, enquanto a legitimidade vem de baixo, atrav√©s do reconhecimento em torno de valores. A legitimidade n√£o se dilui na legalidade, pois se a primeira estivesse contida na segunda, desapareceria a participa√ß√£o ativa e a resist√™ncia poss√≠vel √†s leis que negassem os fundamentos da democracia. Estados totalit√°rios podem converter-se semanticamente em Estados de Direito por governarem por meios de leis votadas por corpos coletivos. A legitimidade funda-se em valores nos quais ancora-se a democracia. A concep√ß√£o de Estado Democr√°tico de Direito tem como fundamento √† cidadania, na qual todos os indiv√≠duos seriam iguais, com direitos e deveres a cumprir. Somado a isso o direito √° cidade, ao espa√ßo p√∫blico, √† informa√ß√£o, entre tantos outros. Como priorizar direitos se todos s√£o b√°sicos para a vida?

O protesto da popula√ß√£o em estado de rua, come√ßa quando os atos de viol√™ncia se acirram essa popula√ß√£o come√ßa a se organizar como coletivo da repercuss√£o de atos de viol√™ncia repetitivos em rela√ß√£o a estes. O assassinato do √≠ndio patax√≥ Galdino em 1997 por filhos da alta sociedade em Bras√≠lia, do qual decorre a primeira Marcha do Povo na Rua em 2001 e a chacina na pra√ßa da S√© em 2004 em que 15 pessoas sofreram viol√™ncia extrema das quais sete morreram assassinados tem como resultado protestos dos quais decorre em 2005 acontece o I Encontro Nacional da Popula√ß√£o em situa√ß√£o de rua. A partir daqui o movimento passa a reivindicar pol√≠ticas de atendimentos.

Segundo o Instituto de Pesquisa Econ√¥mica Aplicada- IPEA em sua publica√ß√£o preliminar ‚ÄúEstimativa da Popula√ß√£o em Situa√ß√£o de Rua no Brasil (2012-2022), a popula√ß√£o em situa√ß√£o de rua no Brasil em 2022 atingiu 281.472 pessoas. Em uma d√©cada o crescimento dessa popula√ß√£o foi de 211 por cento.

A prefeitura de Campinas contabilizou em 2021, 932 pessoas em situa√ß√£o de rua, por√©m n√£o podemos esquecer que a invisibilidade social desta popula√ß√£o n√£o permite que a contagem seja exata (Prefeitura de Campinas-portal.campinas.sp.gov.br- 29-12-2021).  

No ano de 2009 foi realizado o II Encontro da Popula√ß√£o em Situa√ß√£o de Rua tendo como consequ√™ncia a aprova√ß√£o ainda neste ano da Resolu√ß√£o n√∫mero 109, de 11 de novembro de 2009\.

Em junho de 2016 aconteceu a funda√ß√£o do movimento em Campinas, embora as articula√ß√µes e demandas j√° ocorressem. A cidade mant√©m, hoje, v√°rias a√ß√µes para acolher e promover a autonomia desta popula√ß√£o.

* SOS Rua- servi√ßo de abordagem social da rua com equipes que percorrem diariamente toda a cidade oferecendo abrigo e servi√ßos p√∫blicos a essa popula√ß√£o. Distribuem cobertores, roupas e kits de higiene, al√©m de orientar sobre vacina√ß√£o. Fazem cerca de 1,8 mil abordagens mensais.

* M√£o Amiga- tem como objetivo a reinser√ß√£o social por meio da qualifica√ß√£o profissional de pessoas em situa√ß√£o de rua, o M√£o Amiga oferece, durante o curso, uma bolsa de 277 UFICs, o que equivale a R$ 1240,96, e dura de 12 aa 24 meses. Existe desde 2016 e j√° se formaram 97 pessoas em jardinagem e paisagismo e 22 em auxiliar de veterin√°ria.

* Bagageiro Municipal- Atende mensalmente, em torno de, 1,8 mil bagagens. Foi inaugurado em 2020 no bairro Vila Industrial e contribui para diminuir a perda de documentos e outros objetos pessoais.

* Opera√ß√£o ‚ÄúAmigos no trecho‚Äù \- √â um servi√ßo inaugurado em 2021 que identifica morador em situa√ß√£o de rua nas estradas e oferece acolhimento no albergue municipal. Envolve a secretaria Municipal dos Transportes, da Pessoa com Defici√™ncia, a dos Direitos Humanos, a Pol√≠cia Rodovi√°ria e as concession√°rias que administram as estradas.

* Distribui√ß√£o de refei√ß√µes ‚Äì Cerca de 20 mil refei√ß√µes por m√™s s√£o distribu√≠das tanto para pessoas em situa√ß√£o de rua como para quem necessitar. Bom prato a noite e Casa da Cidadania de dia.

* Rec√¢mbio ‚Äì O Rec√¢mbio de Migrantes √© um programa da SMASDH cujo prop√≥sito √© garantir o retorno seguro de pessoas socialmente vulner√°veis a seus locais de origem. Nos √∫ltimos 2 anos de 2021 e 2022, foram 911 pessoas beneficiadas pelo programa.

* Centros POP Sares unidade 1 e unidade 2 ‚Äì Atendimento especializado para pessoas em situa√ß√£o de rua. Oferecem acolhida, escuta qualificada, orienta√ß√£o para documenta√ß√£o, incentivo √† participa√ß√£o social e a defesa de direitos, oferta a cuidados de higiene, vestu√°rio e alimenta√ß√£o entre outros. Este servi√ßo n√£o oferece abrigo.

* Casas de Passagem ‚Äì Existem 3 abrigos masculinos, 1 feminino, e um albergue situado na Vila Industrial, com 100 vagas (10 femininas, 10 para m√£es com crian√ßas, 4 para pessoas trans e 76 para homens). A Casa da Cidadania conta com mais 20 vagas para homens e mais 4 abrigos que totalizam 85 vagas.

* Consult√≥rio na Rua ‚Äì A secretaria Municipal de Sa√∫de mant√©m o Consult√≥rio na Rua por meio de um ve√≠culo adaptado que percorre diversas √°reas da cidade oferecendo cuidados em sa√∫de. Tem 2 equipes multidisciplinares cujo foco √© voltado as doen√ßas que mais acometem a popula√ß√£o. Realiza curativos, testes etc. S√£o realizadas a√ß√µes conjuntas entre o SOS rua e o Consult√≥rio de rua em regi√µes nas quais existem muita depend√™ncia qu√≠mica.

* Combate ao Trabalho Infantil ‚Äì de novembro de 2011 a dezembro de 2022 mais de 4,5 mil crian√ßas e adolescentes foram abordados em situa√ß√£o de trabalho infantil.

**C√ÅRITAS** 

Na linha de atua√ß√£o das Pastorais e das Comunidades Eclesiais de Base, nos anos 1980 os agentes C√°ritas (embora j√° estivessem atuando no Brasil desde 1956), renovam sua metodologia de a√ß√£o e passa nos anos 1990 a atuar com projetos alternativos comunit√°rios, assumindo assim uma lideran√ßa ativa no conjunto das pastorais sociais (caritasriopreto.org.br-11/08/2022). A Caritas no seu trabalho de apoio a a√ß√£o libertadora, na qual a popula√ß√£o busque a autonomia em apoio as iniciativas populares, funda em Campinas diversas casas de passagem que a popula√ß√£o em situa√ß√£o de rua possa se organizar e tenha a autonomia necess√°ria para construir seu caminho. 

Partindo do pressuposto de que s√≥ a a√ß√£o, conforme Paulo Freire (Educa√ß√£o como pr√°tica da liberdade, 1987), a partir da tomada de consci√™ncia da realidade, liberta, proporcionar√° a autonomia necess√°ria para a constru√ß√£o de outra sociedade. √â na a√ß√£o com a realidade, com a sociedade que se pode ver suas contradi√ß√µes. A popula√ß√£o em situa√ß√£o de rua surge de uma sociedade opressora e se faz necess√°rio que esta popula√ß√£o retome seu rumo e n√£o fique √† merc√™ dos. √â a apropria√ß√£o das pol√≠ticas p√∫blicas que j√° existem e a cria√ß√£o de outras (se necess√°rio), que possibilitar√° que a voz da rua venha √† tona.

O **Caritas** em convenio com a prefeitura de Campinas acolhe em **Abrigos** 85 pessoas em situa√ß√£o de rua, a saber: Casa S√£o Francisco- 20 vagas, Ant√¥nio Fernando ‚Äì 20 vagas, Juninho- 20 vagas, Santa Clara- 25 vagas; **Casa de Passagem**, Efraim 20 vagas e Nossa Casa, 20 vagas; **Provis√≥rio,** Casa Santa Dulce, 40 vagas.

**2- Objetivo**

A partir do momento que o p√∫blico-alvo deste projeto √© a popula√ß√£o em situa√ß√£o de rua, o **objetivo** deste projeto √© assegurar que esta popula√ß√£o conhe√ßa seus direitos e lute para que sejam assegurados. Para isso se faz necess√°rio uma conscientiza√ß√£o do que existe na rede p√∫blica possibilitando sua reapropria√ß√£o do espa√ßo e sua consequente emancipa√ß√£o pol√≠tica.

**3- Metodologia**

A **metodologia** ser√° baseada em pesquisa participante e de campo, no qual um n√∫mero de pessoas se aprofunda em um determinado tema, sob a coordena√ß√£o de um ou mais moderadores. O objetivo ser√° sempre o de escutar as demandas da popula√ß√£o em situa√ß√£o de rua. Os principais atores deste trabalho s√£o aqueles que ir√£o se apropriar desta metodologia e repassar o que apreenderam aos seus companheiros e companheiras. Nosso intuito √© o de que cada pessoa que participe deste projeto seja um cr√≠tico da sua hist√≥ria e da sociedade. 

Os temas devem estar relacionados aos direitos estabelecidos na **Constitui√ß√£o Federal de 1988** e o decreto **n. 7 de 23 de dezembro de 2009** que institui a **pol√≠tica Nacional para a popula√ß√£o em situa√ß√£o de rua e outros que possam surgir a partir das necessidades do grupo.**

**Proposta de trabalho em cada modulo:** 

Cada m√≥dulo ter√° como suporte como instrumentos de aprendizagem m√∫sicas, filmes, 

¬†  
**M√≥dulo 1: Entendendo os Direitos Humanos**

Defini√ß√£o de direitos humanos  
A import√¢ncia dos direitos humanos para a popula√ß√£o em situa√ß√£o de rua  
Viola√ß√µes de direitos humanos contra a popula√ß√£o em situa√ß√£o de rua

**M√≥dulo 2: Acesso a Servi√ßos e Dispositivos**

Compreendendo os servi√ßos e dispositivos dispon√≠veis para a popula√ß√£o em situa√ß√£o de rua.  
Como acessar esses servi√ßos e dispositivos  
A import√¢ncia desses servi√ßos e dispositivos

 Sa√∫de  
\- Redes de apoio da sa√∫de para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Acesso aos servi√ßos de sa√∫de  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de sa√∫de e simula√ß√£o de atendimento

Seguran√ßa  
\- Redes de apoio da seguran√ßa para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Acesso aos servi√ßos de seguran√ßa  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de seguran√ßa e simula√ß√£o de atendimento

Direitos Humanos  
\- Direitos humanos e a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Redes de apoio dos direitos humanos para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de direitos humanos e simula√ß√£o de atendimento

**M√≥dulo 3: Organizando a Popula√ß√£o em Situa√ß√£o de Rua**

Estrat√©gias de organiza√ß√£o da popula√ß√£o em situa√ß√£o de rua  
Como usar os servi√ßos e dispositivos dispon√≠veis para promover a organiza√ß√£o  
O papel do Estado na promo√ß√£o da organiza√ß√£o

**M√≥dulo 4: Advocacia e viola√ß√µes dos direitos humanos**

Estrat√©gias de advocacia para a promo√ß√£o dos direitos humanos  
Como denunciar viola√ß√µes de direitos humanos  
O papel do Estado na preven√ß√£o das viola√ß√µes dos direitos humanos

**M√≥dulo 5: Projeto Final**

Os alunos criar√£o um projeto que demonstra sua compreens√£o do conte√∫do do curso, no qual dever√° propor estrat√©gias de promo√ß√£o dos direitos humanos e organiza√ß√£o da popula√ß√£o em situa√ß√£o de rua.

**M√©todos de avalia√ß√£o**

**Testes no final de cada m√≥dulo**  
**Projeto final**  
**Linha do tempo**

**Conclus√£o, revis√£o do curso,** **Sess√£o de feedback.**

**Bibliografia citada**

* BAUMAN, Z.- **Identidade**, Rio de Janeiro, Zahar Editores, 2005  
* FREIRE, P. ‚Äì **A Educa√ß√£o como Pr√°tica de Liberdade**  
* GOHN, M. da G.- **Ativismos no Brasil.** Movimentos sociais, coletivos e organiza√ß√µes civis. Como impactam e por que importam?  
* PREFEITURA DE CAMPINAS- portal.campinas.sp.gov.br- 29-12-2021  
* SANTOS, M.- **Por uma outra Globaliza√ß√£o: do pensamento √∫nico √† consci√™ncia universal.** 13¬™ edi√ß√£o Rio de Janeiro, Record, 2006\.  
* KLAUMANN, A da R.- **Um enfoque hist√≥rico e socioassistencial da popula√ß√£o em situa√ß√£o de rua no Brasil.** A realidade do Centro POP de Rio do Sul-SC  
* XIBERRAS, M.- **As teorias da exclus√£o. Para uma constru√ß√£o do imagin√°rio do desvio,** Lisboa, Instituto Piaget, 1993\.


**Financiamento**

Tempo de dura√ß√£o- cada curso deve durar 16 horas.

Equipe- A equipe ser√° composta por dois coordenadores e dois educadores sociais.

Recursos- uma sala para 20 alunos, um retroprojetor, internet, uma caixa de som, papel sulfite, cartolina, tesoura, caneta hidrocor, l√°pis de cera, bexiga. Coffe break,

Transporte,
</file>

<file path="Architecture_Map.md">
.
./src
./src/shared
./src/services
./src/services/telemetry.ts
./src/hooks
./src/hooks/useEventEngine.ts
./src/hooks/useTelemetry.ts
./src/auth.ts
./src/store
./src/store/playerStore.ts
./src/app
./src/app/test-features
./src/app/test-features/page.tsx
./src/app/recursos
./src/app/recursos/page.tsx
./src/app/layout.tsx
./src/app/api
./src/app/api/gemini
./src/app/api/auth
./src/app/api/chat
./src/app/sobre
./src/app/sobre/page.tsx
./src/app/favicon.ico
./src/app/globals.css
./src/app/apoie
./src/app/apoie/page.tsx
./src/app/jogar
./src/app/jogar/page.tsx
./src/app/page.tsx
./src/contexts
./src/contexts/ServicesContext.tsx
./src/lib
./src/lib/utils.ts
./src/features
./src/features/ui
./src/features/ui/SurvivalToggle.tsx
./src/features/ui/GameHUD.tsx
./src/features/ui/GameChat.tsx
./src/features/ui/LandingPage.tsx
./src/features/ui/SurvivalModeContext.tsx
./src/features/ui/index.ts
./src/features/ui/DilemmaModal.tsx
./src/features/survival-map
./src/features/survival-map/index.ts
./src/features/survival-map/SurvivalMap.tsx
./src/features/survival-map/MapCore.tsx
./src/features/survival-map/NearbyList.tsx
./src/features/offline-db
./src/features/offline-db/useOfflineDB.ts
./src/features/offline-db/index.ts
./src/features/offline-db/db.ts
./src/features/game-loop
./src/features/game-loop/dilemmas.ts
./src/features/game-loop/index.ts
./src/features/game-loop/store.ts
./src/features/game-loop/useGameLoop.ts
./src/components
./src/components/ui
./src/components/ui/EcoCard.tsx
./src/components/ui/button.tsx
./src/components/ui/dialog.tsx
./src/components/ui/card.tsx
./src/components/ui/progress.tsx
./src/components/ui/input.tsx
./src/components/ui/EcoButton.tsx
./package.json
./next.config.ts
./eslint.config.mjs
./package-lock.json
./tsconfig.json
./README.md
./postcss.config.mjs
./components.json
./Architecture_Map.md
./next-env.d.ts
./biome.json
./Avalia√ß√£o e Melhorias de Projeto de Jogo.md
./public
./public/vercel.svg
./public/globe.svg
./public/file.svg
./public/window.svg
./public/next.svg
./public/data
./public/data/services-campinas.json
./scripts
./scripts/verify-structure.js
</file>

<file path="Core_Mechanics.md">
import type { GameState } from "./store";

export type TriggerType = "HUNGER_LOW" | "HYGIENE_LOW" | "RANDOM";

export interface DilemmaOption {
	label: string;
	consequence: string;
	effect: Partial<Omit<GameState, "actions" | "inventory" | "day" | "time">>;
}

export interface Dilemma {
	id: string;
	title: string;
	description: string;
	trigger: {
		type: TriggerType;
		value: number;
	};
	options: DilemmaOption[];
}

export const GAME_DILEMMAS: Dilemma[] = [
	{
		id: "hunger-emergency",
		title: "Fome Apertando",
		description:
			"O dia est√° acabando e sua barriga d√≥i de fome. Voc√™ precisa encontrar algo para comer logo ou sua sa√∫de come√ßar√° a declinar rapidamente.",
		trigger: { type: "HUNGER_LOW", value: 30 },
		options: [
			{
				label: "Ir ao Bom Prato (R$ 1)",
				consequence:
					"O Bom Prato √© uma rede de restaurantes populares em S√£o Paulo/Campinas que garante alimenta√ß√£o de qualidade por um pre√ßo simb√≥lico. Voc√™ comeu bem e economizou.",
				effect: { hunger: 80, money: -1 },
			},
			{
				label: "Comprar Salgado na Rua (R$ 5)",
				consequence:
					"Comprar comida de rua √© mais r√°pido, mas muito mais caro para quem n√£o tem renda fixa. Voc√™ gastou quase tudo o que tinha.",
				effect: { hunger: 40, money: -5 },
			},
			{
				label: "Pedir Ajuda na Pra√ßa",
				consequence:
					"Pedir ajuda √© um direito, mas a constante exposi√ß√£o e o estigma podem afetar seu bem-estar emocional e sanidade ao longo do tempo.",
				effect: { hunger: 20, sanity: -10 },
			},
		],
	},
	{
		id: "hygiene-crisis",
		title: "A Necessidade do Banho",
		description:
			"Voc√™ n√£o toma um banho completo h√° dias. O cansa√ßo f√≠sico e o desconforto est√£o come√ßando a afetar sua disposi√ß√£o e como as pessoas interagem com voc√™.",
		trigger: { type: "HYGIENE_LOW", value: 20 },
		options: [
			{
				label: "Procurar Centro Pop",
				consequence:
					"Os Centros Pop s√£o unidades p√∫blicas onde √© poss√≠vel tomar banho, lavar roupas e receber atendimento social. Voc√™ se sente renovado e recebeu um kit de higiene.",
				effect: { hygiene: 90, sanity: 5 },
			},
			{
				label: "Usar Chafariz/Rio",
				consequence:
					"Banhar-se em locais p√∫blicos impr√≥prios pode expor voc√™ a doen√ßas e √© perigoso. Sua higiene melhorou pouco e sua sa√∫de sofreu.",
				effect: { hygiene: 30, health: -10 },
			},
		],
	},
	{
		id: "social-approach",
		title: "Abordagem na Pra√ßa",
		description:
			"Um educador social do coletivo 'A Rua Tem Voz' se aproxima com um sorriso, oferecendo informa√ß√µes sobre seus direitos e servi√ßos dispon√≠veis na cidade.",
		trigger: { type: "RANDOM", value: 0.1 },
		options: [
			{
				label: "Ouvir e fazer o cadastro",
				consequence:
					"Estar documentado e cadastrado em redes de apoio √© o primeiro passo para a autonomia. Voc√™ agora sabe onde buscar ajuda jur√≠dica e documenta√ß√£o.",
				effect: { sanity: 10 },
			},
		],
	},
];
import { create } from "zustand";
import { persist, createJSONStorage } from "zustand/middleware";

export interface GameState {
	// Atributos de Sobreviv√™ncia (0-100)
	health: number;
	hunger: number;
	hygiene: number;
	sanity: number;
	energy: number;

	// Recursos
	money: number;
	inventory: string[];

	// Tempo
	day: number;
	time: number; // 0-24h
	resolvedDilemmas: string[];

	// A√ß√µes
	actions: {
		modifyStat: (
			stat: keyof Omit<GameState, "actions" | "inventory" | "day" | "time" | "resolvedDilemmas">,
			amount: number,
		) => void;
		addMoney: (amount: number) => void;
		advanceTime: (hours: number) => void;
		markDilemmaResolved: (id: string) => void;
		resetGame: () => void;
	};
}

const INITIAL_STATE = {
	health: 100,
	hunger: 100, // 100 = Cheio, 0 = Fome
	hygiene: 50, // Come√ßa sujo
	sanity: 80,
	energy: 100,
	money: 0,
	inventory: [],
	resolvedDilemmas: [],
	day: 1,
	time: 8, // Come√ßa √†s 8h
};

export const useGameStore = create<GameState>()(
	persist(
		(set) => ({
			...INITIAL_STATE,

			actions: {
				markDilemmaResolved: (id) =>
					set((state) => ({
						resolvedDilemmas: [...state.resolvedDilemmas, id],
					})),
				modifyStat: (stat, amount) =>
					set((state) => {
						const newValue = Math.max(
							0,
							Math.min(100, (state[stat] as number) + amount),
						);
						// Se Fome zerar, Sa√∫de cai
						if (stat === "hunger" && newValue === 0) {
							return { [stat]: newValue, health: Math.max(0, state.health - 5) };
						}
						return { [stat]: newValue };
					}),
				addMoney: (amount) => set((state) => ({ money: state.money + amount })),
				advanceTime: (hours) =>
					set((state) => {
						let newTime = state.time + hours;
						let newDay = state.day;

						if (newTime >= 24) {
							newTime -= 24;
							newDay += 1;
						}

						return { time: newTime, day: newDay };
					}),
				resetGame: () => set(INITIAL_STATE),
			},
		}),
		{
			name: "pop-rua-save-v1",
			storage: createJSONStorage(() => localStorage),
			partialize: (state) =>
				Object.fromEntries(
					Object.entries(state).filter(([key]) => key !== "actions"),
				) as GameState,
		},
	),
);

export const useGameActions = () => useGameStore((state) => state.actions);
import { useEffect } from "react";
import { useGameStore } from "./store";

export function useGameLoop() {
	const modifyStat = useGameStore((state) => state.actions.modifyStat);
	const health = useGameStore((state) => state.health);

	useEffect(() => {
		// Loop de decad√™ncia passiva a cada 10 segundos na vida real (simula passagem do tempo)
		// No produto final, isso ser√° atrelado a a√ß√µes, n√£o apenas tempo real.
		const interval = setInterval(() => {
			// Se sa√∫de zerar, game over (aqui s√≥ para de drenar)
			if (health <= 0) return;

			modifyStat("hunger", -1); // Fome aumenta (valor desce)
			modifyStat("hygiene", -0.5); // Fica sujo
			modifyStat("energy", -0.5); // Cansa
		}, 10000);

		return () => clearInterval(interval);
	}, [modifyStat, health]);
}
import { create } from "zustand";
import { TelemetryAction, telemetryService } from "@/services/telemetry";

export interface Item {
	id: string;
	name: string;
	value: number;
}

interface PlayerState {
	hunger: number;
	health: number;
	cash: number;
	inventory: Item[];

	// Actions
	eat: (amount: number) => void;
	sleep: (isSafe: boolean) => void;
	work: (hours: number) => void;
	addToInventory: (item: Item) => void;
	removeFromInventory: (itemId: string) => void;
}

export const usePlayerStore = create<PlayerState>((set, get) => ({
	hunger: 50,
	health: 80,
	cash: 10.0,
	inventory: [],

	eat: (amount: number) => {
		set((state) => {
			const newHunger = Math.min(100, state.hunger + amount);
			return { hunger: newHunger };
		});
	},

	sleep: (isSafe: boolean) => {
		if (!isSafe) {
			telemetryService.track(TelemetryAction.GAME_EVENT, {
				type: "RISKY_SLEEP",
				hunger: get().hunger,
				health: get().health,
			});
		}

		set((state) => {
			// Sleep restores health but reduces hunger slightly over time (implied)
			// For simplicity here: +20 health, -10 hunger
			const newHealth = Math.min(100, state.health + 20);
			const newHunger = Math.max(0, state.hunger - 10);

			// If risky sleep, chance of losing items or health hurt?
			// Requirement says just track action for now.
			// We can add a small penalty for risky sleep logic if implied,
			// but user only asked for "dispare trackAction".

			if (newHunger === 0) {
				telemetryService.track(TelemetryAction.GAME_EVENT, {
					type: "GAME_OVER_HUNGER",
				});
			}

			return { health: newHealth, hunger: newHunger };
		});
	},

	work: (hours: number) => {
		set((state) => {
			// Work: +Cash, -Hunger, -Health (maybe)
			// arbitrary balance: 10 cash/hour, -5 hunger/hour
			const earned = hours * 10;
			const hungerCost = hours * 5;

			const newCash = state.cash + earned;
			const newHunger = Math.max(0, state.hunger - hungerCost);

			if (newHunger === 0) {
				telemetryService.track(TelemetryAction.GAME_EVENT, {
					type: "GAME_OVER_HUNGER",
				});
			}

			return { cash: newCash, hunger: newHunger };
		});
	},

	addToInventory: (item: Item) => {
		set((state) => ({ inventory: [...state.inventory, item] }));
	},

	removeFromInventory: (itemId: string) => {
		set((state) => ({
			inventory: state.inventory.filter((i) => i.id !== itemId),
		}));
	},
}));
"use client";

import L from "leaflet";
import { useEffect } from "react";
import { MapContainer, Marker, Popup, TileLayer, useMap } from "react-leaflet";

// Fix for default marker icon
// @ts-expect-error
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
	iconRetinaUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
	iconUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom Icons
const UserIcon = new L.Icon({
	iconUrl:
		"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
	iconSize: [25, 41],
	iconAnchor: [12, 41],
	popupAnchor: [1, -34],
	shadowSize: [41, 41],
});

const ResourceIcon = new L.Icon({
	iconUrl:
		"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",
	shadowUrl:
		"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
	iconSize: [25, 41],
	iconAnchor: [12, 41],
	popupAnchor: [1, -34],
	shadowSize: [41, 41],
});

function MapController({ center }: { center: [number, number] }) {
	const map = useMap();
	useEffect(() => {
		if (center) {
			map.flyTo(center, 15);
		}
	}, [center, map]);
	return null;
}

interface MapCoreProps {
	userPosition: [number, number] | null;
	resources: {
		id: string | number;
		name: string;
		type: string;
		lat: number;
		lng: number;
	}[];
}

export default function MapCore({ userPosition, resources }: MapCoreProps) {
	// Default to Campinas center if no user position
	const defaultPosition: [number, number] = [-22.90556, -47.06083];
	const initialPosition = userPosition || defaultPosition;

	return (
		<MapContainer
			center={initialPosition}
			zoom={13}
			scrollWheelZoom={true}
			className="h-full w-full z-0"
		>
			<TileLayer
				attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
				url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
			/>

			<MapController center={initialPosition} />

			{/* User Marker */}
			{userPosition && (
				<Marker position={userPosition} icon={UserIcon}>
					<Popup>
						<strong>Voc√™ est√° aqui</strong>
					</Popup>
				</Marker>
			)}

			{/* Resources Markers */}
			{resources.map((res) => (
				<Marker key={res.id} position={[res.lat, res.lng]} icon={ResourceIcon}>
					<Popup>
						<strong>{res.name}</strong>
						<br />
						<span className="text-xs text-gray-600">{res.type}</span>
					</Popup>
				</Marker>
			))}
		</MapContainer>
	);
}
"use client";

import dynamic from "next/dynamic";
import { useEffect, useState } from "react";
import { useServices } from "@/contexts/ServicesContext";
import { NearbyList } from "./NearbyList";

const MapCore = dynamic(() => import("./MapCore"), {
	loading: () => <p className="text-center p-10">Carregando mapa interativo...</p>,
	ssr: false,
});

export function SurvivalMap() {
	const [userPosition, setUserPosition] = useState<[number, number] | null>(
		null,
	);
	const [loadingLocation, setLoadingLocation] = useState(false);

	// Use ServicesContext for real data
	const { services } = useServices();

	// Map services to resources format expected by MapCore (splitting coords [lat, lng] -> lat, lng)
	const resources = services.map((s) => ({
		id: s.id,
		name: s.name,
		type: s.type,
		lat: s.coords[0],
		lng: s.coords[1],
	}));

	useEffect(() => {
		setLoadingLocation(true);
		if ("geolocation" in navigator) {
			navigator.geolocation.getCurrentPosition(
				(position) => {
					setUserPosition([
						position.coords.latitude,
						position.coords.longitude,
					]);
					setLoadingLocation(false);
				},
				(error) => {
					console.error("Erro de geolocaliza√ß√£o:", error);
					setLoadingLocation(false);
				},
			);
		} else {
			setLoadingLocation(false);
		}
	}, []);


	return (
		<div className="flex flex-col h-full w-full bg-slate-100">
			<div className="relative w-full h-[55%] flex-none border-b-2 border-slate-200 shadow-inner overflow-hidden">
				{loadingLocation && (
					<div className="absolute top-2 right-2 z-[1000] bg-white/90 px-3 py-1 rounded-full shadow text-xs font-bold text-blue-600 animate-pulse">
						Buscando sua localiza√ß√£o...
					</div>
				)}

				{/* Floating SOS Button */}
				<a
					href={`https://wa.me/?text=SOS! Estou em situa√ß√£o de emerg√™ncia. Minha localiza√ß√£o aproximada: ${userPosition ? `${userPosition[0]},${userPosition[1]}` : "Desconhecida"}`}
					target="_blank"
					rel="noopener noreferrer"
					className="absolute top-4 left-4 z-[1000] bg-red-600 text-white font-bold px-4 py-2 rounded-full shadow-lg hover:bg-red-700 transition-transform hover:scale-105 flex items-center gap-2"
				>
					üö® SOS EMERG√äNCIA
				</a>

				<MapCore userPosition={userPosition} resources={resources} />
			</div>

			{/* Nearby List Area - Scrollable */}
			<div className="flex-1 overflow-y-auto p-4 bg-slate-900 border-t border-slate-800">
				<NearbyList userPosition={userPosition} />
			</div>
		</div>
	);
}
</file>

<file path="Narrative_DB.md">
import type { GameState } from "./store";

export type TriggerType = "HUNGER_LOW" | "HYGIENE_LOW" | "RANDOM";

export interface DilemmaOption {
	label: string;
	consequence: string;
	effect: Partial<Omit<GameState, "actions" | "inventory" | "day" | "time">>;
}

export interface Dilemma {
	id: string;
	title: string;
	description: string;
	trigger: {
		type: TriggerType;
		value: number;
	};
	options: DilemmaOption[];
}

export const GAME_DILEMMAS: Dilemma[] = [
	{
		id: "hunger-emergency",
		title: "Fome Apertando",
		description:
			"O dia est√° acabando e sua barriga d√≥i de fome. Voc√™ precisa encontrar algo para comer logo ou sua sa√∫de come√ßar√° a declinar rapidamente.",
		trigger: { type: "HUNGER_LOW", value: 30 },
		options: [
			{
				label: "Ir ao Bom Prato (R$ 1)",
				consequence:
					"O Bom Prato √© uma rede de restaurantes populares em S√£o Paulo/Campinas que garante alimenta√ß√£o de qualidade por um pre√ßo simb√≥lico. Voc√™ comeu bem e economizou.",
				effect: { hunger: 80, money: -1 },
			},
			{
				label: "Comprar Salgado na Rua (R$ 5)",
				consequence:
					"Comprar comida de rua √© mais r√°pido, mas muito mais caro para quem n√£o tem renda fixa. Voc√™ gastou quase tudo o que tinha.",
				effect: { hunger: 40, money: -5 },
			},
			{
				label: "Pedir Ajuda na Pra√ßa",
				consequence:
					"Pedir ajuda √© um direito, mas a constante exposi√ß√£o e o estigma podem afetar seu bem-estar emocional e sanidade ao longo do tempo.",
				effect: { hunger: 20, sanity: -10 },
			},
		],
	},
	{
		id: "hygiene-crisis",
		title: "A Necessidade do Banho",
		description:
			"Voc√™ n√£o toma um banho completo h√° dias. O cansa√ßo f√≠sico e o desconforto est√£o come√ßando a afetar sua disposi√ß√£o e como as pessoas interagem com voc√™.",
		trigger: { type: "HYGIENE_LOW", value: 20 },
		options: [
			{
				label: "Procurar Centro Pop",
				consequence:
					"Os Centros Pop s√£o unidades p√∫blicas onde √© poss√≠vel tomar banho, lavar roupas e receber atendimento social. Voc√™ se sente renovado e recebeu um kit de higiene.",
				effect: { hygiene: 90, sanity: 5 },
			},
			{
				label: "Usar Chafariz/Rio",
				consequence:
					"Banhar-se em locais p√∫blicos impr√≥prios pode expor voc√™ a doen√ßas e √© perigoso. Sua higiene melhorou pouco e sua sa√∫de sofreu.",
				effect: { hygiene: 30, health: -10 },
			},
		],
	},
	{
		id: "social-approach",
		title: "Abordagem na Pra√ßa",
		description:
			"Um educador social do coletivo 'A Rua Tem Voz' se aproxima com um sorriso, oferecendo informa√ß√µes sobre seus direitos e servi√ßos dispon√≠veis na cidade.",
		trigger: { type: "RANDOM", value: 0.1 },
		options: [
			{
				label: "Ouvir e fazer o cadastro",
				consequence:
					"Estar documentado e cadastrado em redes de apoio √© o primeiro passo para a autonomia. Voc√™ agora sabe onde buscar ajuda jur√≠dica e documenta√ß√£o.",
				effect: { sanity: 10 },
			},
		],
	},
];
[
	{
		"id": "cp1",
		"name": "Centro Pop I",
		"type": "shelter",
		"coords": [-22.9153, -47.0658],
		"opening_hours": "08:00 - 17:00",
		"address": "Rua Jos√© Paes de Andrade, 1200 - Vila Brandina",
		"description": "Atendimento especializado para popula√ß√£o em situa√ß√£o de rua."
	},
	{
		"id": "cp2",
		"name": "Centro Pop II",
		"type": "shelter",
		"coords": [-22.9205, -47.0701],
		"opening_hours": "08:00 - 17:00",
		"address": "Rua Prof. Eurycledes de Jesus Zerbini, 100 - Jardim Regente",
		"description": "Servi√ßo de abordagem social e acolhimento."
	},
	{
		"id": "bp_centro",
		"name": "Bom Prato Centro",
		"type": "food",
		"coords": [-22.9102, -47.0605],
		"opening_hours": "10:30 - 14:00 (Almo√ßo), 17:00 - 18:00 (Jantar)",
		"address": "Av. Dr. Moraes Sales, 384 - Centro",
		"description": "Refei√ß√µes a R$ 1,00."
	}
]
import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default function SobrePage() {
	return (
		<div className="flex flex-col min-h-screen p-4 max-w-md mx-auto gap-4">
			<header className="flex items-center gap-2 mb-4">
				<Link href="/">
					<Button variant="ghost" size="icon">
						<ArrowLeft className="h-4 w-4" />
					</Button>
				</Link>
				<h1 className="text-xl font-bold">Sobre o Projeto</h1>
			</header>

			<article className="prose dark:prose-invert">
				<h3>A Invisibilidade √© uma Escolha?</h3>
				<p>
					Este n√£o √© apenas um jogo. √â uma ferramenta de{" "}
					<b>conscientiza√ß√£o e sobreviv√™ncia</b>.
				</p>
				<p>
					Baseado em dados reais da cidade de Campinas (SP), este aplicativo tem
					dois objetivos:
				</p>
				<ol>
					<li>
						<b>Para quem joga (Empatia):</b> Sentir na pele os dilemas di√°rios
						de quem vive na rua. Fome, frio, burocracia e olhares de julgamento.
					</li>
					<li>
						<b>Para quem vive (Utilidade):</b> Um mapa offline real com servi√ßos
						essenciais (Centro Pop, Bom Prato, Abrigos).
					</li>
				</ol>

				<div className="p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg my-4">
					<p className="text-sm font-bold">
						"N√£o olhe para o outro lado. Olhe nos olhos."
					</p>
				</div>

				<h4>Tecnologia Social</h4>
				<p className="text-sm">
					Desenvolvido como PWA (Progressive Web App) para rodar em qualquer
					celular, mesmo sem internet constante.
				</p>
			</article>

			<footer className="mt-8 text-center">
				<Link href="/apoie">
					<Button className="w-full">Seja um Apoiador</Button>
				</Link>
			</footer>
		</div>
	);
}
</file>

<file path="projeto teorico.md">
**A RUA TEM VOZ? 1**

DIREITOS HUMANOS PARA A POPULA√á√ÉO EM SITUA√á√ÉO DE RUA  
						

Daniel Arraes Reino

**Introdu√ß√£o**

O ano de 2023 para a popula√ß√£o em situa√ß√£o de rua parece promissor. Alguns compromissos assumidos publicamente pelo Estado t√™m repercutido em todo o territ√≥rio nacional. O Minist√©rio dos Direitos Humanos do ent√£o Governo Lula por meio de seu Ministro Silvio de Almeida junto ao Supremo Tribunal Federal, e do Desenvolvimento Social, Fam√≠lia e Combate √† Fome, Wellington Dias re√∫nem-se no dia 2 de julho do corrente ano em Bras√≠lia no intuito de pensar em uma pauta conjunta de a√ß√£o voltada a popula√ß√£o em situa√ß√£o de rua. Esta pauta surge ap√≥s a decis√£o do ministro do Supremo, Alexandre de Moraes, determinar o cumprimento de a√ß√µes voltadas a essa popula√ß√£o.

O abandono dado a esta popula√ß√£o, no que concerne a seus direitos, principalmente durante a pandemia (que no Brasil teve seu in√≠cio em 2020), consolidaram a ideia de que a sociedade brasileira afunila as desigualdades sociais, deixando a merc√™ da sorte os invis√≠veis, ou seja, os exclu√≠dos, aqueles a quem ela (a sociedade) n√£o quer ver, j√° que s√£o consequ√™ncia de sua pr√≥pria ina√ß√£o.  

A necessidade de assegurar os direitos voltados √† popula√ß√£o em situa√ß√£o de rua em uma sociedade desigual e injusta como a brasileira torna-se imediata. A den√∫ncia sobre pr√°ticas brutais cometidas contra os segmentos mais pobres da popula√ß√£o n√£o tem tido consequ√™ncias suficientes o que acaba por legitimar a omiss√£o de alguns, o medo de outros quanto a medidas alternativas que possam de fato, propor pol√≠ticas p√∫blicas que respeitem as necessidades locais. O abuso da seguran√ßa p√∫blica na retirada dos objetos pessoais, diariamente, dessa popula√ß√£o √© apontado como uma viol√™ncia institucionalizada em que o abuso de poder foi citado pelo ministro do STF- Superior Tribunal Federal, Alexandre de Moraes, em 25 de julho de 2023 e solicitado que fosse apresentado um plano de a√ß√£o e monitoramento para a implementa√ß√£o de uma pol√≠tica nacional para a popula√ß√£o em situa√ß√£o de rua.  
O neoliberalismo cujo modelo das privatiza√ß√µes adotado na Am√©rica Latina e no Brasil como modernizador, e a Globaliza√ß√£o excludente com seu desemprego estrutural veio aumentar a diferen√ßa entre ricos e pobres tornando o conceito de democracia e cidadania inofensivos em uma sociedade que se esvazia na privatiza√ß√£o de suas institui√ß√µes e na indiferen√ßa a fatos que tornam as crian√ßas, jovens e adultos que vivem na pobreza, nas ruas, no narcotr√°fico, e na prostitui√ß√£o ainda mais invis√≠veis.   
Al√©m disso, como bem afirma Gohn (2021:33) a pandemia desnudou a desigualdade existente tanto nos pa√≠ses ricos como nos pobres, ela desnaturalizou a pobreza e trouxe √† luz a vida cotidiana de milhares de invis√≠veis.  
Santos (2006), ao analisar as diversas formas de pobreza ou de d√≠vida social, vivida nos pa√≠ses subdesenvolvidos, enfatiza que no √∫ltimo meio s√©culo tiveram a pobreza inclu√≠da, ou seja, uma pobreza acidental que ocorre de tempos em tempos; uma segunda denominada marginalidade, produzida pelo processo econ√¥mico da divis√£o do trabalho; e o terceiro tipo que √© a pobreza estrutural que do ponto de vista moral e pol√≠tico equivale a uma d√≠vida social. A √∫ltima est√° diretamente ligada ao processo de globaliza√ß√£o, √© uma a√ß√£o deliberada, tornando-se, portanto, natural com a colabora√ß√£o consciente dos governos nacionais e locais.  
Segundo Wanderley (1999: 20-21) existem conceitos que comp√µem o universo em que pobreza e exclus√£o n√£o podem ser tomadas como sin√¥nimos. Estes conceitos surgem de diferentes formas, √© a *desqualifica√ß√£o*, a *desinser√ß√£o*, a *desafilia√ß√£o*, e a *aparta√ß√£o social*. A *desqualifica√ß√£o* est√° relacionada ao fracasso da integra√ß√£o, √© o indiv√≠duo respons√°vel pela n√£o inser√ß√£o. Em nosso pa√≠s existem representa√ß√µes sociais que afirmam que o jovem n√£o aprende, pois √© malandro, pregui√ßoso, portanto est√° desqualificado a entrar no mercado de trabalho. Este conceito exige que o Estado crie pol√≠ticas de inser√ß√£o social. A *desinser√ß√£o* est√° associada aos valores de uma determinada sociedade, s√£o fatores simb√≥licos que definem quem est√° fora da norma, quem n√£o tem utilidade social. torna-se *her√≥i*, escreve livro e demonstra o quanto o Estado d√° oportunidades iguais, portanto, negro, pobre at√© podem cursar o ensino superior. A *desafilia√ß√£o* significa a falta de pertencimento, de v√≠nculo social. S√£o rupturas em rela√ß√£o a estados de equil√≠brio anteriores, √© a aus√™ncia de v√≠nculos em estruturas que tem sentido. E a *aparta√ß√£o social* √© aquele conceito que entende o outro como um ser √† parte, n√£o apenas como um desigual, mas como um n√£o semelhante, um ser exclu√≠do dos bens de consumo, dos servi√ßos, da educa√ß√£o etc. √â um fen√¥meno que justifica a falta de pol√≠ticas estatais, a cria√ß√£o de grupos de exterm√≠nio etc.

Xiberras (1993:19) enfatiza que existem diferentes processos que levam a exclus√£o e que *existem formas de exclus√£o vis√≠veis e outras apenas percept√≠veis, porque n√£o excluem nem materialmente, nem simbolicamente: os exclu√≠dos est√£o simplesmente ausentes ou invis√≠veis.*	

      √â esta invisibilidade que faz com que no Brasil, muitas crian√ßas e adolescentes, cometam atos infracionais, pois perderam sua identidade. 

Na mesma linha de pensamento, Bauman (2004) afirma que a crise da identidade est√° ligada n√£o s√≥ ao processo da Globaliza√ß√£o, mas ao esvaziamento das institui√ß√µes democr√°ticas e a privatiza√ß√£o da esfera p√∫blica. A pol√≠tica da identidade justifica a exclus√£o, portanto a ideia de pertencimento n√£o est√° s√≥lida e n√£o √© garantida para toda a vida. O que parece estar em jogo √© a ideia de direitos, ou processo de acesso √† cidadania, em uma sociedade que sempre viveu √† merc√™ de mandat√°rios, l√≠deres populistas e autorit√°rios.

A democracia pressup√µe que os direitos do cidad√£o sejam assegurados. Ao mesmo tempo pensar em democracia significa pensar em direitos e possibilidades iguais.  Faoro (1982) salienta a import√¢ncia da distin√ß√£o entre a legalidade e a legitimidade no governo das leis do Estado de Direito, pois o poder, no momento em que transp√µe o Estado, qualifica-o pelo direito ao disciplinar a for√ßa por meio de regras jur√≠dicas formalmente reconhecidas como lei. 

O poder vem do alto, de uma minoria da sociedade, enquanto a legitimidade vem de baixo, atrav√©s do reconhecimento em torno de valores. A legitimidade n√£o se dilui na legalidade, pois se a primeira estivesse contida na segunda, desapareceria a participa√ß√£o ativa e a resist√™ncia poss√≠vel √†s leis que negassem os fundamentos da democracia. Estados totalit√°rios podem converter-se semanticamente em Estados de Direito por governarem por meios de leis votadas por corpos coletivos. A legitimidade funda-se em valores nos quais ancora-se a democracia. A concep√ß√£o de Estado Democr√°tico de Direito tem como fundamento √† cidadania, na qual todos os indiv√≠duos seriam iguais, com direitos e deveres a cumprir. Somado a isso o direito √° cidade, ao espa√ßo p√∫blico, √† informa√ß√£o, entre tantos outros. Como priorizar direitos se todos s√£o b√°sicos para a vida?

O protesto da popula√ß√£o em estado de rua, come√ßa quando os atos de viol√™ncia se acirram essa popula√ß√£o come√ßa a se organizar como coletivo da repercuss√£o de atos de viol√™ncia repetitivos em rela√ß√£o a estes. O assassinato do √≠ndio patax√≥ Galdino em 1997 por filhos da alta sociedade em Bras√≠lia, do qual decorre a primeira Marcha do Povo na Rua em 2001 e a chacina na pra√ßa da S√© em 2004 em que 15 pessoas sofreram viol√™ncia extrema das quais sete morreram assassinados tem como resultado protestos dos quais decorre em 2005 acontece o I Encontro Nacional da Popula√ß√£o em situa√ß√£o de rua. A partir daqui o movimento passa a reivindicar pol√≠ticas de atendimentos.

Segundo o Instituto de Pesquisa Econ√¥mica Aplicada- IPEA em sua publica√ß√£o preliminar ‚ÄúEstimativa da Popula√ß√£o em Situa√ß√£o de Rua no Brasil (2012-2022), a popula√ß√£o em situa√ß√£o de rua no Brasil em 2022 atingiu 281.472 pessoas. Em uma d√©cada o crescimento dessa popula√ß√£o foi de 211 por cento.

A prefeitura de Campinas contabilizou em 2021, 932 pessoas em situa√ß√£o de rua, por√©m n√£o podemos esquecer que a invisibilidade social desta popula√ß√£o n√£o permite que a contagem seja exata (Prefeitura de Campinas-portal.campinas.sp.gov.br- 29-12-2021).  

No ano de 2009 foi realizado o II Encontro da Popula√ß√£o em Situa√ß√£o de Rua tendo como consequ√™ncia a aprova√ß√£o ainda neste ano da Resolu√ß√£o n√∫mero 109, de 11 de novembro de 2009\.

Em junho de 2016 aconteceu a funda√ß√£o do movimento em Campinas, embora as articula√ß√µes e demandas j√° ocorressem. A cidade mant√©m, hoje, v√°rias a√ß√µes para acolher e promover a autonomia desta popula√ß√£o.

* SOS Rua- servi√ßo de abordagem social da rua com equipes que percorrem diariamente toda a cidade oferecendo abrigo e servi√ßos p√∫blicos a essa popula√ß√£o. Distribuem cobertores, roupas e kits de higiene, al√©m de orientar sobre vacina√ß√£o. Fazem cerca de 1,8 mil abordagens mensais.

* M√£o Amiga- tem como objetivo a reinser√ß√£o social por meio da qualifica√ß√£o profissional de pessoas em situa√ß√£o de rua, o M√£o Amiga oferece, durante o curso, uma bolsa de 277 UFICs, o que equivale a R$ 1240,96, e dura de 12 aa 24 meses. Existe desde 2016 e j√° se formaram 97 pessoas em jardinagem e paisagismo e 22 em auxiliar de veterin√°ria.

* Bagageiro Municipal- Atende mensalmente, em torno de, 1,8 mil bagagens. Foi inaugurado em 2020 no bairro Vila Industrial e contribui para diminuir a perda de documentos e outros objetos pessoais.

* Opera√ß√£o ‚ÄúAmigos no trecho‚Äù \- √â um servi√ßo inaugurado em 2021 que identifica morador em situa√ß√£o de rua nas estradas e oferece acolhimento no albergue municipal. Envolve a secretaria Municipal dos Transportes, da Pessoa com Defici√™ncia, a dos Direitos Humanos, a Pol√≠cia Rodovi√°ria e as concession√°rias que administram as estradas.

* Distribui√ß√£o de refei√ß√µes ‚Äì Cerca de 20 mil refei√ß√µes por m√™s s√£o distribu√≠das tanto para pessoas em situa√ß√£o de rua como para quem necessitar. Bom prato a noite e Casa da Cidadania de dia.

* Rec√¢mbio ‚Äì O Rec√¢mbio de Migrantes √© um programa da SMASDH cujo prop√≥sito √© garantir o retorno seguro de pessoas socialmente vulner√°veis a seus locais de origem. Nos √∫ltimos 2 anos de 2021 e 2022, foram 911 pessoas beneficiadas pelo programa.

* Centros POP Sares unidade 1 e unidade 2 ‚Äì Atendimento especializado para pessoas em situa√ß√£o de rua. Oferecem acolhida, escuta qualificada, orienta√ß√£o para documenta√ß√£o, incentivo √† participa√ß√£o social e a defesa de direitos, oferta a cuidados de higiene, vestu√°rio e alimenta√ß√£o entre outros. Este servi√ßo n√£o oferece abrigo.

* Casas de Passagem ‚Äì Existem 3 abrigos masculinos, 1 feminino, e um albergue situado na Vila Industrial, com 100 vagas (10 femininas, 10 para m√£es com crian√ßas, 4 para pessoas trans e 76 para homens). A Casa da Cidadania conta com mais 20 vagas para homens e mais 4 abrigos que totalizam 85 vagas.

* Consult√≥rio na Rua ‚Äì A secretaria Municipal de Sa√∫de mant√©m o Consult√≥rio na Rua por meio de um ve√≠culo adaptado que percorre diversas √°reas da cidade oferecendo cuidados em sa√∫de. Tem 2 equipes multidisciplinares cujo foco √© voltado as doen√ßas que mais acometem a popula√ß√£o. Realiza curativos, testes etc. S√£o realizadas a√ß√µes conjuntas entre o SOS rua e o Consult√≥rio de rua em regi√µes nas quais existem muita depend√™ncia qu√≠mica.

* Combate ao Trabalho Infantil ‚Äì de novembro de 2011 a dezembro de 2022 mais de 4,5 mil crian√ßas e adolescentes foram abordados em situa√ß√£o de trabalho infantil.

**C√ÅRITAS** 

Na linha de atua√ß√£o das Pastorais e das Comunidades Eclesiais de Base, nos anos 1980 os agentes C√°ritas (embora j√° estivessem atuando no Brasil desde 1956), renovam sua metodologia de a√ß√£o e passa nos anos 1990 a atuar com projetos alternativos comunit√°rios, assumindo assim uma lideran√ßa ativa no conjunto das pastorais sociais (caritasriopreto.org.br-11/08/2022). A Caritas no seu trabalho de apoio a a√ß√£o libertadora, na qual a popula√ß√£o busque a autonomia em apoio as iniciativas populares, funda em Campinas diversas casas de passagem que a popula√ß√£o em situa√ß√£o de rua possa se organizar e tenha a autonomia necess√°ria para construir seu caminho. 

Partindo do pressuposto de que s√≥ a a√ß√£o, conforme Paulo Freire (Educa√ß√£o como pr√°tica da liberdade, 1987), a partir da tomada de consci√™ncia da realidade, liberta, proporcionar√° a autonomia necess√°ria para a constru√ß√£o de outra sociedade. √â na a√ß√£o com a realidade, com a sociedade que se pode ver suas contradi√ß√µes. A popula√ß√£o em situa√ß√£o de rua surge de uma sociedade opressora e se faz necess√°rio que esta popula√ß√£o retome seu rumo e n√£o fique √† merc√™ dos. √â a apropria√ß√£o das pol√≠ticas p√∫blicas que j√° existem e a cria√ß√£o de outras (se necess√°rio), que possibilitar√° que a voz da rua venha √† tona.

O **Caritas** em convenio com a prefeitura de Campinas acolhe em **Abrigos** 85 pessoas em situa√ß√£o de rua, a saber: Casa S√£o Francisco- 20 vagas, Ant√¥nio Fernando ‚Äì 20 vagas, Juninho- 20 vagas, Santa Clara- 25 vagas; **Casa de Passagem**, Efraim 20 vagas e Nossa Casa, 20 vagas; **Provis√≥rio,** Casa Santa Dulce, 40 vagas.

**2- Objetivo**

A partir do momento que o p√∫blico-alvo deste projeto √© a popula√ß√£o em situa√ß√£o de rua, o **objetivo** deste projeto √© assegurar que esta popula√ß√£o conhe√ßa seus direitos e lute para que sejam assegurados. Para isso se faz necess√°rio uma conscientiza√ß√£o do que existe na rede p√∫blica possibilitando sua reapropria√ß√£o do espa√ßo e sua consequente emancipa√ß√£o pol√≠tica.

**3- Metodologia**

A **metodologia** ser√° baseada em pesquisa participante e de campo, no qual um n√∫mero de pessoas se aprofunda em um determinado tema, sob a coordena√ß√£o de um ou mais moderadores. O objetivo ser√° sempre o de escutar as demandas da popula√ß√£o em situa√ß√£o de rua. Os principais atores deste trabalho s√£o aqueles que ir√£o se apropriar desta metodologia e repassar o que apreenderam aos seus companheiros e companheiras. Nosso intuito √© o de que cada pessoa que participe deste projeto seja um cr√≠tico da sua hist√≥ria e da sociedade. 

Os temas devem estar relacionados aos direitos estabelecidos na **Constitui√ß√£o Federal de 1988** e o decreto **n. 7 de 23 de dezembro de 2009** que institui a **pol√≠tica Nacional para a popula√ß√£o em situa√ß√£o de rua e outros que possam surgir a partir das necessidades do grupo.**

**Proposta de trabalho em cada modulo:** 

Cada m√≥dulo ter√° como suporte como instrumentos de aprendizagem m√∫sicas, filmes, 

¬†  
**M√≥dulo 1: Entendendo os Direitos Humanos**

Defini√ß√£o de direitos humanos  
A import√¢ncia dos direitos humanos para a popula√ß√£o em situa√ß√£o de rua  
Viola√ß√µes de direitos humanos contra a popula√ß√£o em situa√ß√£o de rua

**M√≥dulo 2: Acesso a Servi√ßos e Dispositivos**

Compreendendo os servi√ßos e dispositivos dispon√≠veis para a popula√ß√£o em situa√ß√£o de rua.  
Como acessar esses servi√ßos e dispositivos  
A import√¢ncia desses servi√ßos e dispositivos

 Sa√∫de  
\- Redes de apoio da sa√∫de para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Acesso aos servi√ßos de sa√∫de  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de sa√∫de e simula√ß√£o de atendimento

Seguran√ßa  
\- Redes de apoio da seguran√ßa para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Acesso aos servi√ßos de seguran√ßa  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de seguran√ßa e simula√ß√£o de atendimento

Direitos Humanos  
\- Direitos humanos e a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Redes de apoio dos direitos humanos para a popula√ß√£o em situa√ß√£o de rua em Campinas  
\- Atividades pr√°ticas: identifica√ß√£o dos servi√ßos de direitos humanos e simula√ß√£o de atendimento

**M√≥dulo 3: Organizando a Popula√ß√£o em Situa√ß√£o de Rua**

Estrat√©gias de organiza√ß√£o da popula√ß√£o em situa√ß√£o de rua  
Como usar os servi√ßos e dispositivos dispon√≠veis para promover a organiza√ß√£o  
O papel do Estado na promo√ß√£o da organiza√ß√£o

**M√≥dulo 4: Advocacia e viola√ß√µes dos direitos humanos**

Estrat√©gias de advocacia para a promo√ß√£o dos direitos humanos  
Como denunciar viola√ß√µes de direitos humanos  
O papel do Estado na preven√ß√£o das viola√ß√µes dos direitos humanos

**M√≥dulo 5: Projeto Final**

Os alunos criar√£o um projeto que demonstra sua compreens√£o do conte√∫do do curso, no qual dever√° propor estrat√©gias de promo√ß√£o dos direitos humanos e organiza√ß√£o da popula√ß√£o em situa√ß√£o de rua.

**M√©todos de avalia√ß√£o**

**Testes no final de cada m√≥dulo**  
**Projeto final**  
**Linha do tempo**

**Conclus√£o, revis√£o do curso,** **Sess√£o de feedback.**

**Bibliografia citada**

* BAUMAN, Z.- **Identidade**, Rio de Janeiro, Zahar Editores, 2005  
* FREIRE, P. ‚Äì **A Educa√ß√£o como Pr√°tica de Liberdade**  
* GOHN, M. da G.- **Ativismos no Brasil.** Movimentos sociais, coletivos e organiza√ß√µes civis. Como impactam e por que importam?  
* PREFEITURA DE CAMPINAS- portal.campinas.sp.gov.br- 29-12-2021  
* SANTOS, M.- **Por uma outra Globaliza√ß√£o: do pensamento √∫nico √† consci√™ncia universal.** 13¬™ edi√ß√£o Rio de Janeiro, Record, 2006\.  
* KLAUMANN, A da R.- **Um enfoque hist√≥rico e socioassistencial da popula√ß√£o em situa√ß√£o de rua no Brasil.** A realidade do Centro POP de Rio do Sul-SC  
* XIBERRAS, M.- **As teorias da exclus√£o. Para uma constru√ß√£o do imagin√°rio do desvio,** Lisboa, Instituto Piaget, 1993\.


**Financiamento**

Tempo de dura√ß√£o- cada curso deve durar 16 horas.

Equipe- A equipe ser√° composta por dois coordenadores e dois educadores sociais.

Recursos- uma sala para 20 alunos, um retroprojetor, internet, uma caixa de som, papel sulfite, cartolina, tesoura, caneta hidrocor, l√°pis de cera, bexiga. Coffe break,

Transporte,
</file>

<file path="REDE_APOIO_CAMPINAS.md">
# ARTEFATO: REDE_APOIO_CAMPINAS.md (Dados Reais para "Sa√≠das")

## 1. O "Hub" de Alimenta√ß√£o e Dignidade (Al√©m do Bom Prato)
* **Refeit√≥rio da Igreja Metodista (Parceria ACIC)**
    * **Local:** Cruzamento da Rua Jos√© Paulino com Ferreira Penteado (Centro).
    * **Recurso Real:** Refei√ß√£o servida em mesa (com talheres e dignidade, diferente da marmita na cal√ßada).
    * **Mec√¢nica de Jogo:** Recupera `Dignidade` muito mais r√°pido que comer na rua. Local seguro para trocar informa√ß√µes (quests).
* **Catedral Metropolitana / Largo do Ros√°rio**
    * **A√ß√£o:** Ponto de distribui√ß√£o noturna de volunt√°rios e projeto da PUC-Campinas.
    * **Recurso:** "R√°dio Pe√£o" (Informa√ß√µes sobre bicos e cursos).

## 2. A "Chave" da Sa√≠da: Capacita√ß√£o Profissional (Real)
* **CEPROCAMP (via FUMEC)**
    * **Cursos Reais:** Auxiliar de Log√≠stica, Porteiro, Inform√°tica B√°sica.
    * **Local (Centro):** Unidade Prefeito Ant√¥nio da Costa Santos (perto da esta√ß√£o).
    * **Barreira Real (O Dilema):** As aulas exigem presen√ßa di√°ria.
    * **Conflito de Gameplay:** O hor√°rio do curso (ex: 19h √†s 22h) conflita com o hor√°rio de entrada no SAMIM (18h-19h).
    * **A Solu√ß√£o (O "Pulo do Gato"):** O jogador precisa negociar uma "Declara√ß√£o de Matr√≠cula" para ter autoriza√ß√£o de chegar tarde no abrigo, ou conseguir vaga na **Casa de Passagem da C√°ritas** (que foca em reinser√ß√£o).

## 3. Acolhimento Estrat√©gico (Al√©m do Pernoite)
* **Casa de Passagem "Ant√¥nio Fernando dos Santos" (C√°ritas)**
    * **Diferencial:** Foco em autonomia. N√£o √© apenas cama; √© atendimento t√©cnico para sair da rua.
    * **Mec√¢nica:** Desbloqueia a quest "Retirada de Documentos" mais r√°pido que o sistema comum.
* **SAMIM (Prefeitura)**
    * **Regra R√≠gida:** Entrada 18h-19h. Sa√≠da 06h. Exige documento ou B.O.
    * **Fun√ß√£o:** Sobreviv√™ncia bruta. Se perder o hor√°rio, perde a vaga.

## 4. Onde a "M√°gica" Acontece (Documentos e Direitos)
* **CPAT (Centro P√∫blico de Apoio ao Trabalhador)**
    * **Fun√ß√£o:** Balc√£o de empregos. Exige roupa limpa e banho tomado para ser atendido sem preconceito.
    * **Consult√≥rio na Rua:** √önica forma de curar status de sa√∫de sem endere√ßo fixo.
</file>

<file path="SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md">
# ARTEFATO: SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md
# FONTE DE VERDADE: Realidade Local e Legislativa (Campinas/SP/Brasil)

## 1. O Perfil Demogr√°fico (Corre√ß√£o do Censo)
* **A "Unidade M√≥vel":** No Brasil, a moradia em carros particulares √© estatisticamente irrelevante. A unidade m√≥vel real √© o **CARRINHO DE RECICLAGEM** (ferramenta de trabalho + transporte de pertences) ou a **BARRACA DE CAMPING**.
* **O Dilema do "Rapa" (Fiscaliza√ß√£o):** O medo n√£o √© "multa de estacionamento" (EUA), mas sim a **Apreens√£o de Bens**. A Lei Municipal muitas vezes conflita com a sobreviv√™ncia: o fiscal recolhe o carrinho alegando "uso indevido do espa√ßo p√∫blico", deixando o jogador sem renda e sem itens.

## 2. Sa√∫de e Subst√¢ncias (O Dilema Real)
* **Redu√ß√£o de Danos (CAPS AD):**
    * *Mec√¢nica:* O jogador n√£o √© obrigado a parar de usar subst√¢ncias para ser atendido.
    * *Consequ√™ncia:* O tratamento √© humanizado, mas a medica√ß√£o pode causar sonol√™ncia (Debuff: `Vigil√¢ncia -50%`), aumentando risco de roubo na rua.
* **Comunidades Terap√™uticas (Abstin√™ncia):**
    * *Mec√¢nica:* Exigem isolamento total e abstin√™ncia imediata.
    * *Consequ√™ncia:* O jogador ganha "Teto" e "Comida", mas perde "Liberdade" e "Rede de Contatos". Se recair (usar subst√¢ncia), √© expulso imediatamente (Game Over daquela rota).
* **Consult√≥rio na Rua:** A √∫nica unidade de sa√∫de que vai at√© o jogador e n√£o exige agendamento ou burocracia. Cura feridas e infec√ß√µes b√°sicas.

## 3. Arquitetura Hostil e Legisla√ß√£o
* **Lei Padre J√∫lio Lancellotti (Lei Federal 14.489/22):** Pro√≠be o uso de pedras, pinos e grades para impedir pessoas de deitarem.
    * *No Jogo:* O jogador pode denunciar arquitetura hostil para ganhar "Cidadania", ou usar papel√£o para neutralizar o dano de frio do ch√£o de pedra.

## 4. A Economia da Sobreviv√™ncia (Bicos Reais)
* **Reciclagem:** Principal fonte. Exige for√ßa f√≠sica e espa√ßo de armazenamento. Valor flutua.
* **Flanelinha (Vigia de Carros):** Exige territ√≥rio e carisma. Risco de conflito com outros vigias ou pol√≠cia.
* **Venda no Farol (Balas/√Ågua):** Exige investimento inicial (comprar a caixa). Risco de perder mercadoria na chuva.

## 5. Institui√ß√µes Reais de Campinas (Mapping)
* **Acolhimento:** SAMIM (R. Francisco Elisi√°rio - Regras R√≠gidas), Casa de Passagem C√°ritas (Foco em Sa√≠da).
* **Alimenta√ß√£o:** Bom Prato (Pago/Barato), Refeit√≥rio Metodista (Gratuito/Dignidade), Distribui√ß√£o no Largo do Ros√°rio (Noturno/Aleat√≥rio).
* **Sa√∫de:** CAPS AD Reviver, CAPS AD Antonio Orlando.
</file>

<file path="Tech_Stack.md">
{
	"name": "pop-rua-game",
	"version": "0.1.0",
	"private": true,
	"scripts": {
		"dev": "next dev",
		"build": "next build",
		"start": "next start",
		"lint": "biome check src/",
		"format": "biome format --write src/",
		"prepare": "husky"
	},
	"lint-staged": {
		"*.{js,ts,cjs,mjs,d.cts,d.mts,jsx,tsx,json,jsonc}": [
			"biome check --write --no-errors-on-unmatched"
		]
	},
	"dependencies": {
		"@ai-sdk/google": "^2.0.47",
		"@ai-sdk/react": "^2.0.115",
		"@radix-ui/react-dialog": "^1.1.15",
		"@radix-ui/react-progress": "^1.1.8",
		"@radix-ui/react-slot": "^1.2.4",
		"@types/leaflet": "^1.9.21",
		"@types/pouchdb": "^6.4.2",
		"ai": "^5.0.113",
		"class-variance-authority": "^0.7.1",
		"clsx": "^2.1.1",
		"leaflet": "^1.9.4",
		"lucide-react": "^0.561.0",
		"next": "16.0.10",
		"next-auth": "^5.0.0-beta.30",
		"pouchdb": "^9.0.0",
		"react": "19.2.1",
		"react-dom": "19.2.1",
		"react-leaflet": "^5.0.0",
		"tailwind-merge": "^3.4.0",
		"zustand": "^5.0.9"
	},
	"devDependencies": {
		"@biomejs/biome": "^2.3.9",
		"@tailwindcss/postcss": "^4",
		"@types/node": "^20",
		"@types/react": "^19",
		"@types/react-dom": "^19",
		"eslint": "^9",
		"eslint-config-next": "16.0.10",
		"husky": "^9.1.7",
		"lint-staged": "^16.2.7",
		"tailwindcss": "^4",
		"tw-animate-css": "^1.4.0",
		"typescript": "^5"
	}
}
{
	"compilerOptions": {
		"target": "ES2017",
		"lib": ["dom", "dom.iterable", "esnext"],
		"allowJs": true,
		"forceConsistentCasingInFileNames": true,
		"skipLibCheck": true,
		"strict": true,
		"noEmit": true,
		"esModuleInterop": true,
		"module": "esnext",
		"moduleResolution": "bundler",
		"resolveJsonModule": true,
		"isolatedModules": true,
		"jsx": "react-jsx",
		"incremental": true,
		"plugins": [
			{
				"name": "next"
			}
		],
		"paths": {
			"@/*": ["./src/*"]
		}
	},
	"include": [
		"next-env.d.ts",
		"**/*.ts",
		"**/*.tsx",
		".next/types/**/*.ts",
		".next/dev/types/**/*.ts",
		"**/*.mts"
	],
	"exclude": ["node_modules"]
}
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
	/* config options here */
};

export default nextConfig;
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
{
	"$schema": "https://ui.shadcn.com/schema.json",
	"style": "new-york",
	"rsc": true,
	"tsx": true,
	"tailwind": {
		"config": "",
		"css": "src/app/globals.css",
		"baseColor": "neutral",
		"cssVariables": true,
		"prefix": ""
	},
	"iconLibrary": "lucide",
	"aliases": {
		"components": "@/components",
		"utils": "@/lib/utils",
		"ui": "@/components/ui",
		"lib": "@/lib",
		"hooks": "@/hooks"
	},
	"registries": {}
}
{
	"$schema": "https://biomejs.dev/schemas/2.3.9/schema.json",
	"vcs": {
		"enabled": true,
		"clientKind": "git",
		"useIgnoreFile": true
	},
	"files": {
		"ignoreUnknown": false
	},
	"formatter": {
		"enabled": true,
		"indentStyle": "tab"
	},
	"linter": {
		"enabled": true,
		"rules": {
			"recommended": true
		}
	},
	"javascript": {
		"formatter": {
			"quoteStyle": "double"
		}
	},
	"assist": {
		"enabled": true,
		"actions": {
			"source": {
				"organizeImports": "on"
			}
		}
	}
}
</file>

<file path="public/sw.js">
const CACHE_NAME = "caminhos-campinas-v1";
const ASSETS_TO_CACHE = [
	"/",
	"/manifest.json",
	"/globe.svg",
	"/next.svg",
	"/vercel.svg",
];

self.addEventListener("install", (event) => {
	event.waitUntil(
		caches.open(CACHE_NAME).then((cache) => {
			return cache.addAll(ASSETS_TO_CACHE);
		}),
	);
});

self.addEventListener("fetch", (event) => {
	event.respondWith(
		caches.match(event.request).then((response) => {
			return (
				response ||
				fetch(event.request).catch(() => {
					// Fallback or handle offline silently
				})
			);
		}),
	);
});
</file>

<file path="src/app/api/chat/route.ts">
import { groq } from "@ai-sdk/groq";
import { convertToModelMessages, streamText, type UIMessage } from "ai";

export const maxDuration = 30;

export async function POST(req: Request) {
	try {
		// Check if API key is configured
		const apiKey = process.env.GROQ_API_KEY;
		console.log(
			"üîë Groq API Key status:",
			apiKey ? "‚úÖ Configured" : "‚ùå Missing",
		);

		if (!apiKey) {
			console.error("‚ùå GROQ_API_KEY is not set!");
			return new Response(
				JSON.stringify({
					error: "API key not configured",
					message:
						"Please add GROQ_API_KEY to .env.local - Get your free key at https://console.groq.com/keys",
				}),
				{ status: 500, headers: { "Content-Type": "application/json" } },
			);
		}

		interface GameState {
			health?: number;
			hunger?: number;
			hygiene?: number;
			money?: number;
			time?: number;
			[key: string]: unknown;
		}

		const {
			messages,
			gameState,
		}: { messages: UIMessage[]; gameState?: GameState } = await req.json();
		console.log("üì® Received messages:", messages?.length || 0);
		console.log("üéÆ Game state:", gameState);

		const systemPrompt = `
      Voc√™ √© o Mestre de Jogo (Game Master) de um Serious Game sobre popula√ß√£o em situa√ß√£o de rua em Campinas.
      
      ESTADO ATUAL DO JOGADOR:
      - Sa√∫de: ${gameState?.health ?? 100}
      - Fome: ${gameState?.hunger ?? 100} (0 = Faminto)
      - Higiene: ${gameState?.hygiene ?? 50}
      - Dinheiro: R$ ${gameState?.money ?? 0}
      - Hora: ${gameState?.time ?? 8}:00
      
      SUAS REGRAS:
      1. Seja realista e cru, mas n√£o cruel gratuitamente.
      2. Responda em Portugu√™s do Brasil.
      3. Mantenha as respostas curtas (m√°ximo 3 frases) para leitura r√°pida no celular.
      4. Se o jogador fizer uma a√ß√£o, descreva a consequ√™ncia baseada nos stats dele.
      5. Ofere√ßa sempre 2 ou 3 op√ß√µes de pr√≥xima a√ß√£o impl√≠citas na narrativa.
      
      Exemplo: "Voc√™ caminha pela Rua 13 de Maio. O cheiro de salgado de uma lanchonete te lembra que voc√™ n√£o come h√° horas. Um seguran√ßa te observa com desconfian√ßa. O que voc√™ faz?"
    `;

		console.log("ü§ñ Calling Groq API with Llama 3.3 70B...");
		const result = streamText({
			model: groq("llama-3.3-70b-versatile"),
			system: systemPrompt,
			messages: convertToModelMessages(messages),
		});

		console.log("‚úÖ Groq stream created, sending UI message response");
		return result.toUIMessageStreamResponse();
	} catch (error) {
		console.error("‚ùå API Error DETAILS:", error);
		console.error(
			"Error stack:",
			error instanceof Error ? error.stack : "No stack",
		);
		return new Response(
			JSON.stringify({
				error: "Internal Server Error",
				details: String(error),
				message: error instanceof Error ? error.message : "Unknown error",
			}),
			{ status: 500, headers: { "Content-Type": "application/json" } },
		);
	}
}
</file>

<file path="src/app/api/groq/route.ts">
import { groq } from "@ai-sdk/groq";
import { generateText } from "ai";
import { type NextRequest, NextResponse } from "next/server";

const GROQ_API_KEY = process.env.GROQ_API_KEY; // SEM NEXT_PUBLIC

// Rate limiting simples (em produ√ß√£o, usar Upstash Redis ou Vercel KV)
const requestCounts = new Map<string, { count: number; resetTime: number }>();

function checkRateLimit(identifier: string): boolean {
	const now = Date.now();
	const limit = requestCounts.get(identifier);

	if (!limit || now > limit.resetTime) {
		requestCounts.set(identifier, { count: 1, resetTime: now + 60000 }); // 1 minuto
		return true;
	}

	if (limit.count >= 10) {
		// M√°ximo 10 requisi√ß√µes por minuto
		return false;
	}

	limit.count++;
	return true;
}

export async function POST(req: NextRequest) {
	try {
		// Valida√ß√£o da chave de API
		if (!GROQ_API_KEY) {
			console.error("[Groq API] Chave de API n√£o configurada");
			return NextResponse.json(
				{ success: false, error: "Configura√ß√£o do servidor incompleta" },
				{ status: 500 },
			);
		}

		// Rate limiting b√°sico
		const ip =
			req.headers.get("x-forwarded-for") ||
			req.headers.get("x-real-ip") ||
			"unknown";
		if (!checkRateLimit(ip)) {
			return NextResponse.json(
				{ success: false, error: "Muitas requisi√ß√µes. Aguarde um momento." },
				{ status: 429 },
			);
		}

		// Parse do body
		const body = await req.json();
		const { prompt, type } = body;

		if (!prompt || typeof prompt !== "string") {
			return NextResponse.json(
				{ success: false, error: "Prompt inv√°lido" },
				{ status: 400 },
			);
		}

		// Valida√ß√£o de tamanho (evita abuso)
		if (prompt.length > 2000) {
			return NextResponse.json(
				{ success: false, error: "Prompt muito longo (m√°x 2000 caracteres)" },
				{ status: 400 },
			);
		}

		// Chamada √† API Groq usando AI SDK
		console.log(
			`[Groq API] Processando prompt - IP: ${ip}, Type: ${type || "none"}`,
		);

		const startTime = Date.now();
		const result = await generateText({
			model: groq("llama-3.3-70b-versatile"),
			prompt: prompt,
		});
		const responseTime = Date.now() - startTime;

		if (!result.text) {
			throw new Error("Resposta vazia da IA");
		}

		// Log de sucesso e performance
		console.log(
			`[Groq API] Sucesso - IP: ${ip}, Type: ${type || "none"}, Tempo: ${responseTime}ms`,
		);

		// Registrar m√©trica
		try {
			const { apiMetrics } = await import("@/utils/apiMetrics");
			apiMetrics.add({
				timestamp: new Date().toISOString(),
				responseTime,
				success: true,
				ip,
				type,
			});
		} catch (metricsError) {
			console.warn("Erro ao registrar m√©trica:", metricsError);
		}

		return NextResponse.json({
			success: true,
			text: result.text,
			metadata: {
				model: "llama-3.3-70b-versatile",
				timestamp: new Date().toISOString(),
				responseTime: responseTime,
			},
		});
	} catch (error) {
		console.error("[Groq API] Erro:", error);

		// Registrar erro nas m√©tricas
		try {
			const { apiMetrics } = await import("@/utils/apiMetrics");
			apiMetrics.add({
				timestamp: new Date().toISOString(),
				responseTime: 0,
				success: false,
				ip:
					req.headers.get("x-forwarded-for") ||
					req.headers.get("x-real-ip") ||
					"unknown",
				type: undefined,
				error: error instanceof Error ? error.message : String(error),
			});
		} catch (metricsError) {
			console.warn("Erro ao registrar m√©trica de erro:", metricsError);
		}

		return NextResponse.json(
			{
				success: false,
				error:
					"Erro ao processar requisi√ß√£o. Tente novamente em alguns instantes.",
			},
			{ status: 500 },
		);
	}
}
</file>

<file path="src/app/api/metrics/route.ts">
import { NextResponse } from "next/server";
import { apiMetrics } from "@/utils/apiMetrics";

export async function GET() {
	try {
		const stats = apiMetrics.getStats();
		const recent = apiMetrics.getRecent(20);

		return NextResponse.json({
			success: true,
			stats,
			recent,
			timestamp: new Date().toISOString(),
		});
	} catch (error) {
		console.error("[Metrics API] Erro:", error);
		return NextResponse.json(
			{
				success: false,
				error: "Erro ao obter m√©tricas",
			},
			{ status: 500 },
		);
	}
}
</file>

<file path="src/app/apoie/page.tsx">
"use client";

import { ArrowLeft, Coffee, Heart, Utensils } from "lucide-react";
import Link from "next/link";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import {
	Card,
	CardDescription,
	CardFooter,
	CardHeader,
	CardTitle,
} from "@/components/ui/card";

interface SupportCardProps {
	title: string;
	price: string;
	description: string;
	icon: React.ElementType;
	tier: string;
	loading: string | null;
	onClick: (tier: string) => void;
}

export default function ApoiePage() {
	const [loading, setLoading] = useState<string | null>(null);

	const handleSupport = (tier: string) => {
		setLoading(tier);
		setTimeout(() => {
			setLoading(null);
			alert(
				`Obrigado pelo seu apoio no n√≠vel ${tier}! (Simula√ß√£o de Pagamento)`,
			);
		}, 2000);
	};

	return (
		<div className="flex flex-col min-h-screen p-4 max-w-md mx-auto gap-4">
			<header className="flex items-center gap-2 mb-4">
				<Link href="/">
					<Button variant="ghost" size="icon">
						<ArrowLeft className="h-4 w-4" />
					</Button>
				</Link>
				<h1 className="text-xl font-bold">Apoie o Projeto</h1>
			</header>

			<div className="bg-blue-50 dark:bg-blue-950 p-4 rounded-lg text-sm mb-4">
				<p>
					Este jogo √© gratuito para a popula√ß√£o que precisa. Seu apoio mant√©m os
					servidores (e a esperan√ßa) online.
				</p>
			</div>

			<div className="grid gap-4">
				<SupportCard
					title="O Caf√©"
					price="R$ 5,00"
					description="Paga o servidor por um dia e garante um caf√© virtual."
					icon={Coffee}
					tier="cafe"
					loading={loading}
					onClick={handleSupport}
				/>

				<SupportCard
					title="A Marmita"
					price="R$ 15,00"
					description="Alimenta o desenvolvimento de novas features."
					icon={Utensils}
					tier="marmita"
					loading={loading}
					onClick={handleSupport}
				/>

				<SupportCard
					title="O Abrigo"
					price="R$ 50,00"
					description="Torne-se um patrono oficial do projeto."
					icon={Heart}
					tier="abrigo"
					loading={loading}
					onClick={handleSupport}
				/>
			</div>
		</div>
	);
}

function SupportCard({
	title,
	price,
	description,
	icon: Icon,
	tier,
	loading,
	onClick,
}: SupportCardProps) {
	return (
		<Card>
			<CardHeader>
				<div className="flex items-center justify-between">
					<CardTitle className="flex items-center gap-2">
						<Icon className="h-5 w-5" />
						{title}
					</CardTitle>
					<span className="font-bold text-lg">{price}</span>
				</div>
				<CardDescription>{description}</CardDescription>
			</CardHeader>
			<CardFooter>
				<Button
					className="w-full"
					onClick={() => onClick(tier)}
					disabled={loading !== null}
				>
					{loading === tier ? "Processando..." : "Apoiar"}
				</Button>
			</CardFooter>
		</Card>
	);
}
</file>

<file path="src/app/jogar/page.tsx">
"use client";

import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { useEffect, useState } from "react";
import { useGameContext } from "@/contexts/GameContext";
import { checkGameOver, type GameOverResult } from "@/features/game-loop/gameOverConditions";
import { useGameLoop } from "@/features/game-loop/useGameLoop";
import { SurvivalMap } from "@/features/survival-map/SurvivalMap";
import { DilemmaModal } from "@/features/ui/DilemmaModal";
import { GameChat } from "@/features/ui/GameChat";
import { GameHUD } from "@/features/ui/GameHUD";
import { GameOverModal } from "@/features/ui/GameOverModal";
import { SurvivalToggle } from "@/features/ui/SurvivalToggle";
import { useEventEngine } from "@/hooks/useEventEngine";

export default function GamePage() {
	// Initialize Game Loop (Time progression)
	useGameLoop();

	// Initialize Event Engine (Dilemmas)
	const { activeDilemma, resolveDilemma, clearActiveDilemma } =
		useEventEngine();

	const gameState = useGameContext();
	const { criticalHealth, sanity, resetGame } = gameState;

	// Game Over State
	const [gameOverResult, setGameOverResult] = useState<GameOverResult | null>(null);

	// Check for Game Over conditions every time state changes
	useEffect(() => {
		const result = checkGameOver(gameState);
		if (result.isGameOver && !gameOverResult) {
			setGameOverResult(result);
		}
	}, [gameState, gameOverResult]);

	// Handle restart from Game Over
	const handleRestart = () => {
		setGameOverResult(null);
		resetGame();
	};

	const degradationClasses = [
		criticalHealth
			? "grayscale-50 border-[10px] border-red-900/30 ring-inset ring-8 ring-red-900/20"
			: "",
		sanity < 20 ? "blur-[0.5px]" : "",
	]
		.filter(Boolean)
		.join(" ");

	return (
		<div
			className={`flex flex-col h-screen bg-slate-900 overflow-hidden transition-all duration-1000 ${degradationClasses}`}
		>
			{/* HUD Strip (Top Fixed) */}
			<GameHUD />

			{/* Header (Secondary under HUD) */}
			<header className="flex-none h-14 bg-slate-950/80 border-b border-slate-900 flex items-center justify-between px-4 z-40 mt-10">
				<div className="flex items-center gap-4">
					<Link
						href="/"
						className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors"
					>
						<ArrowLeft className="w-5 h-5" />
					</Link>
					<h1 className="font-bold text-slate-100 text-sm uppercase tracking-widest opacity-70">
						Setor de <span className="text-blue-500">Sobreviv√™ncia</span>
					</h1>
				</div>

				<SurvivalToggle />
			</header>

			{/* Main Game Area */}
			<main className="flex-1 flex flex-col md:flex-row overflow-hidden relative">
				{/* Left Column: Map */}
				<section className="h-[40%] md:h-full md:w-1/2 border-b md:border-b-0 md:border-r border-slate-900 relative z-0">
					<SurvivalMap />
				</section>

				{/* Right Column: Chat */}
				<section className="h-[60%] md:h-full md:w-1/2 bg-slate-950">
					<GameChat />
				</section>
			</main>

			{/* Dilemma Modal */}
			<DilemmaModal
				dilemma={activeDilemma || null}
				onResolve={resolveDilemma}
				onClose={clearActiveDilemma}
			/>

			{/* Game Over Modal */}
			{gameOverResult?.isGameOver && (
				<GameOverModal
					gameOverResult={gameOverResult}
					onRestart={handleRestart}
				/>
			)}
		</div>
	);
}
</file>

<file path="src/app/test-features/page.tsx">
"use client";

import React from "react";
import { EcoButton } from "@/components/ui/EcoButton";
import { EcoCard } from "@/components/ui/EcoCard";
import { type Item, useGameContext } from "@/contexts/GameContext";
import { useServices } from "@/contexts/ServicesContext";
import { NearbyList } from "@/features/survival-map/NearbyList";
import { useTelemetry } from "@/hooks/useTelemetry";
import { TelemetryAction } from "@/services/telemetry";

export default function TestFeaturesPage() {
	const { services, loading, error, refreshServices } = useServices();
	const {
		hunger,
		health,
		money: cash,
		eat,
		sleep,
		work,
		inventory,
		addToInventory,
	} = useGameContext();
	const { trackAction } = useTelemetry();

	const [isOnline, setIsOnline] = React.useState(true);

	const mockItem: Item = {
		id: `test-item-${Date.now()}`,
		name: "Papel√£o Coletado",
		weight: 2.5,
		type: "valioso",
	};

	React.useEffect(() => {
		setIsOnline(navigator.onLine);
		const handleOnline = () => setIsOnline(true);
		const handleOffline = () => setIsOnline(false);

		window.addEventListener("online", handleOnline);
		window.addEventListener("offline", handleOffline);

		return () => {
			window.removeEventListener("online", handleOnline);
			window.removeEventListener("offline", handleOffline);
		};
	}, []);

	return (
		<div className="bg-black min-h-screen p-8 text-white space-y-8">
			<h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
				Feature Validation Lab (Refactored)
			</h1>

			{/* 1. Eco Design System */}
			<section className="space-y-4 border border-zinc-800 p-6 rounded-xl">
				<h2 className="text-xl font-semibold mb-4">1. Eco Design System</h2>
				<div className="flex flex-wrap gap-4">
					<EcoButton
						variant="primary"
						onClick={() => console.log("Primary Click")}
					>
						Primary Action
					</EcoButton>
					<EcoButton variant="danger">Danger Zone</EcoButton>
					<EcoButton variant="ghost">Ghost Button</EcoButton>
					<EcoButton variant="primary" size="icon">
						‚òÖ
					</EcoButton>
				</div>
				<EcoCard className="mt-4">
					<h3 className="font-bold">EcoCard Component</h3>
					<p className="text-zinc-400">
						Pure black background for OLED efficiency.
					</p>
				</EcoCard>
			</section>

			{/* 2. Game Context & Telemetry */}
			<section className="space-y-4 border border-zinc-800 p-6 rounded-xl">
				<h2 className="text-xl font-semibold">
					2. Game Context State (Single Source)
				</h2>
				<div className="grid grid-cols-4 gap-4 text-center mb-4">
					<div className="p-3 bg-zinc-900 rounded">
						Hunger:{" "}
						<span className={hunger < 20 ? "text-red-500" : "text-green-500"}>
							{hunger}
						</span>
					</div>
					<div className="p-3 bg-zinc-900 rounded">Health: {health}</div>
					<div className="p-3 bg-zinc-900 rounded">
						Cash: R$ {cash.toFixed(2)}
					</div>
					<div className="p-3 bg-zinc-900 rounded">
						Items: {inventory.length}
					</div>
				</div>

				<div className="flex flex-wrap gap-2">
					<EcoButton variant="ghost" onClick={() => eat(10)}>
						Eat (+10)
					</EcoButton>
					<EcoButton variant="ghost" onClick={() => work(1)}>
						Work 1h (+R$10)
					</EcoButton>
					<EcoButton variant="danger" onClick={() => sleep(false)}>
						Unsafe Sleep (Telemetry)
					</EcoButton>
					<EcoButton variant="primary" onClick={() => addToInventory(mockItem)}>
						Add Weight (2.5kg)
					</EcoButton>
				</div>

				<div className="mt-4 p-4 bg-zinc-900/50 rounded-lg">
					<h3 className="text-sm font-bold text-zinc-400 mb-2">
						Invent√°rio (Peso Total:{" "}
						{inventory.reduce((acc, i) => acc + i.weight, 0).toFixed(1)}kg)
					</h3>
					<div className="flex flex-wrap gap-2">
						{inventory.map((item) => (
							<span
								key={item.id}
								className="text-xs px-2 py-1 bg-zinc-800 rounded"
							>
								{item.name} ({item.weight}kg)
							</span>
						))}
					</div>
				</div>

				<div className="mt-4">
					<h3 className="text-sm font-bold text-zinc-500 mb-2">
						Manual Telemetry
					</h3>
					<EcoButton
						variant="primary"
						onClick={() => trackAction(TelemetryAction.CLICK, { demo: true })}
					>
						Track 'CLICK' Event
					</EcoButton>
				</div>
			</section>

			{/* 3. Services Context */}
			<section className="space-y-4 border border-zinc-800 p-6 rounded-xl">
				<h2 className="text-xl font-semibold">
					3. Offline Services Manager & Nearby List
				</h2>

				<div className="flex justify-between items-center">
					<p className="text-sm text-zinc-400">
						Data Source: {isOnline ? "Online/Cached" : "Offline Storage"}
					</p>
					<EcoButton
						size="sm"
						variant="ghost"
						onClick={() => refreshServices()}
					>
						Refresh
					</EcoButton>
				</div>

				{loading && <p>Loading services...</p>}
				{error && <p className="text-red-500">{error}</p>}

				<div className="grid gap-6 md:grid-cols-2">
					<div>
						<h3 className="mb-2 font-bold text-zinc-400">
							All Services ({services.length})
						</h3>
						<div className="space-y-2">
							{services.map((service) => (
								<EcoCard key={service.id} className="border-zinc-800">
									<div className="flex justify-between items-start">
										<h3 className="font-bold text-lg">{service.name}</h3>
										<span className="text-xs px-2 py-1 bg-zinc-900 rounded capitalize">
											{service.type}
										</span>
									</div>
									<p className="text-sm text-zinc-400 mt-2">
										{service.address}
									</p>
								</EcoCard>
							))}
						</div>
					</div>

					<div>
						<h3 className="mb-2 font-bold text-zinc-400">
							Nearby List (Mock User @ Campinas Center)
						</h3>
						<NearbyList userPosition={[-22.90556, -47.06083]} />
					</div>
				</div>
			</section>
		</div>
	);
}
</file>

<file path="src/features/dashboard/ImpactDashboard.tsx">
"use client";

import {
	AlertTriangle,
	BarChart3,
	Globe,
	HelpCircle,
	Info,
	MapPin,
	MessageSquareCode,
	Shield,
	TrendingUp,
} from "lucide-react";
import type React from "react";
import { useEffect, useMemo, useState } from "react";
import { filterByDensity } from "@/utils/anonymization";
import {
	generateMockMetrics,
	type MockEvent,
} from "@/utils/generateMockMetrics";
import { MaslowComparison } from "./MaslowComparison";
import { ODSExplainer } from "./ODSExplainer";

export function ImpactDashboard() {
	const [mockData, setMockData] = useState<MockEvent[]>([]);
	const [loading, setLoading] = useState(true);
	const [showAnonInfo, setShowAnonInfo] = useState(false);

	useEffect(() => {
		const data = generateMockMetrics(1500);
		setMockData(data);
		setLoading(false);
	}, []);

	const aggregatedData = useMemo(() => {
		const gridMap = new Map<string, MockEvent[]>();
		mockData.forEach((event) => {
			const events = gridMap.get(event.grid) || [];
			events.push(event);
			gridMap.set(event.grid, events);
		});
		return filterByDensity(gridMap, 5);
	}, [mockData]);

	const stats = useMemo(() => {
		const counts = { ODS_2: 0, ODS_11: 0, ODS_10: 0, ODS_3: 0, avg_failure: 0 };
		let totalFailure = 0,
			eventCount = 0;

		aggregatedData.forEach((events) => {
			events.forEach((e) => {
				const key = e.ods as keyof typeof counts;
				if (counts[key] !== undefined) (counts[key] as number)++;
				totalFailure += e.systemic_failure;
				eventCount++;
			});
		});
		counts.avg_failure =
			eventCount > 0 ? Math.round(totalFailure / eventCount) : 0;
		return counts;
	}, [aggregatedData]);

	if (loading)
		return (
			<div className="min-h-screen bg-black flex flex-col items-center justify-center font-mono gap-4">
				<div className="w-12 h-12 border-t-2 border-blue-600 rounded-full animate-spin"></div>
				<span className="text-blue-900 tracking-widest animate-pulse uppercase">
					Auditoria_Sist√™mica_V1.3...
				</span>
			</div>
		);

	return (
		<div className="min-h-screen bg-[#050507] text-slate-300 font-sans p-4 md:p-10 space-y-12">
			{/* Header com Contraste Ajustado */}
			<header className="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-8 border-b border-slate-900 pb-10">
				<div className="space-y-4">
					<div className="flex items-center gap-5">
						<div className="bg-blue-600 p-4 rounded-2xl shadow-[0_0_30px_rgba(37,99,235,0.3)] hover:scale-105 transition-transform">
							<BarChart3 className="text-white" size={36} />
						</div>
						<div>
							<h1 className="text-5xl md:text-6xl font-black text-white tracking-tighter leading-none mb-2 uppercase italic">
								Cidadania Digital{" "}
								<span className="text-blue-500 not-italic">v1.3</span>
							</h1>
							<div className="flex items-center gap-3 text-slate-500 font-medium text-lg uppercase tracking-wide">
								<TrendingUp size={20} className="text-blue-500" /> Intelig√™ncia
								para Pol√≠ticas de Impacto
							</div>
						</div>
					</div>
				</div>

				<div className="flex flex-col items-end gap-3">
					<button
						onClick={() => setShowAnonInfo(!showAnonInfo)}
						className="flex items-center gap-3 bg-blue-900/10 border border-blue-600/40 px-6 py-3 rounded-xl text-sm font-black text-blue-400 hover:bg-blue-600/20 hover:border-blue-500 transition-all group"
					>
						<Shield
							size={18}
							className="group-hover:rotate-12 transition-transform"
						/>
						PROTOCOLO ANTI-CHACINA (K-5)
						<HelpCircle size={16} className="opacity-50" />
					</button>
					<span className="text-[10px] text-slate-600 font-mono tracking-[0.3em] font-bold">
						GRID_500M | TIME_JITTER_ACTIVE
					</span>
				</div>
			</header>

			{/* Modal de Anonimiza√ß√£o */}
			{showAnonInfo && (
				<div className="max-w-7xl mx-auto bg-blue-950/20 border-2 border-blue-600/50 p-8 rounded-2xl animate-in slide-in-from-top duration-300">
					<div className="flex gap-6 items-start">
						<Info className="text-blue-500 flex-none" size={32} />
						<div className="space-y-4">
							<h3 className="text-2xl font-black text-white uppercase tracking-tight">
								Como protegemos os dados?
							</h3>
							<p className="text-lg text-slate-300 leading-relaxed font-sans">
								Utilizamos o protocolo <strong>K-Anonymity</strong>: se uma
								c√©lula da grade (500m¬≤) possuir menos de 5 registros, os dados
								s√£o omitidos para evitar que indiv√≠duos sejam identificados por
								sua rotina de locomo√ß√£o. Al√©m disso, aplicamos um{" "}
								<strong>Time Jitter</strong> de 1 a 2 horas para impedir o
								rastreamento em tempo real por grupos hostis.
							</p>
						</div>
					</div>
				</div>
			)}

			{/* Painel Macro: Rankings e Manifesto */}
			<div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
				<section className="lg:col-span-2 bg-[#0c0c0f] p-10 rounded-3xl border border-slate-800 shadow-2xl flex flex-col justify-center space-y-8">
					<div className="space-y-4">
						<h2 className="text-3xl font-black text-white flex items-center gap-4 uppercase tracking-tighter italic">
							<MessageSquareCode size={30} className="text-blue-500" /> O
							Manifesto do Dado Vivo
						</h2>
						<div className="h-1 w-32 bg-blue-600 rounded-full" />
					</div>
					<p className="text-xl text-slate-300 leading-relaxed font-sans">
						Este painel traduz a invisibilidade em intelig√™ncia. N√£o mapeamos
						apenas n√∫meros; mapeamos a{" "}
						<strong>fal√™ncia deliberada do pacto social</strong> que empurra
						seres humanos para as margens da sobreviv√™ncia e do sistema
						prisional.
					</p>
					<div className="flex gap-4">
						<div className="bg-slate-900/50 px-4 py-2 rounded-full border border-slate-800 text-xs font-bold text-slate-500 uppercase tracking-widest">
							Representatividade: 98.4% de Precis√£o Sociol√≥gica
						</div>
					</div>
				</section>

				<div className="space-y-8">
					<RankingCard
						icon={<Globe size={24} className="text-white" />}
						title="Ranking Nacional (Pop. Rua)"
						topThree={[
							{
								rank: 1,
								label: "S√£o Paulo (SP)",
								val: "~86k",
								highlight: true,
							},
							{ rank: 2, label: "Rio de Janeiro (RJ)", val: "~20k" },
							{ rank: 3, label: "Minas Gerais (MG)", val: "~15k" },
						]}
					/>
					<RankingCard
						icon={<MapPin size={24} className="text-white" />}
						title="Vulnerabilidade Estadual (SP)"
						topThree={[
							{ rank: 1, label: "S√£o Paulo (Capital)", val: "Cr√≠tica" },
							{
								rank: 2,
								label: "Regi√£o Campinas",
								val: "Aten√ß√£o",
								highlight: true,
							},
							{ rank: 3, label: "Santos/Litoral", val: "Alta" },
						]}
					/>
				</div>
			</div>

			{/* √Årea Maslow e ODS (Espa√ßamento Ajustado) */}
			<div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-12 pt-8">
				<div className="lg:col-span-2">
					<ODSExplainer />
				</div>

				<div className="space-y-12">
					<MaslowComparison
						metrics={{
							hunger: stats.avg_failure,
							housing: 100 - stats.avg_failure,
							health: 100 - stats.avg_failure,
							education: 15,
						}}
					/>

					<div className="bg-red-600 p-10 rounded-3xl space-y-6 shadow-[0_30px_60px_rgba(220,38,38,0.3)] border-2 border-red-400 group hover:scale-[1.02] transition-transform">
						<h2 className="text-2xl font-black text-white uppercase tracking-widest flex items-center gap-3 italic">
							<AlertTriangle size={32} fill="white" className="text-red-600" />{" "}
							Risco de Prisioniza√ß√£o
						</h2>
						<div className="flex flex-col gap-1">
							<span className="text-8xl font-black text-white block leading-none tracking-tighter">
								{stats.avg_failure}%
							</span>
							<span className="text-xl text-white/80 font-black uppercase tracking-tight">
								Probabilidade de Recrutamento
							</span>
						</div>
						<p className="text-lg text-white font-medium leading-relaxed font-sans border-t border-white/20 pt-4">
							"A falta de moradia e alimento cria o v√°cuo perfeito para o
							recrutamento pelo crime de subsist√™ncia."
						</p>
					</div>
				</div>
			</div>

			{/* M√©tricas de Base (Contraste M√°ximo) */}
			<div className="max-w-7xl mx-auto space-y-12 py-10">
				<div className="flex items-center gap-4">
					<h2 className="text-3xl font-black text-white uppercase tracking-tighter">
						Telemetria de Direitos
					</h2>
					<div className="flex-grow h-px bg-slate-900" />
				</div>
				<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
					<EnhancedMetricCard
						title="ODS 2: FOME ZERO"
						value={stats.ODS_2}
						sub="Solicita√ß√µes de Refei√ß√£o Direta"
						color="from-orange-600 to-orange-950"
						iconColor="text-orange-400"
					/>
					<EnhancedMetricCard
						title="ODS 11.1: MORADIA"
						value={stats.ODS_11}
						sub="Demanda por Pernoite Atendido"
						color="from-blue-600 to-blue-950"
						iconColor="text-blue-400"
					/>
					<EnhancedMetricCard
						title="ODS 10: DIGNIDADE"
						value={stats.ODS_10}
						sub="Acessos a Documenta√ß√£o Civil"
						color="from-purple-600 to-purple-950"
						iconColor="text-purple-400"
					/>
					<EnhancedMetricCard
						title="ODS 3: SA√öDE MENTAL"
						value={stats.ODS_3}
						sub="Surtos e Interven√ß√µes PSI"
						color="from-red-600 to-red-950"
						iconColor="text-red-400"
					/>
				</div>
			</div>
		</div>
	);
}

function RankingCard({
	icon,
	title,
	topThree,
}: {
	icon: React.ReactNode;
	title: string;
	topThree: any[];
}) {
	return (
		<div className="bg-[#0c0c0f] border border-slate-800 p-8 rounded-3xl space-y-6 shadow-xl">
			<div className="flex items-center gap-4">
				<div className="bg-slate-800 p-2 rounded-lg">{icon}</div>
				<h3 className="text-lg font-black text-white uppercase tracking-tight">
					{title}
				</h3>
			</div>
			<div className="space-y-3">
				{topThree.map((item, i) => (
					<div
						key={i}
						className={`flex items-center justify-between p-3 rounded-xl border ${item.highlight ? "bg-blue-600/10 border-blue-600/50" : "bg-black border-slate-900"}`}
					>
						<div className="flex items-center gap-3">
							<span
								className={`text-xs font-black ${item.highlight ? "text-blue-500" : "text-slate-700"}`}
							>
								#{item.rank}
							</span>
							<span
								className={`text-sm font-bold ${item.highlight ? "text-white" : "text-slate-400"}`}
							>
								{item.label}
							</span>
						</div>
						<span
							className={`text-xs font-black px-2 py-1 rounded-md ${item.highlight ? "bg-blue-600 text-white" : "bg-slate-900 text-slate-500"}`}
						>
							{item.val}
						</span>
					</div>
				))}
			</div>
		</div>
	);
}

function EnhancedMetricCard({
	title,
	value,
	sub,
	color,
	iconColor,
}: {
	title: string;
	value: number;
	sub: string;
	color: string;
	iconColor: string;
}) {
	return (
		<div
			className={`bg-[#0c0c0f] border border-slate-800 p-8 rounded-3xl flex flex-col items-center text-center space-y-4 group hover:border-slate-600 transition-all shadow-xl relative overflow-hidden`}
		>
			{/* Background Accent */}
			<div
				className={`absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${color}`}
			/>

			<span
				className={`text-xs font-black tracking-[0.2em] uppercase ${iconColor}`}
			>
				{title}
			</span>
			<span className="text-7xl font-black tabular-nums text-white group-hover:scale-110 transition-transform duration-500 leading-none">
				{value}
			</span>
			<div className="space-y-1">
				<span className="text-sm font-bold text-slate-400 block">{sub}</span>
				<span className="text-[10px] text-slate-700 font-black uppercase tracking-widest">
					Campinas / Simula√ß√£o
				</span>
			</div>
		</div>
	);
}
</file>

<file path="src/features/dashboard/MaslowComparison.tsx">
"use client";

import { HelpCircle, Lock, XCircle, Zap } from "lucide-react";
import { useState } from "react";

interface MaslowProps {
	metrics: {
		hunger: number;
		housing: number;
		health: number;
		education: number;
	};
}

interface TooltipContent {
	title: string;
	impact: string;
	reality: string;
}

const TOOLTIP_DATA: Record<string, TooltipContent> = {
	Topo: {
		title: "Autorrealiza√ß√£o e Autonomia",
		impact:
			"Sem a base (moradia/sa√∫de), o c√©rebro permanece em modo de sobreviv√™ncia, tornando o aprendizado t√©cnico ou acad√™mico biologicamente invi√°vel.",
		reality:
			"Apenas 15% da popula√ß√£o de rua em Campinas consegue acessar cursos de capacita√ß√£o com sucesso.",
	},
	Meio_A: {
		title: "Dignidade e Estima Social",
		impact:
			"O estigma da rua destr√≥i o pertencimento. Sem documentos ou um local de higiene, o indiv√≠duo perde a percep√ß√£o de si como cidad√£o.",
		reality:
			"71% citam o rompimento de v√≠nculos familiares como a porta de entrada para a exclus√£o total.",
	},
	Meio_B: {
		title: "Seguran√ßa e Moradia",
		impact:
			"A falta de um teto (ODS 11.1) gera um estado de alerta perp√©tuo. O sono fragmentado na cal√ßada impede a recupera√ß√£o ps√≠quica.",
		reality:
			"Campinas possui d√©ficit de vagas em abrigos p√∫blicos em rela√ß√£o √† demanda sazonal de inverno.",
	},
	Base: {
		title: "Necessidades Fisiol√≥gicas",
		impact:
			"Fome e dor f√≠sica. Quando esta base falha, a √©tica social √© atropelada pela necessidade biol√≥gica de se manter vivo.",
		reality:
			"O 'Tr√°fico Formiga' √© o principal motor de encarceramento da pobreza quando a base de Maslow desmorona.",
	},
};

export function MaslowComparison({ metrics }: MaslowProps) {
	const isBaseBroken = metrics.hunger > 60 || metrics.housing < 30;
	const [activeTooltip, setActiveTooltip] = useState<string | null>(null);

	return (
		<div className="bg-[#0a0a0c] border border-slate-800 p-8 rounded-2xl space-y-10 shadow-2xl relative">
			<div className="space-y-2">
				<h2 className="text-xl font-bold text-white flex items-center gap-2 border-l-4 border-blue-600 pl-4">
					Hierarquia de Necessidades (Maslow de Rua)
				</h2>
				<p className="text-sm text-slate-400 font-sans ml-5">
					Explore os n√≠veis para entender o impacto da priva√ß√£o.
				</p>
			</div>

			<div className="relative flex flex-col items-center py-4">
				{/* Pir√¢mide Visual */}
				<div className="w-full max-w-[400px] flex flex-col gap-2 items-center">
					<PyramidTier
						active={!isBaseBroken}
						label="Autorrealiza√ß√£o e Educa√ß√£o"
						width="w-[50%]"
						locked={isBaseBroken}
						level="Topo"
						tooltipId="Topo"
						onInfoClick={setActiveTooltip}
					/>

					<PyramidTier
						active={!isBaseBroken}
						label="Dignidade e Estima"
						width="w-[70%]"
						locked={isBaseBroken}
						level="Meio"
						tooltipId="Meio_A"
						onInfoClick={setActiveTooltip}
					/>

					<PyramidTier
						active={metrics.housing > 50}
						label="Seguran√ßa e Moradia"
						width="w-[85%]"
						alert={metrics.housing < 30}
						level="Meio"
						tooltipId="Meio_B"
						onInfoClick={setActiveTooltip}
					/>

					<PyramidTier
						active={metrics.hunger < 50}
						label="Necessidades Fisiol√≥gicas"
						width="w-[100%]"
						alert={metrics.hunger > 70}
						shaking={metrics.hunger > 70}
						level="Base"
						tooltipId="Base"
						onInfoClick={setActiveTooltip}
					/>
				</div>

				{/* Curto-Circuito (Ainda mais agressivo) */}
				{isBaseBroken && (
					<div className="mt-8 md:mt-0 md:absolute top-1/2 -right-16 transform -translate-y-1/2 flex flex-col items-center group cursor-help">
						<div className="bg-red-600 text-white font-black p-5 rounded-xl shadow-[0_0_30px_rgba(220,38,38,0.6)] flex items-center gap-3 animate-pulse border-2 border-red-300">
							<Zap size={28} fill="currentColor" />
							<span className="text-base uppercase tracking-tighter">
								Colapso Sist√™mico
							</span>
						</div>
						<div className="h-14 w-1 bg-gradient-to-b from-red-600 to-transparent"></div>
						<div className="bg-black/90 p-3 border border-red-900 rounded-lg max-w-[180px] text-center">
							<span className="text-[10px] text-red-500 font-bold uppercase block mb-1">
								Impacto Criminal
							</span>
							<p className="text-[10px] text-slate-300 leading-tight">
								A falha biol√≥gica na base for√ßa o recrutamento pelo tr√°fico para
								subsist√™ncia imediata.
							</p>
						</div>
					</div>
				)}
			</div>

			{/* Modal de Tooltip (Humanizado e Leg√≠vel) */}
			{activeTooltip && (
				<div className="absolute inset-0 bg-black/95 z-50 flex flex-col p-8 rounded-2xl border-2 border-blue-900/50 animate-in fade-in zoom-in duration-200">
					<button
						type="button"
						aria-label="Fechar detalhes"
						onClick={() => setActiveTooltip(null)}
						className="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors"
					>
						<XCircle size={32} />
					</button>

					<div className="space-y-6">
						<div className="space-y-1">
							<span className="text-blue-500 font-bold tracking-widest text-xs uppercase">
								Detalhes do N√≠vel
							</span>
							<h3 className="text-3xl font-black text-white">
								{TOOLTIP_DATA[activeTooltip].title}
							</h3>
						</div>

						<div className="space-y-4">
							<div className="bg-blue-950/20 border-l-4 border-blue-600 p-4">
								<span className="text-xs font-bold text-blue-400 uppercase block mb-2">
									Impacto na Sobreviv√™ncia
								</span>
								<p className="text-lg text-slate-300 font-sans leading-relaxed">
									{TOOLTIP_DATA[activeTooltip].impact}
								</p>
							</div>

							<div className="bg-slate-900/40 p-4 rounded-lg">
								<span className="text-xs font-bold text-slate-500 uppercase block mb-2">
									Realidade Campinas
								</span>
								<p className="text-base text-slate-400 font-sans italic">
									"{TOOLTIP_DATA[activeTooltip].reality}"
								</p>
							</div>
						</div>
					</div>

					<div className="mt-auto pt-6 border-t border-slate-900 text-[10px] text-slate-600 uppercase tracking-widest font-bold">
						Dado Cruzado Anonimamente via Ponto Sagrado DB
					</div>
				</div>
			)}
		</div>
	);
}

function PyramidTier({
	active,
	label,
	width,
	locked,
	alert,
	shaking,
	level,
	tooltipId,
	onInfoClick,
}: any) {
	return (
		<div
			className={`${width} min-h-[70px] border-2 transition-all duration-300 flex items-center justify-between px-6 py-4 relative group rounded-xl
            ${active ? "bg-[#121215] border-slate-800 text-white" : "bg-black border-slate-900 text-slate-600"}
            ${alert ? "border-red-600/60 bg-red-950/20 shadow-[0_0_20px_rgba(220,38,38,0.1)]" : ""}
            ${shaking ? "animate-[bounce_1s_infinite]" : ""}
            hover:border-blue-500/50 hover:shadow-[0_0_30px_rgba(59,130,246,0.1)]
        `}
		>
			{locked && (
				<div className="absolute inset-0 bg-black/70 backdrop-blur-[2px] flex items-center justify-center rounded-xl z-10">
					<Lock size={24} className="text-red-600 opacity-60" />
				</div>
			)}

			<div className="flex flex-col gap-1 items-start">
				<span className="text-[10px] uppercase tracking-widest font-black text-slate-600 group-hover:text-blue-500 transition-colors">
					{level}
				</span>
				<span className="text-lg font-bold tracking-tight">{label}</span>
			</div>

			{!locked && (
				<button
					type="button"
					onClick={() => onInfoClick(tooltipId)}
					className="p-2 text-slate-700 hover:text-blue-500 hover:bg-blue-500/10 rounded-full transition-all flex items-center gap-2 group/btn"
				>
					<span className="text-[10px] font-bold opacity-0 group-hover/btn:opacity-100 transition-opacity">
						Detalhes
					</span>
					<HelpCircle size={20} />
				</button>
			)}
		</div>
	);
}
</file>

<file path="src/features/dashboard/ODSExplainer.tsx">
"use client";

import { GraduationCap, Heart, Home, Info, ShieldAlert } from "lucide-react";
import type React from "react";

export function ODSExplainer() {
	return (
		<div className="space-y-8 bg-slate-950/40 border border-slate-900 p-8 rounded-lg shadow-2xl">
			<div className="space-y-2">
				<h2 className="text-2xl font-bold text-white flex items-center gap-3 tracking-tight">
					<Info className="text-blue-500" size={28} />
					Direitos e Metas Globais (ODS)
				</h2>
				<div className="h-1 w-20 bg-blue-600 rounded-full" />
			</div>

			<p className="text-lg text-slate-300 leading-relaxed font-sans max-w-3xl">
				Os Objetivos de Desenvolvimento Sustent√°vel (Agenda 2030) da ONU
				representam um compromisso global. Para quem vive na rua, por√©m, essas
				metas n√£o s√£o apenas estat√≠sticas: s√£o <strong>direitos vitais</strong>{" "}
				que est√£o sendo violados diariamente.
			</p>

			<div className="grid grid-cols-1 md:grid-cols-2 gap-6">
				<ODSItem
					icon={<Home size={24} />}
					title="ODS 11.1: Direito √† Moradia"
					desc="O 'Direito √† Cidade' come√ßa com um teto seguro. Sem um endere√ßo ou local de repouso digno, o estado de alerta constante impede qualquer desenvolvimento humano ou cidadania b√°sica."
					color="text-blue-400"
					bgColor="bg-blue-500/5"
					borderColor="border-blue-900/30"
				/>
				<ODSItem
					icon={<Heart size={24} />}
					title="ODS 3: Sa√∫de e Bem-estar"
					desc="A vida nas ruas acelera a degrada√ß√£o f√≠sica e mental. Garantir acesso √† sa√∫de (como o Consult√≥rio na Rua) √© a base para a redu√ß√£o de danos e a preserva√ß√£o da dignidade."
					color="text-red-400"
					bgColor="bg-red-500/5"
					borderColor="border-red-900/30"
				/>
				<ODSItem
					icon={<GraduationCap size={24} />}
					title="ODS 4: Educa√ß√£o de Qualidade"
					desc="A autonomia vem pelo conhecimento. Contudo, √© uma barreira intranspon√≠vel tentar estudar ou se capacitar enquanto o corpo luta contra a priva√ß√£o severa de sono e alimenta√ß√£o."
					color="text-purple-400"
					bgColor="bg-purple-500/5"
					borderColor="border-purple-900/30"
				/>
				<ODSItem
					icon={<ShieldAlert size={24} />}
					title="ODS 10: Redu√ß√£o das Desigualdades"
					desc="Onde o Estado falha na assist√™ncia e prote√ß√£o, o sistema criminal costuma ser a √∫nica resposta. Combater a criminaliza√ß√£o da pobreza √© fundamental para a justi√ßa social."
					color="text-orange-400"
					bgColor="bg-orange-500/5"
					borderColor="border-orange-900/30"
				/>
			</div>
		</div>
	);
}

function ODSItem({
	icon,
	title,
	desc,
	color,
	bgColor,
	borderColor,
}: {
	icon: React.ReactNode;
	title: string;
	desc: string;
	color: string;
	bgColor: string;
	borderColor: string;
}) {
	return (
		<div
			className={`p-6 border ${borderColor} ${bgColor} rounded-md hover:bg-black/40 transition-all group`}
		>
			<div
				className={`flex items-center gap-3 mb-3 font-bold text-lg ${color}`}
			>
				<div className="p-2 rounded-full bg-black/50 border border-white/5 group-hover:scale-110 transition-transform">
					{icon}
				</div>
				<span>{title}</span>
			</div>
			<p className="text-base text-slate-400 leading-relaxed font-sans">
				{desc}
			</p>
		</div>
	);
}
</file>

<file path="src/hooks/useODSMetrics.ts">
"use client";

import { useCallback } from "react";
import { TelemetryAction, telemetryService } from "@/services/telemetry";

export enum ODS {
	ERRADICACAO_POBREZA = "ODS_1",
	FOME_ZERO = "ODS_2",
	SAUDE_BEM_ESTAR = "ODS_3",
	REDUCAO_DESIGUALDADES = "ODS_10",
	CIDADES_SUSTENTAVEIS = "ODS_11",
}

export function useODSMetrics() {
	const trackODS = useCallback(
		async (ods: ODS, meta: string, details: Record<string, any> = {}) => {
			await telemetryService.track(TelemetryAction.ODS_METRIC, {
				ods,
				meta,
				...details,
				timestamp: Date.now(),
			});

			if (process.env.NODE_ENV === "development") {
				console.log(`[ODS Metric] ${ods} - Meta ${meta}:`, details);
			}
		},
		[],
	);

	const trackServiceAccess = useCallback(
		(serviceType: string, serviceName: string) => {
			// Mapeamento l√≥gico: buscar abrigo -> ODS 11 (Cidades Sustent√°veis)
			if (serviceType === "ABRIGO" || serviceType === "PERNOITE") {
				trackODS(ODS.CIDADES_SUSTENTAVEIS, "11.1", {
					serviceType,
					serviceName,
				});
			}
			// Buscar comida -> ODS 2 (Fome Zero)
			else if (serviceType === "ALIMENTACAO" || serviceType === "REFEICAO") {
				trackODS(ODS.FOME_ZERO, "2.1", { serviceType, serviceName });
			}
			// Documenta√ß√£o -> ODS 10 (Redu√ß√£o de Desigualdades)
			else if (serviceType === "DOCUMENTACAO" || serviceType === "CIDADANIA") {
				trackODS(ODS.REDUCAO_DESIGUALDADES, "10.3", {
					serviceType,
					serviceName,
				});
			}
		},
		[trackODS],
	);

	return {
		trackODS,
		trackServiceAccess,
	};
}
</file>

<file path="src/hooks/useSurvivalLogic.ts">
"use client";

import { useCallback } from "react";
import { useGameContext } from "@/contexts/GameContext";

export function useSurvivalLogic() {
	const {
		workTool,
		isAtShelter,
		setActiveDilemma,
		addBuff,
		activeBuffs,
		modifyStat,
	} = useGameContext();

	// L√≥gica A: O Dilema da Carro√ßa (SAMIM)
	const checkShelterBarrier = useCallback(() => {
		if (workTool.type === "CARRINHO_RECICLAGEM" && isAtShelter) {
			setActiveDilemma("barreira-samim");
		}
	}, [workTool.type, isAtShelter, setActiveDilemma]);

	// L√≥gica B: Consult√≥rio na Rua (CnR) - Ref√∫gio Afetivo
	const interactWithCida = useCallback(() => {
		// No CnR, o jogador n√£o gasta dinheiro
		addBuff("ACOLHIMENTO_CNR");
		// Recupera um pouco de dignidade por ser bem tratado
		modifyStat("dignity", 10);
	}, [addBuff, modifyStat]);

	// Efeito do Buff CnR: Reduz perda de Sanidade
	const getSanityDecayMultiplier = useCallback(() => {
		return activeBuffs.includes("ACOLHIMENTO_CNR") ? 0.5 : 1.0;
	}, [activeBuffs]);

	return {
		checkShelterBarrier,
		interactWithCida,
		getSanityDecayMultiplier,
	};
}
</file>

<file path="src/utils/anonymization.ts">
/**
 * Protocolo Anti-Chacina: Utilit√°rios de Anonimiza√ß√£o Espacial e Temporal
 */

const GRID_SIZE_DEG = 0.0045; // Aproximadamente 500m em latitude

/**
 * Converte coordenadas exatas em uma c√©lula de grade (Grid Cell).
 * Isso remove a precis√£o milim√©trica e agrupa usu√°rios em blocos de ~500m.
 */
export function toGrid(lat: number, lng: number): string {
	const latGrid = Math.round(lat / GRID_SIZE_DEG) * GRID_SIZE_DEG;
	const lngGrid = Math.round(lng / GRID_SIZE_DEG) * GRID_SIZE_DEG;
	return `${latGrid.toFixed(4)},${lngGrid.toFixed(4)}`;
}

/**
 * Adiciona um atraso temporal (jitter) para evitar rastreamento em tempo real.
 */
export function applyTimeJitter(timestamp: number): number {
	// Adiciona um atraso aleat√≥rio entre 1 e 2 horas (em milissegundos)
	const jitter = (60 + Math.random() * 60) * 60 * 1000;
	return timestamp - jitter;
}

/**
 * Implementa k-anonymity b√°sica.
 * Se o n√∫mero de registros em uma c√©lula for menor que o limite, os dados s√£o suprimidos.
 */
export function filterByDensity<T>(
	gridData: Map<string, T[]>,
	minDensity = 5,
): Map<string, T[]> {
	const filtered = new Map<string, T[]>();
	for (const [grid, events] of gridData.entries()) {
		if (events.length >= minDensity) {
			filtered.set(grid, events);
		}
	}
	return filtered;
}
</file>

<file path="src/utils/apiMetrics.ts">
interface ApiMetric {
	timestamp: string;
	responseTime: number;
	success: boolean;
	ip: string;
	type?: string;
	error?: string;
}

class MetricsCollector {
	private metrics: ApiMetric[] = [];
	private maxSize = 1000; // √öltimas 1000 requisi√ß√µes

	add(metric: ApiMetric): void {
		this.metrics.push(metric);

		// Manter apenas as √∫ltimas maxSize m√©tricas
		if (this.metrics.length > this.maxSize) {
			this.metrics.shift();
		}
	}

	getStats() {
		if (this.metrics.length === 0) {
			return {
				total: 0,
				successful: 0,
				failureRate: "0%",
				avgResponseTime: "0ms",
				last24h: 0,
				last1h: 0,
			};
		}

		const total = this.metrics.length;
		const successful = this.metrics.filter((m) => m.success).length;
		const avgResponseTime =
			this.metrics.reduce((sum, m) => sum + m.responseTime, 0) / total;

		const now = Date.now();
		const last24h = this.metrics.filter(
			(m) => now - new Date(m.timestamp).getTime() < 24 * 60 * 60 * 1000,
		).length;

		const last1h = this.metrics.filter(
			(m) => now - new Date(m.timestamp).getTime() < 60 * 60 * 1000,
		).length;

		return {
			total,
			successful,
			failureRate: `${(((total - successful) / total) * 100).toFixed(2)}%`,
			avgResponseTime: `${Math.round(avgResponseTime)}ms`,
			last24h,
			last1h,
		};
	}

	getRecent(limit = 10): ApiMetric[] {
		return this.metrics.slice(-limit).reverse();
	}

	clear(): void {
		this.metrics = [];
	}
}

export const apiMetrics = new MetricsCollector();
</file>

<file path="src/utils/dilemmaCache.ts">
interface CachedDilemma {
	scenario: string;
	options: string[];
	timestamp: number;
}

export class DilemmaCache {
	private static TTL = 24 * 60 * 60 * 1000; // 24 horas
	private static PREFIX = "dilemma_cache_";

	static get(key: string): CachedDilemma | null {
		if (typeof window === "undefined") return null; // SSR safety

		try {
			const cached = localStorage.getItem(`${DilemmaCache.PREFIX}${key}`);
			if (!cached) return null;

			const data: CachedDilemma = JSON.parse(cached);

			// Verificar se expirou
			if (Date.now() - data.timestamp > DilemmaCache.TTL) {
				DilemmaCache.remove(key);
				return null;
			}

			return data;
		} catch (error) {
			console.error("Erro ao ler cache:", error);
			return null;
		}
	}

	static set(key: string, dilemma: Omit<CachedDilemma, "timestamp">): void {
		if (typeof window === "undefined") return; // SSR safety

		try {
			const cacheData: CachedDilemma = {
				...dilemma,
				timestamp: Date.now(),
			};

			localStorage.setItem(
				`${DilemmaCache.PREFIX}${key}`,
				JSON.stringify(cacheData),
			);

			// Limpar cache antigo (manter apenas √∫ltimos 10)
			DilemmaCache.cleanup();
		} catch (error) {
			console.error("Erro ao salvar cache:", error);
		}
	}

	static remove(key: string): void {
		if (typeof window === "undefined") return;
		localStorage.removeItem(`${DilemmaCache.PREFIX}${key}`);
	}

	static clear(): void {
		if (typeof window === "undefined") return;

		Object.keys(localStorage)
			.filter((k) => k.startsWith(DilemmaCache.PREFIX))
			.forEach((k) => {
				localStorage.removeItem(k);
			});
	}

	private static cleanup(): void {
		if (typeof window === "undefined") return;

		const cacheKeys = Object.keys(localStorage).filter((k) =>
			k.startsWith(DilemmaCache.PREFIX),
		);

		// Se tiver mais de 10, remover os mais antigos
		if (cacheKeys.length > 10) {
			const cacheItems = cacheKeys
				.map((key) => {
					try {
						const data = JSON.parse(localStorage.getItem(key) || "{}");
						return { key, timestamp: data.timestamp || 0 };
					} catch {
						return { key, timestamp: 0 };
					}
				})
				.sort((a, b) => a.timestamp - b.timestamp);

			// Remover os 5 mais antigos
			cacheItems.slice(0, 5).forEach((item) => {
				localStorage.removeItem(item.key);
			});
		}
	}

	static getStats() {
		if (typeof window === "undefined")
			return { total: 0, oldest: null, newest: null };

		const cacheKeys = Object.keys(localStorage).filter((k) =>
			k.startsWith(DilemmaCache.PREFIX),
		);

		if (cacheKeys.length === 0) {
			return { total: 0, oldest: null, newest: null };
		}

		const timestamps = cacheKeys
			.map((key) => {
				try {
					const data = JSON.parse(localStorage.getItem(key) || "{}");
					return data.timestamp || 0;
				} catch {
					return 0;
				}
			})
			.filter((ts) => ts > 0);

		return {
			total: cacheKeys.length,
			oldest: timestamps.length > 0 ? new Date(Math.min(...timestamps)) : null,
			newest: timestamps.length > 0 ? new Date(Math.max(...timestamps)) : null,
		};
	}
}
</file>

<file path="src/utils/generateMockMetrics.ts">
import { applyTimeJitter, toGrid } from "../utils/anonymization";

// Coordenadas centrais aproximadas de Campinas
const CAMPINAS_COORDS = { lat: -22.9064, lng: -47.0616 };

const EVENT_TYPES = [
	"BUSCA_ABRIGO",
	"SOLICITACAO_REFEICAO",
	"DOCUMENTACAO",
	"SAUDE_EMERGENCIA",
];
const ODS_MAP: Record<string, string> = {
	BUSCA_ABRIGO: "ODS_11",
	SOLICITACAO_REFEICAO: "ODS_2",
	DOCUMENTACAO: "ODS_10",
	SAUDE_EMERGENCIA: "ODS_3",
};

export interface MockEvent {
	id: string;
	ods: string;
	type: string;
	grid: string;
	timestamp: number;
	systemic_failure: number; // 0-100
}

export function generateMockMetrics(count = 1000): MockEvent[] {
	const events: MockEvent[] = [];
	const now = Date.now();

	for (let i = 0; i < count; i++) {
		// Dispers√£o aleat√≥ria em torno do centro (aprox 10km)
		const lat = CAMPINAS_COORDS.lat + (Math.random() - 0.5) * 0.1;
		const lng = CAMPINAS_COORDS.lng + (Math.random() - 0.5) * 0.1;

		const type = EVENT_TYPES[Math.floor(Math.random() * EVENT_TYPES.length)];

		events.push({
			id: crypto.randomUUID(),
			ods: ODS_MAP[type],
			type,
			grid: toGrid(lat, lng),
			timestamp: applyTimeJitter(now - Math.random() * 7 * 24 * 60 * 60 * 1000), // √öltimos 7 dias
			systemic_failure: Math.floor(Math.random() * 100),
		});
	}

	return events;
}
</file>

<file path="src/auth.ts">
import NextAuth from "next-auth";
import Credentials from "next-auth/providers/credentials";
import Google from "next-auth/providers/google";

export const { handlers, signIn, signOut, auth } = NextAuth({
	providers: [
		Google,
		Credentials({
			name: "An√¥nimo",
			credentials: {},
			async authorize() {
				// Retorna um usu√°rio an√¥nimo
				return {
					id: `anon-${Math.random().toString(36).substr(2, 9)}`,
					name: "Visitante",
					email: "anonimo@caminhoscampinas.com.br",
				};
			},
		}),
	],
	callbacks: {
		authorized: async ({ auth }) => {
			return !!auth;
		},
		async session({ session, token }) {
			if (token.sub) {
				session.user.id = token.sub;
			}
			return session;
		},
	},
});
</file>

<file path=".env.example">
# Pop Rua Game - Vari√°veis de Ambiente

# GROQ API (Free Tier - Fast Llama Models)
# Obtenha sua chave GRATUITA em: https://console.groq.com/keys
# N√£o precisa de cart√£o de cr√©dito!
GROQ_API_KEY=your_groq_api_key_here

# Auth (NextAuth)
# Gere um segredo no terminal com: openssl rand -base64 32
AUTH_SECRET=your-secret-key-here-must-be-set
AUTH_URL=http://localhost:3000

# Google OAuth (Opcional - necess√°rio para login com Google)
# AUTH_GOOGLE_ID=...
# AUTH_GOOGLE_SECRET=...

# DATABASE (Vercel Postgres ou similar)
# DATABASE_URL=postgres://user:password@host:5432/database

# GOOGLE ANALYTICS
# NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*
!.env.example

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
	...nextVitals,
	...nextTs,
	// Override default ignores of eslint-config-next.
	globalIgnores([
		// Default ignores of eslint-config-next:
		".next/**",
		"out/**",
		"build/**",
		"next-env.d.ts",
	]),
]);

export default eslintConfig;
</file>

<file path="jogo.code-workspace">
{
	"folders": [
		{
			"path": "."
		},
		{
			"path": ".."
		}
	],
	"settings": {}
}
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
	/* config options here */
};

export default nextConfig;
</file>

<file path="postcss.config.mjs">
const config = {
	plugins: {
		"@tailwindcss/postcss": {},
	},
};

export default config;
</file>

<file path="src/app/impacto/page.tsx">
"use client";

import { ArrowLeft } from "lucide-react";
import Link from "next/link";
import { ImpactDashboard } from "@/features/dashboard/ImpactDashboard";

export default function ImpactPage() {
	return (
		<main className="bg-black min-h-screen">
			<div className="max-w-[1400px] mx-auto relative">
				<Link
					href="/"
					className="fixed top-6 left-6 z-[100] p-3 border border-slate-800 bg-black/80 backdrop-blur-md text-slate-300 hover:text-white hover:border-blue-500 transition-all rounded-full shadow-lg group"
					title="Voltar para a Landing Page"
				>
					<ArrowLeft
						size={20}
						className="group-hover:-translate-x-1 transition-transform"
					/>
				</Link>
				<ImpactDashboard />
			</div>
		</main>
	);
}
</file>

<file path="src/app/recursos/page.tsx">
"use client";

import {
	ArrowRight,
	Award,
	BookOpen,
	MapPin,
	Users,
	Video,
} from "lucide-react";
import Link from "next/link";

export default function ResourcesPage() {
	const resources = [
		{
			category: "Capacita√ß√£o Profissional",
			items: [
				{
					title: "Curso B√°sico de El√©trica",
					provider: "Funda√ß√£o Paulistana",
					duration: "40h",
					type: "Presencial",
				},
				{
					title: "Panifica√ß√£o Artesanal",
					provider: "Fundo Social SP",
					duration: "20h",
					type: "Presencial",
				},
				{
					title: "Empreendedorismo na Rua",
					provider: "Sebrae",
					duration: "15h",
					type: "Online",
				},
			],
		},
		{
			category: "Educa√ß√£o Digital",
			items: [
				{
					title: "Como usar o Caixa Tem",
					provider: "Gov.br",
					duration: "30min",
					type: "V√≠deo",
				},
				{
					title: "Criando seu Curr√≠culo no Celular",
					provider: "CATe",
					duration: "1h",
					type: "Tutorial",
				},
				{
					title: "Seguran√ßa na Internet",
					provider: "Ong Recode",
					duration: "2h",
					type: "Curso",
				},
			],
		},
	];

	return (
		<div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20 pt-16">
			{/* Header */}
			<header className="bg-blue-600 text-white py-12 px-4 shadow-lg">
				<div className="max-w-5xl mx-auto">
					<Link
						href="/"
						className="inline-flex items-center text-white/90 hover:text-white mb-6 transition-colors font-semibold"
					>
						<ArrowRight className="h-5 w-5 rotate-180 mr-2" /> Voltar para
						In√≠cio
					</Link>
					<h1 className="text-3xl md:text-5xl font-bold mb-4">
						Hub de Recursos
					</h1>
					<p className="text-xl text-blue-100 max-w-2xl">
						Acesso simplificado a cursos, capacita√ß√µes e servi√ßos essenciais
						para a autonomia.
					</p>
				</div>
			</header>

			{/* Categories */}
			<div className="max-w-5xl mx-auto px-4 -mt-8">
				<div className="grid md:grid-cols-3 gap-6 mb-12">
					<div className="bg-white p-6 rounded-xl shadow-md flex items-center gap-4">
						<div className="bg-orange-100 p-3 rounded-full">
							<Video className="h-6 w-6 text-orange-600" />
						</div>
						<div>
							<span className="block text-2xl font-bold text-slate-900">
								12
							</span>
							<span className="text-sm text-slate-500">Videoaulas</span>
						</div>
					</div>
					<div className="bg-white p-6 rounded-xl shadow-md flex items-center gap-4">
						<div className="bg-green-100 p-3 rounded-full">
							<MapPin className="h-6 w-6 text-green-600" />
						</div>
						<div>
							<span className="block text-2xl font-bold text-slate-900">
								05
							</span>
							<span className="text-sm text-slate-500">Locais F√≠sicos</span>
						</div>
					</div>
					<div className="bg-white p-6 rounded-xl shadow-md flex items-center gap-4">
						<div className="bg-purple-100 p-3 rounded-full">
							<Award className="h-6 w-6 text-purple-600" />
						</div>
						<div>
							<span className="block text-2xl font-bold text-slate-900">
								03
							</span>
							<span className="text-sm text-slate-500">Certificados</span>
						</div>
					</div>
				</div>

				{/* Resource Lists */}
				<div className="space-y-12">
					{resources.map((section) => (
						<div key={section.category}>
							<h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
								<BookOpen className="h-6 w-6 text-blue-600" />
								{section.category}
							</h2>
							<div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
								{section.items.map((item) => (
									<div
										key={item.title}
										className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow group cursor-pointer relative overflow-hidden"
									>
										<div className="absolute top-0 left-0 w-1 h-full bg-blue-500 group-hover:bg-blue-600 transition-colors"></div>
										<h3 className="font-bold text-lg text-slate-900 mb-2">
											{item.title}
										</h3>
										<div className="flex items-center justify-between text-sm text-slate-500 mt-4">
											<span className="flex items-center gap-1">
												<Users className="h-4 w-4" /> {item.provider}
											</span>
											<span className="bg-slate-100 px-2 py-1 rounded text-xs font-semibold uppercase">
												{item.type}
											</span>
										</div>
									</div>
								))}
							</div>
						</div>
					))}
				</div>

				{/* CTA */}
				<div className="mt-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 md:p-12 text-center text-white">
					<h2 className="text-3xl font-bold mb-4">
						Tem um curso ou oferta de emprego?
					</h2>
					<p className="text-blue-100 mb-8 max-w-xl mx-auto">
						Parceiros empresariais podem cadastrar vagas e treinamentos
						diretamente na nossa plataforma.
					</p>
					<button
						type="button"
						className="bg-white text-blue-700 px-8 py-3 rounded-xl font-bold hover:bg-blue-50 transition-colors shadow-lg"
					>
						Cadastrar Oportunidade
					</button>
				</div>
			</div>
		</div>
	);
}
</file>

<file path="src/components/Providers.tsx">
"use client";

import { SessionProvider } from "next-auth/react";
import { useEffect } from "react";

export function Providers({ children }: { children: React.ReactNode }) {
	useEffect(() => {
		if ("serviceWorker" in navigator) {
			navigator.serviceWorker
				.register("/sw.js")
				.then((reg) => console.log("SW registered:", reg))
				.catch((err) => console.error("SW failed:", err));
		}
	}, []);

	return <SessionProvider>{children}</SessionProvider>;
}
</file>

<file path="src/features/game-loop/dilemmas.ts">
import type { GameState } from "@/contexts/GameContext";

export type TriggerType =
	| "HUNGER_LOW"
	| "HYGIENE_LOW"
	| "RANDOM"
	| "SOCIAL_STIGMA_HIGH";

export interface DilemmaOption {
	label: string;
	consequence: string;
	effect: Partial<
		Omit<
			GameState,
			| "inventory"
			| "day"
			| "time"
			| "resolvedDilemmas"
			| "activeDilemmaId"
			| "activeBuffs"
			| "workTool"
			| "criticalHealth"
		>
	> & {
		inventoryAdd?: string;
		addBuff?: string;
		removeBuff?: string;
		workToolUpdate?: Partial<GameState["workTool"]>;
		timeAdvance?: number;
	};
}

export interface Dilemma {
	id: string;
	title: string;
	description: string;
	trigger: {
		type: TriggerType;
		value: number;
	};
	prerequisite?: string;
	options: DilemmaOption[];
}

export const GAME_DILEMMAS: Dilemma[] = [
	{
		id: "hunger-emergency",
		title: "Fome Apertando",
		description:
			"O dia est√° acabando e sua barriga d√≥i de fome. Voc√™ precisa encontrar algo para comer logo ou sua sa√∫de come√ßar√° a declinar rapidamente.",
		trigger: { type: "HUNGER_LOW", value: 30 },
		options: [
			{
				label: "Bom Prato Centro (R$ 1)",
				consequence:
					"O Bom Prato garante alimenta√ß√£o de qualidade por um pre√ßo simb√≥lico. Voc√™ comeu bem e economizou. (Dispon√≠vel apenas entre 10h e 14h)",
				effect: { hunger: 80, money: -1 },
			},
			{
				label: "Refeit√≥rio Metodista (Gr√°tis)",
				consequence:
					"O refeit√≥rio oferece comida com dignidade e voc√™ se sente respeitado. A fila estava longa (-2h), mas valeu a pena.",
				effect: { hunger: 60, dignity: 15, timeAdvance: 2 },
			},
			{
				label: "Revirar Lixo",
				consequence:
					"A fome falou mais alto, mas voc√™ corre risco de doen√ßas e sua dignidade foi embora.",
				effect: { hunger: 20, health: -10, sanity: -5, dignity: -20 },
			},
		],
	},
	{
		id: "barreira-samim",
		title: "A Barreira do SAMIM",
		description:
			"Voc√™ chegou ao SAMIM para o pernoite, mas est√° com seu carrinho de reciclagem. As regras s√£o claras: n√£o entra carga ou ferramentas grandes. O pernoite √© sua √∫nica chance de sono seguro, mas o carrinho √© seu sustento.",
		trigger: { type: "RANDOM", value: 0.3 },
		options: [
			{
				label: "Abandonar Carrinho",
				consequence:
					"Voc√™ entrou e dormiu seguro, mas ao acordar, o 'Rapa' (fiscaliza√ß√£o) tinha levado seu carrinho que ficou na cal√ßada. Voc√™ ter√° que recome√ßar do zero.",
				effect: {
					health: 20,
					dignity: 5,
					workToolUpdate: { type: null, capacity: 0, riskFactor: 0 },
				},
			},
			{
				label: "Dormir na Rua",
				consequence:
					"Voc√™ preferiu proteger seu patrim√¥nio. A noite foi fria e perigosa na cal√ßada da Francisco Elisi√°rio. Seu corpo d√≥i e sua mente est√° exausta.",
				effect: { health: -15, sanity: -15, energy: -20, dignity: -5 },
			},
		],
	},
	{
		id: "abordagem-rapa",
		title: "Abordagem do Rapa",
		description:
			"A fiscaliza√ß√£o urbana ('Rapa') parou ao seu lado. Eles n√£o querem te prender, querem limpar a cal√ßada. Seus pertences e sua ferramenta de trabalho est√£o em risco.",
		trigger: { type: "SOCIAL_STIGMA_HIGH", value: 60 },
		options: [
			{
				label: "Tentar Negociar",
				consequence:
					"Voc√™ implora e consegue salvar o b√°sico, mas eles levam sua carga de recicl√°veis e metade da sua dignidade.",
				effect: {
					dignity: -20,
					socialStigma: 10,
					workToolUpdate: { condition: 50 }, // Perda de carga degrada condi√ß√£o simbolicamente
				},
			},
			{
				label: "Perder Tudo",
				consequence:
					"Eles levam seu carrinho e tudo o que estava dentro. Voc√™ fica apenas com a roupa do corpo.",
				effect: {
					dignity: -30,
					workToolUpdate: { type: null, capacity: 0, riskFactor: 0 },
				},
			},
		],
	},
	{
		id: "paradoxo-caps",
		title: "O Paradoxo do CAPS AD",
		description:
			"Voc√™ buscou ajuda no CAPS AD para lidar com a ansiedade e o v√≠cio. O atendimento √© √≥timo e a medica√ß√£o te acalma, mas ela traz um sono profundo.",
		trigger: { type: "RANDOM", value: 0.15 },
		options: [
			{
				label: "Aceitar a Medica√ß√£o",
				consequence:
					"Sua mente descansa, mas voc√™ fica 'sedado'. No sono profundo na pra√ßa, voc√™ √© um alvo f√°cil. Sua vigil√¢ncia caiu drasticamente.",
				effect: { sanity: 20, addBuff: "SEDADO_CAPS" },
			},
			{
				label: "Apenas Conversar",
				consequence:
					"O di√°logo ajuda, mas a crise de abstin√™ncia e o barulho da rua dificultam o descanso.",
				effect: { sanity: 5, health: -5 },
			},
		],
	},
	{
		id: "lei-padre-julio",
		title: "Arquitetura Hostil",
		description:
			"Voc√™ encontrou uma marquise nova no Centro, mas o dono do pr√©dio instalou pinos met√°licos no ch√£o para impedir que algu√©m deite. Isso fere a Lei Padre J√∫lio Lancellotti.",
		trigger: { type: "RANDOM", value: 0.1 },
		options: [
			{
				label: "Usar Papel√£o",
				consequence:
					"Voc√™ improvisa uma camada grossa de papel√£o sobre os pinos. √â desconfort√°vel, mas neutraliza o dano do frio.",
				effect: { energy: 10, dignity: -10, health: -5 },
			},
			{
				label: "Denunciar (Cidadania)",
				consequence:
					"Voc√™ chama um coletivo de direitos humanos. A estrutura √© removida dias depois e voc√™ ganha reconhecimento por lutar pelos seus direitos.",
				effect: { dignity: 30, stabilityGap: -5, socialStigma: -10 },
			},
		],
	},
	{
		id: "bico-flanelinha",
		title: "Conflito de Territ√≥rio",
		description:
			"Voc√™ estava vigiando carros na Rua Bar√£o de Jaguara quando outro vigia chega dizendo que 'aquele quarteir√£o tem dono'. O clima esquenta.",
		trigger: { type: "RANDOM", value: 0.2 },
		options: [
			{
				label: "Recuar (Paz)",
				consequence:
					"Voc√™ evita o confronto f√≠sico, mas perde o ponto de renda da tarde.",
				effect: { sanity: 5, money: -10 },
			},
			{
				label: "Impor Respeito",
				consequence:
					"Voc√™ garante o territ√≥rio, mas o estresse e a adrenalina te deixam exausto e mal visto pela vizinhan√ßa.",
				effect: { money: 30, sanity: -20, energy: -30, socialStigma: 15 },
			},
		],
	},
	{
		id: "venda-farol",
		title: "Chuva no Farol",
		description:
			"Voc√™ investiu seus √∫ltimos trocados em caixas de bala para vender no cruzamento da Aquidaban. No meio do expediente, come√ßa um temporal t√≠pico de Campinas.",
		trigger: { type: "RANDOM", value: 0.15 },
		options: [
			{
				label: "Proteger Mercadoria",
				consequence:
					"Voc√™ se molha todo, mas salva as balas. Sua sa√∫de sofre pelo frio intenso.",
				effect: { health: -20, dignity: -5 },
			},
			{
				label: "Vender na Chuva",
				consequence:
					"Alguns motoristas sentem pena e compram r√°pido, mas o papel das balas amolece e metade se perde.",
				effect: { money: 20, health: -30, sanity: -10 },
			},
		],
	},
	{
		id: "horario-ceprocamp",
		title: "Conflito Institucional",
		description:
			"Suas aulas no CEPROCAMP terminam √†s 22h, mas o SAMIM fecha os port√µes √†s 19h. Sem uma declara√ß√£o especial, voc√™ ter√° que escolher entre o futuro ou o teto de hoje.",
		trigger: { type: "RANDOM", value: 0.25 },
		options: [
			{
				label: "Estudar e dormir na rua",
				consequence:
					"Voc√™ aprendeu muito, mas a noite na rua cobrou seu pre√ßo em sa√∫de e seguran√ßa.",
				effect: { stabilityGap: -15, health: -20, sanity: -10 },
			},
			{
				label: "Garantir o abrigo",
				consequence:
					"Voc√™ dormiu seco, mas faltou √† aula e corre risco de perder a vaga no curso.",
				effect: { health: 10, energy: 30, stabilityGap: 5 },
			},
		],
	},
	{
		id: "comunidade-terapeutica",
		title: "Comunidade Terap√™utica",
		description:
			"Uma Kombi de uma Comunidade Terap√™utica te oferece 'Teto e Comida' por 6 meses, mas a regra √© abstin√™ncia total e ora√ß√£o obrigat√≥ria.",
		trigger: { type: "RANDOM", value: 0.05 },
		options: [
			{
				label: "Aceitar (Teto)",
				consequence:
					"Voc√™ tem comida e cama, mas perdeu sua rede de contatos na rua e sua liberdade de ir e vir.",
				effect: {
					health: 50,
					hunger: 50,
					dignity: 10,
					stabilityGap: -10,
					addBuff: "RECLUSO",
				},
			},
			{
				label: "Recusar (Liberdade)",
				consequence:
					"A liberdade da rua √© dura, mas voc√™ prefere manter sua autonomia e seus contatos reais.",
				effect: { sanity: 15, dignity: 5 },
			},
		],
	},
	// --- QUEST LINE: DOCUMENTA√á√ÉO ---
	{
		id: "samim-entry-fail",
		title: "Barrado no SAMIM",
		description:
			"Voc√™ tenta entrar para o pernoite, mas o monitor pede seu RG. Voc√™ n√£o o tem.",
		trigger: { type: "RANDOM", value: 0.1 },
		options: [
			{
				label: "Explicar que perdeu tudo",
				consequence:
					"Ele entende, mas sem documento ou B.O. a vaga √© negada. Voc√™ passar√° a noite na rua. (Miss√£o: V√° ao Poupatempo)",
				effect: { health: -10, sanity: -10 },
			},
			{
				label: "Procurar o Poupatempo amanh√£",
				consequence:
					"Voc√™ aceita a derrota, mas decide que precisa regularizar sua situa√ß√£o. A noite ser√° longa.",
				effect: { sanity: 5, health: -5 },
			},
		],
	},
	{
		id: "poupatempo-visit",
		title: "Fila do Poupatempo",
		description:
			"Voc√™ chega ao Poupatempo disposto a tirar o RG, mas descobre que precisa de agendamento online pr√©vio.",
		prerequisite: "samim-entry-fail", // S√≥ acontece se j√° foi barrado antes
		trigger: { type: "RANDOM", value: 0.4 }, // Alta chance se j√° teve o problema
		options: [
			{
				label: "Tentar implorar por um encaixe",
				consequence:
					"O seguran√ßa √© firme: 'S√≥ com agendamento'. Frustra√ß√£o total. Voc√™ precisa de internet.",
				effect: { sanity: -15 },
			},
			{
				label: "Ir at√© a Biblioteca Municipal",
				consequence:
					"Algu√©m na fila diz que l√° tem internet gr√°tis para agendar. √â sua melhor chance.",
				effect: { stabilityGap: -2 },
			},
		],
	},
	{
		id: "library-internet",
		title: "Ponto Sagrado: Biblioteca",
		description:
			"Na Biblioteca Municipal (perto da prefeitura), voc√™ consegue usar o computador por 30 min.",
		prerequisite: "poupatempo-visit", // S√≥ acontece se j√° foi ao poupatempo
		trigger: { type: "RANDOM", value: 0.5 },
		options: [
			{
				label: "Agendar RG no Poupatempo",
				consequence:
					"Miss√£o cumprida! Agora √© s√≥ esperar o dia marcado. Cidadania +10. (Voc√™ obteve o agendamento)",
				effect: { stabilityGap: -10, sanity: 10, addBuff: "AGENDAMENTO_RG" },
			},
			{
				label: "Pesquisar cursos no CEPROCAMP",
				consequence:
					"Voc√™ v√™ uma chance de sair da rua atrav√©s da capacita√ß√£o, mas esquece do RG.",
				effect: { sanity: 15, dignity: 10 },
			},
		],
	},
];
</file>

<file path="src/features/game-loop/eventEngine.ts">
"use client";

import type { GameState } from "@/contexts/GameContext";

export interface GameEvent {
	id: string;
	title: string;
	description: string;
	consequence: (state: GameState) => Partial<GameState>;
}

export function processRandomEvents(
	state: GameState,
): Partial<GameState> | null {
	const { socialStigma, workTool, inventory } = state;

	// 1. "O Rapa" (Fiscaliza√ß√£o)
	// Trigger: socialStigma > 70, chance increases with stigma
	const rapaThreshold = 70;
	if (socialStigma > rapaThreshold) {
		const rapaChance = (socialStigma - rapaThreshold) / 100;
		if (Math.random() < rapaChance) {
			return {
				workTool: {
					type: null,
					condition: 100,
					capacity: 0,
					riskFactor: 0,
					isConfiscated: true, // Foi confiscado pelo Rapa!
				},
				inventory: [], // Perda total
				dignity: Math.max(0, state.dignity - 20),
				socialStigma: Math.min(100, state.socialStigma + 10),
			};
		}
	}

	// Outros eventos podem ser adicionados aqui
	return null;
}

export function applyWeatherEffects(
	state: GameState,
	isRaining: boolean,
): Partial<GameState> {
	if (!isRaining || state.isAtShelter) return {};

	const effects: Partial<GameState> = {
		health: Math.max(0, state.health - 2),
		sanity: Math.max(0, state.sanity - 1),
	};

	if (state.workTool.type === "CARRINHO_RECICLAGEM") {
		effects.workTool = {
			...state.workTool,
			condition: Math.max(0, state.workTool.condition - 5),
		};
	}

	return effects;
}
</file>

<file path="src/features/game-loop/useGameLoop.ts">
import { useEffect, useRef, useState } from "react";
import { useGameContext } from "@/contexts/GameContext";
import { useSurvivalLogic } from "@/hooks/useSurvivalLogic";
import { GAME_DILEMMAS } from "./dilemmas";
import { applyWeatherEffects, processRandomEvents } from "./eventEngine";

export function useGameLoop() {
	const {
		health,
		hunger,
		hygiene,
		energy,
		sanity,
		socialStigma,
		activeBuffs,
		time,
		activeDilemmaId,
		resolvedDilemmas,
		isAtShelter,
		workTool,
		inventory,
		avatar,
		isPaused,
		modifyStat,
		setActiveDilemma,
		advanceTime,
		removeFromInventory,
		setWorkTool,
		addToInventory,
	} = useGameContext();

	const { getSanityDecayMultiplier, checkShelterBarrier } = useSurvivalLogic();

	const lastHourRef = useRef(time);
	const [isRaining, setIsRaining] = useState(false);

	useEffect(() => {
		const interval = setInterval(() => {
			if (isPaused || activeDilemmaId) return;

			if (health <= 0) {
				if (activeDilemmaId !== "game-over") {
					setActiveDilemma("game-over");
				}
				return;
			}

			// 1. Clima Din√¢mico (Chuva)
			if (Math.random() < 0.05) {
				setIsRaining((prev) => !prev);
			}

			// Decad√™ncia passiva suavizada (ritmo de Campinas)
			let hngDecay = 0.2; // Reduzido: -0.5 ‚Üí -0.2 (60% menor)
			let hygDecay = 0.08; // Reduzido: -0.2 ‚Üí -0.08 (60% menor)
			let enrDecay = 0.08; // Reduzido: -0.2 ‚Üí -0.08 (60% menor)
			const snyDecay = 0.08 * getSanityDecayMultiplier(); // Reduzido: -0.2 ‚Üí -0.08 (60% menor)

			if (avatar) {
				if (avatar.ageRange === "jovem") hngDecay += 0.04; // Proporcional
				if (avatar.ageRange === "idoso") enrDecay += 0.04; // Proporcional
				if (avatar.timeOnStreet === "recente") hygDecay += 0.04; // Proporcional
			}

			// 2. Refatora√ß√£o de Invent√°rio (Peso)
			const totalWeight = inventory.reduce((acc, i) => acc + i.weight, 0);
			if (totalWeight > 10 && workTool.type !== "CARRINHO_RECICLAGEM") {
				enrDecay += 0.12; // Sobrecarga f√≠sica (reduzido proporcionalmente)
			}

			// 3. Efeitos Atmosf√©ricos e Eventos Rand√¥micos
			const stateSnap = {
				health,
				hunger,
				hygiene,
				sanity,
				energy,
				socialStigma,
				workTool,
				inventory,
				isAtShelter,
			} as any;

			// Eventos de Clima
			const weatherEffects = applyWeatherEffects(stateSnap, isRaining);
			if (weatherEffects.health)
				modifyStat("health", weatherEffects.health - health);
			if (weatherEffects.workTool) setWorkTool(weatherEffects.workTool);

			// Eventos Rand√¥micos (O Rapa, etc)
			const randomEventEffects = processRandomEvents(stateSnap);
			if (randomEventEffects) {
				if (randomEventEffects.workTool !== undefined)
					setWorkTool(randomEventEffects.workTool);
				if (randomEventEffects.inventory !== undefined) {
					// Simplificado: assume que se mudou invent√°rio, ele foi limpo
					for (const item of inventory) removeFromInventory(item.id);
				}
				if (randomEventEffects.dignity)
					modifyStat("dignity", randomEventEffects.dignity - stateSnap.dignity);
			}

			modifyStat("hunger", -hngDecay);
			modifyStat("hygiene", -hygDecay);
			modifyStat("energy", -enrDecay);
			modifyStat("sanity", -snyDecay);

			// Avan√ßo de tempo autom√°tico
			advanceTime(1);
		}, 10000);

		return () => clearInterval(interval);
	}, [
		health,
		hunger,
		hygiene,
		sanity,
		energy,
		socialStigma,
		activeDilemmaId,
		isPaused,
		modifyStat,
		advanceTime,
		setActiveDilemma,
		avatar,
		inventory,
		workTool,
		isRaining,
		isAtShelter,
		removeFromInventory,
		setWorkTool,
		getSanityDecayMultiplier,
	]);

	// Efeito separado para checar eventos sist√™micos quando a hora muda
	useEffect(() => {
		if (time !== lastHourRef.current) {
			checkSystemicEvents(time);
			lastHourRef.current = time;
		}

		function checkSystemicEvents(currentHour: number) {
			if (activeDilemmaId) return;

			// 1. CHECK DE FERRAMENTA DE TRABALHO (Bloqueio Institucional)
			checkShelterBarrier();

			// 2. CHECK DE CLIMA/ABRIGO (Frio Real)
			if (currentHour >= 22 || currentHour < 5) {
				if (!isAtShelter) {
					const hasCardboard = inventory.some((i) => i.name === "Papel√£o");
					if (hasCardboard) {
						modifyStat("health", -1); // Suavizado com papel√£o
						modifyStat("sanity", -1);
					} else {
						modifyStat("health", -5);
						modifyStat("sanity", -5);
					}
				}
			}

			// 3. Procurar dilemas eleg√≠veis em GAME_DILEMMAS
			for (const dilemma of GAME_DILEMMAS) {
				if (resolvedDilemmas.includes(dilemma.id)) continue;

				// Check Prerequisite (Quest Line)
				if (
					dilemma.prerequisite &&
					!resolvedDilemmas.includes(dilemma.prerequisite)
				) {
					continue;
				}

				let triggered = false;
				const { type, value } = dilemma.trigger;

				switch (type) {
					case "RANDOM":
						if (Math.random() < value) triggered = true;
						break;
					case "HUNGER_LOW":
						if (hunger < value) triggered = true;
						break;
					case "HYGIENE_LOW":
						if (hygiene < value) triggered = true;
						break;
					case "SOCIAL_STIGMA_HIGH":
						if (socialStigma > value) triggered = true;
						break;
				}

				if (triggered) {
					setActiveDilemma(dilemma.id);
					return; // Apenas um dilema por vez
				}
			}

			// 4. Efeito de Seda√ß√£o do CAPS (Sist√™mico)
			if (activeBuffs.includes("SEDADO_CAPS")) {
				modifyStat("energy", -5);
			}
		}
	}, [
		time,
		activeDilemmaId,
		resolvedDilemmas,
		hunger,
		hygiene,
		activeBuffs,
		isAtShelter,
		inventory,
		setActiveDilemma,
		modifyStat,
		checkShelterBarrier,
		socialStigma,
	]);
}
</file>

<file path="src/features/survival-map/NearbyList.tsx">
"use client";

import { useCallback, useMemo, useTransition } from "react";
import { EcoButton } from "@/components/ui/EcoButton";
import { EcoCard } from "@/components/ui/EcoCard";
import { useGameContext } from "@/contexts/GameContext";
import { useServices } from "@/contexts/ServicesContext";

interface NearbyListProps {
	userPosition: [number, number] | null;
}

function calculateDistance(
	lat1: number,
	lon1: number,
	lat2: number,
	lon2: number,
): number {
	const R = 6371; // Radius of the earth in km
	const dLat = deg2rad(lat2 - lat1);
	const dLon = deg2rad(lon2 - lon1);
	const a =
		Math.sin(dLat / 2) * Math.sin(dLat / 2) +
		Math.cos(deg2rad(lat1)) *
			Math.cos(deg2rad(lat2)) *
			Math.sin(dLon / 2) *
			Math.sin(dLon / 2);
	const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
	const d = R * c; // Distance in km
	return d;
}

function deg2rad(deg: number): number {
	return deg * (Math.PI / 180);
}

export function NearbyList({ userPosition }: NearbyListProps) {
	const { services } = useServices();
	const { modifyStat, addMoney, addBuff, advanceTime, socialStigma, hygiene } =
		useGameContext();
	const [_isPending, startTransition] = useTransition();

	const sortedServices = useMemo(() => {
		if (!userPosition) return services;

		return [...services]
			.map((service) => {
				const dist = calculateDistance(
					userPosition[0],
					userPosition[1],
					service.coords[0],
					service.coords[1],
				);
				return { ...service, distance: dist };
			})
			.sort((a, b) => (a.distance || 0) - (b.distance || 0));
	}, [services, userPosition]);

	// Optimize with useCallback and useTransition to avoid blocking UI
	const handleUseService = useCallback(
		(service: any) => {
			if (!service.effects) {
				alert(
					"Este servi√ßo n√£o possui efeitos imediatos, mas voc√™ pode ir at√© l√°.",
				);
				return;
			}

			// Use startTransition to avoid blocking the UI thread
			startTransition(() => {
				// Aplicar efeitos
				Object.entries(service.effects).forEach(([key, value]) => {
					if (typeof value === "number") {
						if (key === "money") {
							addMoney(value);
						} else {
							modifyStat(key as any, value);
						}
					} else if (key === "addBuff" && typeof value === "string") {
						addBuff(value);
					}
				});

				// Custo de tempo padr√£o: 1 hora
				advanceTime(1);

				alert(`${service.name} utilizado. Efeitos aplicados.`);
			});
		},
		[addMoney, modifyStat, addBuff, advanceTime],
	);

	return (
		<div className="space-y-4">
			<h3 className="text-xl font-bold text-white">
				Rede de Apoio Pr√≥xima (Campinas)
			</h3>

			{!userPosition && (
				<p className="text-zinc-500 text-sm italic">
					Aguardando localiza√ß√£o para calcular dist√¢ncias e disponibilidade...
				</p>
			)}

			<div className="flex flex-col gap-3">
				{sortedServices.map((service) => {
					const distanceFormatted =
						"distance" in service
							? (service as any).distance < 1
								? `${Math.round((service as any).distance * 1000)}m`
								: `${(service as any).distance.toFixed(1)}km`
							: null;

					return (
						<EcoCard
							key={service.id}
							className="border-zinc-800 p-4 bg-zinc-950/50 backdrop-blur-sm group hover:border-emerald-500/30 transition-colors"
						>
							<div className="flex justify-between items-start">
								<div className="flex-1">
									<h4 className="font-bold text-lg text-white group-hover:text-emerald-400 transition-colors">
										{service.name}
									</h4>
									<div className="flex gap-2 items-center mt-1">
										<span className="text-[10px] px-2 py-0.5 bg-zinc-900 text-zinc-300 rounded uppercase font-bold tracking-wider">
											{service.type}
										</span>
										{distanceFormatted && (
											<span className="text-xs font-mono text-emerald-400 font-bold bg-emerald-900/10 px-2 rounded">
												{distanceFormatted}
											</span>
										)}
									</div>
									{service.description && (
										<p className="text-xs text-zinc-400 mt-2 line-clamp-2 italic">
											{service.description}
										</p>
									)}
								</div>
							</div>

							<div className="mt-4 flex gap-2">
								<EcoButton
									variant="ghost"
									size="sm"
									aria-label={`Tra√ßar rota para ${service.name}`}
									className="flex-1 text-[10px] uppercase font-bold h-9 bg-zinc-800 border-zinc-700 hover:bg-zinc-700"
									onClick={() => {
										const url = `https://www.google.com/maps/dir/?api=1&destination=${service.coords[0]},${service.coords[1]}`;
										window.open(url, "_blank");
									}}
								>
									Tra√ßar Rota
								</EcoButton>
								<EcoButton
									variant="primary"
									size="sm"
									aria-label={`Utilizar servi√ßo ${service.name}`}
									disabled={
										(service.type === "com√©rcio" ||
											service.type === "privado") &&
										socialStigma > 70 &&
										hygiene < 30
									}
									className="flex-1 text-[10px] uppercase font-bold h-9 bg-emerald-600 hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 disabled:opacity-50 disabled:bg-zinc-700 disabled:cursor-not-allowed"
									onClick={() => handleUseService(service)}
								>
									{(service.type === "com√©rcio" ||
										service.type === "privado") &&
									socialStigma > 70 &&
									hygiene < 30
										? "Barrado"
										: "Utilizar"}
								</EcoButton>
							</div>
							{(service.type === "com√©rcio" || service.type === "privado") &&
								socialStigma > 70 &&
								hygiene < 30 && (
									<p className="text-[10px] text-red-400 mt-2 text-center font-medium animate-pulse">
										"O seguran√ßa barrou sua entrada pela sua apar√™ncia."
									</p>
								)}
						</EcoCard>
					);
				})}
			</div>
		</div>
	);
}
</file>

<file path="src/features/ui/AvatarCreation.tsx">
"use client";

import {
	ArrowLeft,
	ArrowRight,
	Camera,
	Info,
	Shield,
	Sparkles,
	Target,
	User,
} from "lucide-react";
import Image from "next/image";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { type Avatar, useGameContext } from "@/contexts/GameContext";

interface AvatarCreationProps {
	onComplete: () => void;
	onBack: () => void;
}

const AVATAR_OPTIONS = [
	{
		id: "/avatars/avatar_1.png",
		label: "Identidade A",
		gender: "masculino",
		age: "maduro",
	},
	{
		id: "/avatars/avatar_2.png",
		label: "Identidade B",
		gender: "trans",
		age: "adulto",
	},
];

export function AvatarCreation({ onComplete, onBack }: AvatarCreationProps) {
	const { setAvatar, resetGame } = useGameContext();
	const [step, setStep] = useState(1);
	const [formData, setFormData] = useState<Avatar>({
		name: "",
		gender: "masculino",
		ethnicity: "branco",
		ageRange: "adulto",
		timeOnStreet: "recente",
		startingSkill: "nenhuma",
		avatarImage: AVATAR_OPTIONS[0].id,
	});

	const handleNext = () => {
		if (step < 5) setStep(step + 1);
		else {
			resetGame();
			setAvatar(formData);
			onComplete();
		}
	};

	const handleBack = () => {
		if (step > 1) setStep(step - 1);
		else onBack();
	};

	const updateField = (field: keyof Avatar, value: string) => {
		setFormData((prev) => ({ ...prev, [field]: value }));
	};

	return (
		<div className="flex flex-col items-center justify-center min-h-[650px] w-full max-w-2xl mx-auto p-8 bg-slate-900/60 backdrop-blur-2xl border border-white/10 rounded-[40px] shadow-2xl animate-fade-in relative overflow-hidden">
			{/* Decorative elements */}
			<div className="absolute -top-24 -right-24 w-48 h-48 bg-blue-600/10 rounded-full blur-3xl"></div>
			<div className="absolute -bottom-24 -left-24 w-48 h-48 bg-pink-600/10 rounded-full blur-3xl"></div>

			{/* Header */}
			<div className="w-full mb-10 text-center relative z-10">
				<div className="inline-flex items-center gap-2 bg-blue-500/20 border border-blue-400/30 px-4 py-1.5 rounded-full text-blue-300 text-xs font-black mb-6 uppercase tracking-widest">
					<User className="h-4 w-4" />
					Constru√ß√£o de Identidade
				</div>
				<h2 className="text-4xl font-black text-white mb-2 italic tracking-tighter">
					Quem √© voc√™ nesta jornada?
				</h2>
				<p className="text-slate-400 text-sm font-sans">
					Cada detalhe molda as intera√ß√µes e desafios que vir√£o.
				</p>

				<div className="flex justify-center gap-2 mt-8">
					{[1, 2, 3, 4, 5].map((s) => (
						<div
							key={s}
							className={`h-1.5 w-10 rounded-full transition-all duration-500 ${step >= s ? "bg-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.5)]" : "bg-slate-800"}`}
						/>
					))}
				</div>
			</div>

			{/* Step Content */}
			<div className="w-full flex-1 relative z-10">
				{step === 1 && (
					<div className="space-y-8 animate-slide-up">
						<div className="space-y-4">
							<label className="block text-sm font-black text-slate-400 uppercase tracking-widest">
								Como seu personagem √© chamado?
							</label>
							<Input
								value={formData.name}
								onChange={(e) => updateField("name", e.target.value)}
								placeholder="Ex: Z√© do P√°tio, Maria da Pra√ßa..."
								className="bg-slate-800/50 border-slate-700 text-white h-14 text-xl font-bold focus:ring-blue-500 rounded-2xl placeholder:text-slate-600"
							/>
						</div>
						<div className="grid grid-cols-2 gap-6">
							<div className="space-y-4">
								<label className="block text-sm font-black text-slate-400 uppercase tracking-widest">
									G√™nero
								</label>
								<select
									title="Selecione o g√™nero"
									className="w-full bg-slate-800/50 border border-slate-700 rounded-2xl p-4 text-white font-bold focus:ring-blue-500"
									value={formData.gender}
									onChange={(e) => updateField("gender", e.target.value)}
								>
									<option value="masculino">Masculino</option>
									<option value="feminino">Feminino</option>
									<option value="trans">Trans / Travesti</option>
									<option value="nao-binario">N√£o-bin√°rio</option>
								</select>
							</div>
							<div className="space-y-4">
								<label className="block text-sm font-black text-slate-400 uppercase tracking-widest">
									Faixa Et√°ria
								</label>
								<select
									title="Selecione a faixa et√°ria"
									className="w-full bg-slate-800/50 border border-slate-700 rounded-2xl p-4 text-white font-bold focus:ring-blue-500"
									value={formData.ageRange}
									onChange={(e) => updateField("ageRange", e.target.value)}
								>
									<option value="jovem">Jovem (18-29)</option>
									<option value="adulto">Adulto (30-59)</option>
									<option value="idoso">Idoso (60+)</option>
								</select>
							</div>
						</div>
					</div>
				)}

				{step === 2 && (
					<div className="space-y-8 animate-slide-up">
						<div className="flex items-center gap-3 mb-2">
							<Camera size={20} className="text-blue-500" />
							<label className="block text-sm font-black text-slate-400 uppercase tracking-widest">
								Selecione uma Imagem de Identidade
							</label>
						</div>
						<div className="grid grid-cols-2 gap-8">
							{AVATAR_OPTIONS.map((opt) => (
								<button
									key={opt.id}
									onClick={() => updateField("avatarImage", opt.id)}
									className={`relative aspect-square rounded-3xl overflow-hidden border-4 transition-all duration-300 group
										${formData.avatarImage === opt.id ? "border-blue-500 scale-105 shadow-[0_0_40px_rgba(59,130,246,0.3)]" : "border-slate-800 hover:border-slate-600"}
									`}
								>
									<Image
										src={opt.id}
										alt={opt.label}
										fill
										className={`object-cover ${formData.avatarImage === opt.id ? "opacity-100" : "opacity-40 hover:opacity-100"} transition-opacity`}
									/>
									<div
										className={`absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent transition-transform
										${formData.avatarImage === opt.id ? "translate-y-0" : "translate-y-full group-hover:translate-y-0"}
									`}
									>
										<span className="text-white font-black text-xs uppercase tracking-tighter">
											{opt.label}
										</span>
									</div>
								</button>
							))}
						</div>
					</div>
				)}

				{step === 3 && (
					<div className="space-y-6 animate-slide-up">
						<label className="block text-sm font-black text-slate-400 uppercase tracking-widest mb-6">
							Etnia (Fator de Estigma Social Inicial)
						</label>
						<div className="grid grid-cols-2 gap-4">
							{["branco", "preto", "pardo", "indigena"].map((eth) => (
								<button
									key={eth}
									onClick={() => updateField("ethnicity", eth)}
									className={`p-6 rounded-2xl border-2 text-left transition-all relative group ${formData.ethnicity === eth ? "bg-blue-600 border-blue-400 scale-[1.02] shadow-xl" : "bg-slate-800/40 border-slate-800 hover:border-slate-600"}`}
								>
									<span
										className={`capitalize font-black text-lg ${formData.ethnicity === eth ? "text-white" : "text-slate-300"}`}
									>
										{eth}
									</span>
									{eth === "preto" || eth === "pardo" ? (
										<p
											className={`text-[10px] font-bold mt-2 flex items-center gap-1 uppercase ${formData.ethnicity === eth ? "text-blue-100" : "text-blue-500"}`}
										>
											<Shield className="h-4 w-4" /> Maior risco de abordagem
										</p>
									) : (
										<p className="text-[10px] text-slate-500 mt-2 uppercase font-bold tracking-tighter">
											Baixo estigma inicial
										</p>
									)}
								</button>
							))}
						</div>
					</div>
				)}

				{step === 4 && (
					<div className="space-y-6 animate-slide-up">
						<label className="block text-sm font-black text-slate-400 uppercase tracking-widest mb-6">
							Tempo de Sobreviv√™ncia na Rua
						</label>
						<div className="flex flex-col gap-5">
							<button
								onClick={() => updateField("timeOnStreet", "recente")}
								className={`p-8 rounded-3xl border-2 text-left transition-all ${formData.timeOnStreet === "recente" ? "bg-blue-600 border-blue-400 shadow-2xl" : "bg-slate-800/40 border-slate-800"}`}
							>
								<div className="flex justify-between items-center mb-3">
									<span
										className={`font-black uppercase tracking-tight text-xl ${formData.timeOnStreet === "recente" ? "text-white" : "text-slate-200"}`}
									>
										Rec√©m-chegado
									</span>
									<Sparkles className="h-6 w-6 text-yellow-400" />
								</div>
								<p className="text-sm text-blue-100/80 font-sans italic">
									"A mem√≥ria da casa ainda √© viva, mas as noites s√£o frias e
									confusas."
								</p>
								<div className="mt-6 flex gap-3">
									<span className="text-[10px] bg-white/20 px-3 py-1 rounded-full text-white font-black uppercase tracking-widest">
										+ Resili√™ncia Ps√≠quica
									</span>
									<span className="text-[10px] bg-red-400/20 px-3 py-1 rounded-full text-red-100 font-black uppercase tracking-widest">
										- Senso de Dire√ß√£o
									</span>
								</div>
							</button>
							<button
								onClick={() => updateField("timeOnStreet", "veterano")}
								className={`p-8 rounded-3xl border-2 text-left transition-all ${formData.timeOnStreet === "veterano" ? "bg-blue-600 border-blue-400 shadow-2xl" : "bg-slate-800/40 border-slate-800"}`}
							>
								<div className="flex justify-between items-center mb-3">
									<span
										className={`font-black uppercase tracking-tight text-xl ${formData.timeOnStreet === "veterano" ? "text-white" : "text-slate-200"}`}
									>
										Veterano
									</span>
									<Target className="h-6 w-6 text-orange-500" />
								</div>
								<p className="text-sm text-blue-100/80 font-sans italic">
									"Conhe√ßo cada marquise de Campinas, mas o corpo pede
									descanso."
								</p>
								<div className="mt-6 flex gap-3">
									<span className="text-[10px] bg-white/20 px-3 py-1 rounded-full text-white font-black uppercase tracking-widest">
										+ Recursos Iniciais
									</span>
									<span className="text-[10px] bg-red-400/20 px-3 py-1 rounded-full text-red-100 font-black uppercase tracking-widest">
										- Sanidade Cr√≠tica
									</span>
								</div>
							</button>
						</div>
					</div>
				)}

				{step === 5 && (
					<div className="space-y-10 animate-slide-up">
						<div className="flex flex-col md:flex-row gap-10 items-center bg-blue-600/10 border border-blue-500/20 p-10 rounded-[40px]">
							<div className="relative w-40 h-40 rounded-3xl overflow-hidden border-4 border-blue-500 shadow-2xl flex-none">
								<Image
									src={formData.avatarImage || AVATAR_OPTIONS[0].id}
									alt="Avatar Final"
									fill
									className="object-cover"
								/>
							</div>
							<div className="space-y-4 flex-1 text-left w-full">
								<h3 className="text-3xl font-black text-white italic">
									{formData.name}
								</h3>
								<div className="grid grid-cols-2 gap-4">
									<InfoItem label="G√™nero" value={formData.gender} />
									<InfoItem label="Etnia" value={formData.ethnicity} />
									<InfoItem label="Idade" value={formData.ageRange} />
									<InfoItem label="Contexto" value={formData.timeOnStreet} />
								</div>
							</div>
						</div>
						<div className="flex items-start gap-4 p-6 bg-yellow-500/10 border border-yellow-500/20 rounded-3xl text-left">
							<div className="bg-yellow-500/20 p-2 rounded-lg">
								<Info className="h-6 w-6 text-yellow-400 shrink-0" />
							</div>
							<p className="text-sm text-yellow-200/80 leading-relaxed font-sans">
								<strong>Importante:</strong> Suas caracter√≠sticas baseadas em
								fatos sociol√≥gicos da Regi√£o de Campinas determinar√£o como
								institui√ß√µes (SOS Rua, Guarda Municipal) e cidad√£os interagem
								com voc√™.
							</p>
						</div>
					</div>
				)}
			</div>

			{/* Footer Buttons */}
			<div className="w-full flex gap-4 mt-12 relative z-10">
				<Button
					variant="ghost"
					onClick={handleBack}
					className="flex-1 text-slate-500 hover:text-white font-black uppercase tracking-widest h-14 rounded-2xl"
				>
					<ArrowLeft className="h-4 w-4 mr-2" /> Voltar
				</Button>
				<Button
					onClick={handleNext}
					disabled={step === 1 && !formData.name}
					className="flex-[2] bg-blue-600 hover:bg-blue-700 text-white font-black uppercase tracking-widest h-14 rounded-2xl transition-all shadow-xl shadow-blue-500/40"
				>
					{step === 5 ? "Iniciar Jornada" : "Pr√≥ximo Passo"}{" "}
					<ArrowRight className="h-4 w-4 ml-2" />
				</Button>
			</div>
		</div>
	);
}

function InfoItem({ label, value }: { label: string; value: string }) {
	return (
		<div className="space-y-1">
			<span className="text-[10px] font-black text-blue-400 uppercase tracking-widest block">
				{label}
			</span>
			<span className="text-white font-bold capitalize">{value}</span>
		</div>
	);
}
</file>

<file path="src/services/telemetry.ts">
export enum TelemetryAction {
	CLICK = "CLICK",
	VIEW = "VIEW",
	ERROR = "ERROR",
	GAME_EVENT = "GAME_EVENT",
	SYNC = "SYNC",
	ODS_METRIC = "ODS_METRIC",
}

export interface TelemetryEvent {
	id: string;
	timestamp: number;
	action_type: TelemetryAction;
	metadata: Record<string, unknown>;
	synced: number; // 0 = false, 1 = true (booleans are not always valid keys in TS definitions)
}

const DB_NAME = "telemetry_db";
const STORE_NAME = "events";
const DB_VERSION = 1;

class TelemetryService {
	private static instance: TelemetryService;
	private dbPromise: Promise<IDBDatabase> | null = null;

	private constructor() {
		this.initDB();
	}

	public static getInstance(): TelemetryService {
		if (!TelemetryService.instance) {
			TelemetryService.instance = new TelemetryService();
		}
		return TelemetryService.instance;
	}

	private initDB(): Promise<IDBDatabase> {
		if (this.dbPromise) return this.dbPromise;

		if (typeof window === "undefined" || !("indexedDB" in window)) {
			// Handle server-side or non-supported environments gracefully
			return Promise.reject("IndexedDB not supported");
		}

		this.dbPromise = new Promise((resolve, reject) => {
			const request = indexedDB.open(DB_NAME, DB_VERSION);

			request.onerror = (event) => {
				console.error("TelemetryDB error:", event);
				reject(event);
			};

			request.onsuccess = (event) => {
				resolve((event.target as IDBOpenDBRequest).result);
			};

			request.onupgradeneeded = (event) => {
				const db = (event.target as IDBOpenDBRequest).result;
				if (!db.objectStoreNames.contains(STORE_NAME)) {
					const objectStore = db.createObjectStore(STORE_NAME, {
						keyPath: "id",
					});
					objectStore.createIndex("synced", "synced", { unique: false });
				}
			};
		});

		return this.dbPromise;
	}

	public async track(
		action_type: TelemetryAction,
		metadata: Record<string, unknown> = {},
	): Promise<void> {
		try {
			const db = await this.initDB();
			const event: TelemetryEvent = {
				id: crypto.randomUUID(),
				timestamp: Date.now(),
				action_type,
				metadata,
				synced: 0,
			};

			return new Promise((resolve, reject) => {
				const transaction = db.transaction([STORE_NAME], "readwrite");
				const store = transaction.objectStore(STORE_NAME);
				const request = store.add(event);

				request.onsuccess = () => resolve();
				request.onerror = () => reject(request.error);
			});
		} catch (error) {
			console.warn("Failed to track telemetry event:", error);
		}
	}

	public async getUnsyncedEvents(): Promise<TelemetryEvent[]> {
		try {
			const db = await this.initDB();
			return new Promise((resolve, reject) => {
				const transaction = db.transaction([STORE_NAME], "readonly");
				const store = transaction.objectStore(STORE_NAME);
				const index = store.index("synced");
				// use 0 for unsynced
				const request = index.getAll(0);

				request.onsuccess = () => {
					resolve(request.result);
				};
				request.onerror = () => reject(request.error);
			});
		} catch (_error) {
			return [];
		}
	}

	public async markAsSynced(ids: string[]): Promise<void> {
		try {
			const db = await this.initDB();
			// We need to update items.
			// Efficient way: read them, update, put back.
			// Or cursor.
			// For simplicity/safety in async context:
			const transaction = db.transaction([STORE_NAME], "readwrite");
			const store = transaction.objectStore(STORE_NAME);

			return new Promise((resolve, reject) => {
				// We'll just do it individually for now as IDB bulk ops are manual
				let completed = 0;
				if (ids.length === 0) {
					resolve();
					return;
				}

				ids.forEach((id) => {
					const getReq = store.get(id);
					getReq.onsuccess = () => {
						const item = getReq.result as TelemetryEvent;
						if (item) {
							item.synced = 1;
							store.put(item);
						}
						completed++;
						if (completed === ids.length) resolve();
					};
					getReq.onerror = () => {
						completed++; // count errors to avoid hanging
						if (completed === ids.length) resolve();
					};
				});

				transaction.onerror = () => reject(transaction.error);
				transaction.oncomplete = () => resolve();
			});
		} catch (error) {
			console.error("Failed to mark synced:", error);
		}
	}
}

export const telemetryService = TelemetryService.getInstance();
</file>

<file path="src/contexts/GameContext.tsx">
"use client";

import type React from "react";
import {
	createContext,
	useCallback,
	useContext,
	useEffect,
	useMemo,
	useState,
} from "react";
import { useOfflineDB } from "@/features/offline-db/useOfflineDB";
import { TelemetryAction, telemetryService } from "@/services/telemetry";

export interface Avatar {
	name: string;
	gender: "masculino" | "feminino" | "trans" | "nao-binario";
	ethnicity: "branco" | "preto" | "pardo" | "indigena";
	ageRange: "jovem" | "adulto" | "idoso";
	timeOnStreet: "recente" | "veterano";
	startingSkill: "reciclagem" | "artesao" | "vendedor" | "nenhuma";
	avatarImage?: string;
}

export interface Item {
	id: string;
	name: string;
	weight: number;
	type: "valioso" | "sobrevivencia";
}

/**
 * Interface para eventos s√©rios baseados na realidade da popula√ß√£o de rua
 * Baseado em SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md e eventos reais
 */
export interface SeriousEvent {
	id: string;
	title: string;
	description: string; // Narrativa visceral da realidade
	triggerCondition: (state: GameState) => boolean;
	choices: {
		label: string;
		risk: number; // % de falha (0-100)
		socialImpact: "POSITIVE" | "NEGATIVE"; // Afeta socialStigma
		outcome: (state: GameState) => Partial<GameState>;
	}[];
	audioId?: string; // Para imers√£o sonora
	glossaryTerms?: string[]; // Termos t√©cnicos grifados (ex: "LOAS", "Pop Rua")
}

export interface GameState {
	health: number;
	hunger: number;
	hygiene: number;
	sanity: number; // TODO: Renomear para mentalHealth em refatora√ß√£o futura
	energy: number;
	dignity: number; // 0 = Game Over por desist√™ncia
	socialStigma: number; // Quanto maior, mais preconceito
	stabilityGap: number;
	money: number;
	workTool: {
		type: "CARRINHO_RECICLAGEM" | "SACO_PRETO" | null;
		condition: number; // 0-100 (Afeta quanto peso pode carregar)
		capacity: number; // kg
		riskFactor: number;
		isConfiscated: boolean; // Se foi levado pelo "Rapa"
	};
	documents: {
		hasRG: boolean;
		hasCPF: boolean;
		hasComprovanteResidencia: boolean; // Item raro/dif√≠cil de conseguir
	};
	activeBuffs: string[];
	isAtShelter: boolean;
	inventory: Item[];
	day: number;
	time: number;
	resolvedDilemmas: string[];
	activeDilemmaId: string | null;
	criticalHealth: boolean;
	avatar: Avatar | null;
	isPaused: boolean;
}

interface GameContextProps extends GameState {
	modifyStat: (
		stat: keyof Omit<
			GameState,
			| "inventory"
			| "day"
			| "time"
			| "resolvedDilemmas"
			| "activeBuffs"
			| "workTool"
			| "criticalHealth"
			| "avatar"
			| "isPaused"
		>,
		amount: number,
	) => void;
	addMoney: (amount: number) => void;
	advanceTime: (hours: number) => void;
	markDilemmaResolved: (id: string) => void;
	setActiveDilemma: (id: string | null) => void;
	setAtShelter: (value: boolean) => void;
	setWorkTool: (tool: GameState["workTool"]) => void;
	addBuff: (buff: string) => void;
	removeBuff: (buff: string) => void;
	addToInventory: (item: Item | string) => void;
	removeFromInventory: (itemId: string) => void;
	setAvatar: (avatar: Avatar) => void;
	setPaused: (value: boolean) => void;
	eat: (amount: number) => void;
	sleep: (isSafe: boolean) => Promise<void>;
	work: (hours: number) => void;
	resetGame: () => void;
}

const INITIAL_STATE: GameState = {
	health: 100,
	hunger: 100,
	hygiene: 50,
	sanity: 80,
	energy: 100,
	dignity: 50,
	socialStigma: 10,
	stabilityGap: 20,
	money: 10,
	workTool: {
		type: null,
		condition: 100,
		capacity: 0,
		riskFactor: 0,
		isConfiscated: false, // N√£o foi confiscado inicialmente
	},
	documents: {
		hasRG: false, // Maioria n√£o tem documentos no in√≠cio
		hasCPF: false,
		hasComprovanteResidencia: false, // Raramente possui
	},
	activeBuffs: [],
	isAtShelter: false,
	inventory: [],
	resolvedDilemmas: [],
	activeDilemmaId: null,
	day: 1,
	time: 8,
	criticalHealth: false,
	avatar: null,
	isPaused: false,
};

const GameContext = createContext<GameContextProps | undefined>(undefined);

export function GameProvider({ children }: { children: React.ReactNode }) {
	const [state, setState] = useState<GameState>(INITIAL_STATE);
	const [hasHydrated, setHasHydrated] = useState(false);
	const db = useOfflineDB();

	// ID do documento no PouchDB
	const DOC_ID = "current_game_state";

	// Load from PouchDB
	useEffect(() => {
		let isMounted = true;
		if (!db) return;

		async function loadState() {
			if (!db || !isMounted) return;
			try {
				const doc: any = await db.get(DOC_ID);
				if (!isMounted) return;

				// biome-ignore lint/performance/noDelete: we want to strip PouchDB metadata
				delete doc._id;
				// biome-ignore lint/performance/noDelete: we want to strip PouchDB metadata
				delete doc._rev;

				setState((prev) => ({
					...prev,
					...doc,
					// Garante que isPaused seja consistente
					isPaused: doc.activeDilemmaId !== null,
				}));
			} catch (e: any) {
				if (e.status !== 404 && isMounted) {
					console.error("Failed to load game state from PouchDB", e);
				}
			} finally {
				if (isMounted) setHasHydrated(true);
			}
		}

		loadState();
		return () => {
			isMounted = false;
		};
	}, [db]);

	// Debounced Save to PouchDB
	useEffect(() => {
		const isMounted = true;
		if (!hasHydrated || !db) return;

		const timeoutId = setTimeout(async () => {
			try {
				if (!db || !isMounted) return;

				let rev: string | undefined;
				try {
					const existing: any = await db.get(DOC_ID);
					if (!isMounted) return;
					rev = existing._rev;
				} catch (e: any) {
					if (e.status !== 404) {
						if (!isMounted) return;
						// If it's a connection error, skip this save
						if (
							e.name === "InvalidStateError" ||
							e.message?.includes("closing")
						) {
							console.warn("Database connection is closing, skipping save");
							return;
						}
						throw e;
					}
				}

				await db.put({
					_id: DOC_ID,
					_rev: rev,
					...state,
				});
			} catch (e: any) {
				// Silently handle closing connection errors or common IndexedDB failures
				if (
					e.name === "InvalidStateError" ||
					e.message?.includes("closing") ||
					e.message?.includes("connection is closing")
				) {
					console.warn(
						"Database connection already closed or closing - temporary state preserved in RAM",
					);
				} else {
					console.error("Critical failure saving game state to PouchDB", e);
				}
			}
		}, 1000); // 1-second debounce

		return () => clearTimeout(timeoutId);
	}, [state, hasHydrated, db]);

	// Sync isPaused with activeDilemmaId
	useEffect(() => {
		if (state.activeDilemmaId !== null && !state.isPaused) {
			setState((prev) => ({ ...prev, isPaused: true }));
		} else if (state.activeDilemmaId === null && state.isPaused) {
			setState((prev) => ({ ...prev, isPaused: false }));
		}
	}, [state.activeDilemmaId, state.isPaused]);

	const modifyStat = useCallback((stat: any, amount: number) => {
		setState((prev) => {
			let newValue = (prev[stat as keyof GameState] as number) + amount;

			if (stat !== "money") {
				newValue = Math.max(0, Math.min(100, newValue));
			} else {
				newValue = Math.max(0, newValue);
			}

			const newState = { ...prev, [stat]: newValue };

			if (stat === "hunger" && newValue === 0) {
				newState.health = Math.max(0, prev.health - 5);
			}

			if (stat === "health" || (stat === "hunger" && newValue === 0)) {
				newState.criticalHealth = newState.health < 20;
			}

			return newState;
		});
	}, []);

	const addMoney = useCallback((amount: number) => {
		setState((prev) => ({
			...prev,
			money: Math.max(0, prev.money + amount),
		}));
	}, []);

	const advanceTime = useCallback((hours: number) => {
		setState((prev) => {
			if (prev.isPaused) return prev; // Security check

			let newTime = prev.time + hours;
			let newDay = prev.day;

			if (newTime >= 24) {
				newTime -= 24;
				newDay += 1;
			}

			return { ...prev, time: newTime, day: newDay };
		});
	}, []);

	const markDilemmaResolved = useCallback((id: string) => {
		setState((prev) => ({
			...prev,
			resolvedDilemmas: [...prev.resolvedDilemmas, id],
		}));
	}, []);

	const setActiveDilemma = useCallback((id: string | null) => {
		setState((prev) => ({
			...prev,
			activeDilemmaId: id,
			isPaused: id !== null,
		}));
	}, []);

	const setAtShelter = useCallback((value: boolean) => {
		setState((prev) => ({ ...prev, isAtShelter: value }));
	}, []);

	const setWorkTool = useCallback((tool: GameState["workTool"]) => {
		setState((prev) => ({ ...prev, workTool: tool }));
	}, []);

	const addBuff = useCallback((buff: string) => {
		setState((prev) => ({
			...prev,
			activeBuffs: prev.activeBuffs.includes(buff)
				? prev.activeBuffs
				: [...prev.activeBuffs, buff],
		}));
	}, []);

	const removeBuff = useCallback((buff: string) => {
		setState((prev) => ({
			...prev,
			activeBuffs: prev.activeBuffs.filter((b) => b !== buff),
		}));
	}, []);

	const addToInventory = useCallback((itemOrId: Item | string) => {
		setState((prev) => {
			const newItem: Item =
				typeof itemOrId === "string"
					? { id: itemOrId, name: itemOrId, weight: 1, type: "sobrevivencia" }
					: itemOrId;

			return {
				...prev,
				inventory: prev.inventory.some((i) => i.id === newItem.id)
					? prev.inventory
					: [...prev.inventory, newItem],
			};
		});
	}, []);

	const removeFromInventory = useCallback((itemId: string) => {
		setState((prev) => ({
			...prev,
			inventory: prev.inventory.filter((i) => i.id !== itemId),
		}));
	}, []);

	const setAvatar = useCallback((avatar: Avatar) => {
		setState((prev) => {
			const newState = { ...prev, avatar };

			if (avatar.ethnicity === "preto" || avatar.ethnicity === "pardo") {
				newState.socialStigma += 15;
			}
			if (avatar.gender === "trans" || avatar.gender === "feminino") {
				newState.sanity -= 5;
				newState.stabilityGap += 5;
			}
			if (avatar.timeOnStreet === "veterano") {
				newState.sanity -= 20;
				newState.stabilityGap -= 10;
				newState.workTool = {
					type: "CARRINHO_RECICLAGEM",
					condition: 50,
					capacity: 100,
					riskFactor: 30,
					isConfiscated: false, // Ainda tem o carrinho
				};
			}

			return newState;
		});
	}, []);

	const setPaused = useCallback((value: boolean) => {
		setState((prev) => ({ ...prev, isPaused: value }));
	}, []);

	const eat = useCallback(
		(amount: number) => {
			modifyStat("hunger", amount);
			modifyStat("energy", 5);
		},
		[modifyStat],
	);

	const sleep = useCallback(
		async (isSafe: boolean) => {
			if (!isSafe) {
				await telemetryService.track(TelemetryAction.GAME_EVENT, {
					type: "RISKY_SLEEP",
					hunger: state.hunger,
					health: state.health,
				});
			}
			setState((prev) => ({
				...prev,
				health: Math.min(100, prev.health + 20),
				energy: 100,
				hunger: Math.max(0, prev.hunger - 10),
			}));
		},
		[state.hunger, state.health],
	);

	const work = useCallback(
		(hours: number) => {
			addMoney(hours * 10);
			modifyStat("hunger", -(hours * 5));
			modifyStat("energy", -(hours * 10));
			advanceTime(hours);
		},
		[addMoney, modifyStat, advanceTime],
	);

	const resetGame = useCallback(async () => {
		if (db) {
			try {
				const doc = await db.get(DOC_ID);
				await db.remove(doc);
			} catch (_e) {
				// ignore if doc not found
			}
		}
		setState(INITIAL_STATE);
	}, [db]);

	const value = useMemo(
		() => ({
			...state,
			modifyStat,
			addMoney,
			advanceTime,
			markDilemmaResolved,
			setActiveDilemma,
			setAtShelter,
			setWorkTool,
			addBuff,
			removeBuff,
			addToInventory,
			removeFromInventory,
			setAvatar,
			setPaused,
			eat,
			sleep,
			work,
			resetGame,
		}),
		[
			state,
			modifyStat,
			addMoney,
			advanceTime,
			markDilemmaResolved,
			setActiveDilemma,
			setAtShelter,
			setWorkTool,
			addBuff,
			removeBuff,
			addToInventory,
			removeFromInventory,
			setAvatar,
			setPaused,
			eat,
			sleep,
			work,
			resetGame,
		],
	);

	if (!hasHydrated) return null;

	return <GameContext.Provider value={value}>{children}</GameContext.Provider>;
}

export function useGameContext() {
	const context = useContext(GameContext);
	if (context === undefined) {
		throw new Error("useGameContext must be used within a GameProvider");
	}
	return context;
}
</file>

<file path="src/features/ui/DilemmaModal.tsx">
"use client";

import { X } from "lucide-react";
import { useState } from "react";
import { Button } from "@/components/ui/button";
import {
	Dialog,
	DialogContent,
	DialogDescription,
	DialogFooter,
	DialogHeader,
	DialogTitle,
} from "@/components/ui/dialog";
import type { Dilemma } from "@/features/game-loop/dilemmas";

interface DilemmaModalProps {
	dilemma: Dilemma | null;
	onResolve: (optionIndex: number) => void;
	onClose: () => void;
}

export function DilemmaModal({
	dilemma,
	onResolve,
	onClose,
}: DilemmaModalProps) {
	const [selectedOption, setSelectedOption] = useState<number | null>(null);

	if (!dilemma) return null;

	const handleOptionSelect = (index: number) => {
		setSelectedOption(index);
	};

	const handleContinue = () => {
		if (selectedOption !== null) {
			onResolve(selectedOption);
		} else {
			onClose();
		}
		setSelectedOption(null);
	};

	const currentOption =
		selectedOption !== null ? dilemma.options[selectedOption] : null;

	return (
		<Dialog
			open={!!dilemma}
			onOpenChange={(open) => {
				if (!open) handleContinue();
			}}
		>
			<DialogContent className="sm:max-w-[500px] border border-slate-800 bg-black text-slate-300 rounded-none p-0 overflow-hidden shadow-[0_0_50px_rgba(0,0,0,1)]">
				{/* Header decorativo t√©cnico */}
				<div className="h-1 w-full bg-slate-900" />

				<div className="p-8">
					{/* Close Button */}
					<button
						type="button"
						onClick={handleContinue}
						className="absolute top-4 right-4 text-slate-700 hover:text-white transition-colors p-1"
						aria-label="Fechar modal"
					>
						<X size={16} />
					</button>

					<DialogHeader className="space-y-4">
						<DialogTitle className="text-xl font-mono uppercase tracking-[0.3em] text-slate-100 pr-10 border-b border-slate-900 pb-4">
							{currentOption
								? "Impacto_Sist√™mico"
								: dilemma.title.replace(" ", "_")}
						</DialogTitle>
						<DialogDescription className="text-slate-400 text-base leading-relaxed font-serif italic pt-2">
							{currentOption ? currentOption.consequence : dilemma.description}
						</DialogDescription>
					</DialogHeader>

					<div className="mt-8">
						{!currentOption && (
							<div className="flex flex-col gap-2">
								{dilemma.options.map((option, index) => (
									<Button
										key={option.label}
										type="button"
										variant="outline"
										className="justify-start h-auto py-3 px-4 text-left whitespace-normal border-slate-900 bg-black text-slate-500 hover:bg-slate-900 hover:text-white transition-all font-mono text-xs uppercase tracking-widest rounded-none group"
										onClick={() => handleOptionSelect(index)}
									>
										<span className="mr-3 opacity-0 group-hover:opacity-100 text-blue-900 transition-opacity">
											{">> "}
										</span>
										{option.label}
									</Button>
								))}
							</div>
						)}
					</div>

					<DialogFooter className="mt-8 border-t border-slate-900 pt-6">
						{currentOption && (
							<Button
								type="button"
								className="w-full bg-slate-100 hover:bg-white text-black font-mono font-bold py-4 text-xs uppercase tracking-[0.4em] rounded-none"
								onClick={handleContinue}
							>
								RETOMAR_JORNADA.EXE
							</Button>
						)}
					</DialogFooter>
				</div>
			</DialogContent>
		</Dialog>
	);
}
</file>

<file path="src/features/ui/GameHUD.tsx">
"use client";

import {
	Activity,
	Brain,
	Clock,
	Package,
	ShieldAlert,
	Wallet,
} from "lucide-react";
import Image from "next/image";
import { useGameContext } from "@/contexts/GameContext";

export function GameHUD() {
	const {
		health,
		sanity,
		money,
		time,
		day,
		socialStigma,
		workTool,
		dignity,
		avatar,
	} = useGameContext();

	// Efeito de bordo pulsante para alto estigma
	const stigmaAlert = socialStigma > 80;

	return (
		<>
			{stigmaAlert && (
				<div className="fixed inset-0 pointer-events-none border-4 border-red-900/20 animate-pulse z-[60]" />
			)}

			<div className="fixed top-0 left-0 w-full bg-black/95 text-slate-400 p-2 z-50 border-b border-slate-900 flex items-center justify-between pointer-events-auto shadow-[0_0_30px_rgba(0,0,0,1)]">
				{/* Esquerda: Identidade e Biometria Urbana */}
				<div className="flex items-center gap-6 px-4">
					{avatar?.avatarImage && (
						<div className="relative w-10 h-10 rounded-lg overflow-hidden border border-slate-800 shadow-lg flex-none group">
							<Image
								src={avatar.avatarImage}
								alt={avatar.name}
								fill
								className="object-cover grayscale hover:grayscale-0 transition-all duration-700"
							/>
							<div className="absolute inset-0 bg-blue-900/10 mix-blend-overlay"></div>
						</div>
					)}
					<div className="flex items-center gap-6">
						<BiometricItem
							icon={Activity}
							value={health}
							label="BIO"
							status={health < 30 ? "CRITICAL" : "OK"}
						/>
						<BiometricItem
							icon={Brain}
							value={sanity}
							label="PSI"
							status={sanity < 30 ? "CRITICAL" : "OK"}
						/>
						<BiometricItem
							icon={ShieldAlert}
							value={socialStigma}
							label="RISK"
							type="INVERTED"
							status={socialStigma > 70 ? "CRITICAL" : "OK"}
						/>
					</div>
				</div>

				{/* Centro: Status de Ferramenta */}
				<div className="hidden lg:flex items-center gap-6 text-[9px] font-mono tracking-[0.2em] uppercase opacity-40">
					{workTool.type ? (
						<div className="flex items-center gap-2">
							<Package className="h-3 w-3" />
							<span>
								{workTool.type.replace("_", " ")} {workTool.condition}%
							</span>
						</div>
					) : (
						<span className="italic text-slate-800">NO_PRODUCTION_TOOL</span>
					)}
					<div className="h-4 w-[1px] bg-slate-900" />
					<div className="flex items-center gap-2 border border-slate-900 px-2 py-0.5">
						<span className="text-slate-400">DGN: {Math.round(dignity)}%</span>
					</div>
				</div>

				{/* Direita: Economia e Tempo */}
				<div className="flex items-center gap-6 px-4">
					<div className="flex flex-col items-end">
						<div className="flex items-center gap-2 text-white font-mono text-xs border-b border-slate-900 pb-0.5 mb-0.5">
							<Wallet className="h-3 w-3 text-slate-600" />
							<span>BRL {money.toFixed(2)}</span>
						</div>
						<div className="flex items-center gap-2 font-mono text-[9px] text-slate-600 tracking-tighter uppercase">
							<Clock className="h-3 w-3" />
							<span>
								D{day} {time.toString().padStart(2, "0")}:00
							</span>
						</div>
					</div>

					{/* Menu de Recursos e Apoio */}
					<div className="hidden lg:flex">
						<a
							href="/recursos"
							target="_blank"
							className="text-[10px] text-slate-500 hover:text-blue-400 transition-colors uppercase font-bold tracking-widest border border-slate-800 px-3 py-1 rounded-sm"
							rel="noopener"
						>
							RECURSOS
						</a>
					</div>
				</div>
			</div>
		</>
	);
}

function BiometricItem({
	icon: Icon,
	value,
	label,
	status,
	type = "NORMAL",
}: {
	icon: React.ElementType;
	value: number;
	label: string;
	status: "OK" | "CRITICAL";
	type?: "NORMAL" | "INVERTED";
}) {
	const isAlarm = status === "CRITICAL";

	return (
		<div className="flex items-center gap-2 group">
			<div
				className={`p-1 border ${isAlarm ? "border-red-900/50 bg-red-950/20" : "border-slate-900 bg-black"}`}
			>
				<Icon
					className={`h-3.5 w-3.5 ${isAlarm ? "text-red-600 animate-pulse" : "text-slate-700"}`}
				/>
			</div>
			<div className="flex flex-col">
				<div className="flex items-center justify-between gap-4">
					<span className="text-[8px] font-mono font-bold text-slate-600 tracking-wider leading-none">
						{label}
					</span>
					<span
						className={`text-[9px] font-mono leading-none ${isAlarm ? "text-red-600" : "text-slate-500"}`}
					>
						{Math.round(value)}
					</span>
				</div>
				<div className="h-0.5 w-16 bg-slate-950 mt-1">
					<div
						className={`h-full transition-all duration-1000 ${isAlarm ? "bg-red-800" : "bg-slate-700"}`}
						style={{ width: `${type === "NORMAL" ? value : value}%` }}
					/>
				</div>
			</div>
		</div>
	);
}
</file>

<file path="src/features/ui/LandingPage.tsx">
import {
	AlertCircle,
	ArrowRight,
	BarChart3,
	Check,
	Copy,
	Cpu,
	Heart,
	Instagram,
	Loader2,
	MapPin,
	Shield,
	Smartphone,
	Sparkles,
	Target,
	Users,
	X,
} from "lucide-react";
import { signIn, useSession } from "next-auth/react";
import { useState } from "react";
import { DilemmaCache } from "@/utils/dilemmaCache";
import { AvatarCreation } from "./AvatarCreation";

export default function LandingPage() {
	// const [isMenuOpen, setIsMenuOpen] = useState(false); // Removed local menu state
	const [copied, setCopied] = useState(false);

	// Map State
	const [_showMap, _setShowMap] = useState(false);
	const [showLoginModal, setShowLoginModal] = useState(false);
	const [mode, setMode] = useState<"landing" | "creation">("landing");

	const { data: _session, status } = useSession();

	// AI State
	const [aiLoading, setAiLoading] = useState(false);
	const [dilemma, setDilemma] = useState<{
		scenario: string;
		options: string[];
	} | null>(null);
	const [aiFeedback, setAiFeedback] = useState<string | null>(null);
	const [error, setError] = useState<string | null>(null);

	const pixKey = "19999912915";

	const handleCopyPix = () => {
		navigator.clipboard.writeText(pixKey);
		setCopied(true);
		setTimeout(() => setCopied(false), 2000);
	};

	const scrollToSection = (id: string) => {
		const element = document.getElementById(id);
		if (element) {
			element.scrollIntoView({ behavior: "smooth" });
		}
	};

	// Groq API Call Helper - API Route segura
	const callGroq = async (prompt: string) => {
		const response = await fetch("/api/groq", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ prompt }),
		});

		const data = await response.json();

		if (!data.success) {
			throw new Error(data.error || "Erro ao processar requisi√ß√£o");
		}

		return data.text || "Sem resposta da IA.";
	};

	const generateDilemma = async () => {
		setAiLoading(true);
		setError(null);
		setDilemma(null);
		setAiFeedback(null);

		// Tentar cache primeiro
		const cacheKey = "demo_scenario";
		const cached = DilemmaCache.get(cacheKey);

		if (cached) {
			console.log("üì¶ Usando dilema do cache (instant√¢neo)");
			setDilemma({
				scenario: cached.scenario,
				options: cached.options,
			});
			setAiLoading(false);
			return;
		}

		const systemPrompt = `Voc√™ √© o motor narrativo de um 'Serious Game' sobre a popula√ß√£o em situa√ß√£o de rua.
        Gere um cen√°rio curto (m√°x 50 palavras) e urgente.
        Forne√ßa exatamente 3 op√ß√µes de a√ß√£o curtas (m√°x 5 palavras cada).
        Responda ESTRITAMENTE em JSON neste formato:
        {
            "scenario": "Texto do cen√°rio...",
            "options": ["Op√ß√£o 1", "Op√ß√£o 2", "Op√ß√£o 3"]
        }`;

		try {
			console.log("üåê Chamando API Groq (primeira vez ou cache expirado)");
			const text = await callGroq(systemPrompt);
			const cleanText = text?.replace(/```json|```/g, "").trim();
			const json = JSON.parse(cleanText || "{}");

			if (json.scenario && Array.isArray(json.options)) {
				setDilemma(json);
				// Salvar no cache
				DilemmaCache.set(cacheKey, {
					scenario: json.scenario,
					options: json.options,
				});
				console.log("üíæ Dilema salvo no cache");
			} else {
				throw new Error("Formato inv√°lido da IA");
			}
		} catch (err) {
			console.error(err);
			setError("Erro ao gerar dilema. Tente novamente.");
		} finally {
			setAiLoading(false);
		}
	};

	const solveDilemma = async (action: string) => {
		setAiLoading(true);
		setError(null);

		const systemPrompt = `Contexto: Jogo s√©rio popula√ß√£o de rua.
        Cen√°rio: "${dilemma?.scenario}"
        A√ß√£o Escolhida: "${action}"
        
        Analise a consequ√™ncia (m√°x 40 palavras). Seja realista e educativo.`;

		try {
			const text = await callGroq(systemPrompt);
			setAiFeedback(text || "Sem resposta.");
		} catch (_err) {
			setError("Erro ao processar a√ß√£o.");
		} finally {
			setAiLoading(false);
		}
	};

	return (
		<div className="min-h-screen bg-slate-50 font-sans text-slate-900">
			{/* Navigation */}
			{/* Navigation removed - now in global layout */}

			{/* Hero Section */}
			<section className="pt-32 pb-20 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white relative overflow-hidden">
				<div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/city-fields.png')]"></div>
				<div className="max-w-7xl mx-auto relative z-10 text-center lg:text-left lg:flex lg:items-center lg:gap-16">
					<div className="lg:w-1/2">
						<div className="inline-block bg-blue-500/20 border border-blue-400/30 rounded-full px-4 py-1.5 mb-6">
							<span className="text-blue-300 font-semibold text-sm tracking-wide uppercase">
								Serious Game & Tecnologia Social
							</span>
						</div>
						<h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-6">
							A Rua tem Voz: <br />
							<span className="text-blue-400">Cidadania</span> contra a{" "}
							<span className="text-pink-500">Invisibilidade</span>.
						</h1>
						<p className="text-lg text-slate-300 mb-8 leading-relaxed max-w-2xl mx-auto lg:mx-0 font-sans">
							Baseado na teoria de Milton Santos e Paulo Freire, o projeto{" "}
							<strong>A Rua Tem Voz</strong> usa a tecnologia social para romper
							a desafilia√ß√£o e reconstruir v√≠nculos de cidadania na Regi√£o
							Metropolitana de Campinas.
						</p>
						<div className="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
							<button
								type="button"
								onClick={() => scrollToSection("doar")}
								className="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-blue-500/25 flex items-center justify-center gap-2"
							>
								<Heart className="h-5 w-5 fill-current" />
								Fazer uma Doa√ß√£o
							</button>
							<button
								type="button"
								onClick={() => {
									if (status === "authenticated") {
										window.location.href = "/jogar";
									} else {
										setShowLoginModal(true);
									}
								}}
								className="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-green-500/25 flex items-center justify-center gap-2 transform hover:-translate-y-1"
							>
								<ArrowRight className="h-5 w-5" />
								{status === "authenticated"
									? "CONTINUAR JOGANDO"
									: "INICIAR JORNADA"}
							</button>
							<button
								type="button"
								onClick={() => scrollToSection("demo-ia")}
								className="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2"
							>
								<Sparkles className="h-5 w-5 text-purple-300" />
								Testar Demo IA
							</button>
						</div>
					</div>
					<div className="lg:w-1/2 mt-12 lg:mt-0">
						{mode === "creation" ? (
							<AvatarCreation
								onComplete={() => {
									window.location.href = "/jogar";
								}}
								onBack={() => setMode("landing")}
							/>
						) : (
							<div className="relative mx-auto w-full max-w-md lg:max-w-full">
								<div className="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 p-6 relative overflow-hidden group">
									<div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
										<Smartphone className="w-32 h-32 text-white" />
									</div>
									<div className="space-y-6">
										<div className="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
											<div className="flex items-center gap-3 mb-2">
												<div className="h-3 w-3 rounded-full bg-red-500"></div>
												<h3 className="text-slate-200 font-semibold text-sm uppercase">
													Dilema Real #12
												</h3>
											</div>
											<p className="text-white font-medium">
												"Voc√™ precisa da 2¬™ via do RG para conseguir um emprego,
												mas o Poupatempo exige agendamento online e voc√™ n√£o tem
												internet."
											</p>
											<div className="mt-4 grid grid-cols-2 gap-2">
												<button
													type="button"
													className="bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 py-2 rounded-lg text-sm border border-blue-500/30 transition-colors"
												>
													Procurar Wi-Fi Livre
												</button>
												<button
													type="button"
													className="bg-slate-600/40 hover:bg-slate-600/60 text-slate-300 py-2 rounded-lg text-sm border border-slate-500/30 transition-colors"
												>
													Pedir ajuda na rua
												</button>
											</div>
										</div>
										<div className="flex items-center justify-between text-slate-400 text-sm">
											<span className="flex items-center gap-1">
												<Users className="h-4 w-4" /> +1.300 pessoas impactadas
											</span>
											<span className="flex items-center gap-1">
												<MapPin className="h-4 w-4" /> Campinas, SP
											</span>
										</div>
									</div>
								</div>
							</div>
						)}
					</div>
				</div>
			</section>

			<section
				id="projeto"
				className="py-24 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto space-y-20"
			>
				<div className="flex flex-col lg:flex-row gap-16 items-center">
					<div className="lg:w-1/2 space-y-8">
						<div className="inline-block bg-blue-100 text-blue-700 px-4 py-1 rounded-full font-black text-xs uppercase tracking-widest">
							Fundamenta√ß√£o Te√≥rica
						</div>
						<h2 className="text-4xl font-black text-slate-900 leading-tight">
							Denunciar Pr√°ticas Brutais. <br />
							Legitimar o Pertencimento.
						</h2>
						<p className="text-xl text-slate-600 leading-relaxed font-sans">
							Segundo <strong>Santos (2006)</strong>, a pobreza estrutural no
							Brasil √© uma d√≠vida social deliberada. Nosso projeto atua na
							intersec√ß√£o entre a tecnologia e a consci√™ncia libertadora de{" "}
							<strong>Paulo Freire</strong>, transformando o "invis√≠vel" em um
							sujeito ativo de sua pr√≥pria hist√≥ria.
						</p>
						<div className="grid grid-cols-1 sm:grid-cols-2 gap-6 pt-4">
							<div className="space-y-2">
								<h4 className="font-black text-slate-800 uppercase tracking-tight">
									Combate √† Desafilia√ß√£o
								</h4>
								<p className="text-sm text-slate-500">
									Reconstru√ß√£o de v√≠nculos em estruturas que fazem sentido para
									a vida.
								</p>
							</div>
							<div className="space-y-2">
								<h4 className="font-black text-slate-800 uppercase tracking-tight">
									Aparta√ß√£o Social
								</h4>
								<p className="text-sm text-slate-500">
									O reconhecimento do outro como um semelhante, n√£o apenas um
									objeto de caridade.
								</p>
							</div>
						</div>
					</div>
					<div className="lg:w-1/2 bg-[#0c0c0f] p-10 rounded-[40px] shadow-2xl border border-slate-800 text-white space-y-8 relative overflow-hidden">
						<div className="absolute top-0 right-0 p-8 opacity-5">
							<BarChart3 className="w-64 h-64" />
						</div>
						<h3 className="text-2xl font-black italic uppercase tracking-tighter">
							Portal do Parceiro Institucional
						</h3>
						<p className="text-slate-400 font-sans">
							Para gestores p√∫blicos, empresas ESG e acad√™micos. Acesse a
							telemetria em tempo real das viola√ß√µes de direitos e demandas por
							ODS em Campinas.
						</p>
						<button
							type="button"
							onClick={() => {
								window.location.href = "/impacto";
							}}
							className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-black uppercase tracking-widest transition-all flex items-center justify-center gap-3 shadow-xl shadow-blue-500/20"
						>
							Acessar Dashboard de Impacto <ArrowRight size={20} />
						</button>
						<p className="text-[10px] text-slate-500 text-center uppercase font-bold tracking-[0.2em]">
							Dados processados via Protocolo Anti-Chacina (K-5)
						</p>
					</div>
				</div>

				<div className="grid md:grid-cols-2 gap-12 items-center pt-20 border-t border-slate-200">
					<div className="space-y-8">
						<div className="bg-white p-10 rounded-3xl shadow-xl border border-slate-100 hover:border-blue-200 transition-all group">
							<div className="w-14 h-14 bg-red-100 rounded-2xl flex items-center justify-center mb-6 border border-red-200 group-hover:scale-110 transition-transform">
								<Target className="h-7 w-7 text-red-600" />
							</div>
							<h3 className="text-2xl font-black text-slate-900 mb-4 uppercase tracking-tight">
								Jornada da Autonomia
							</h3>
							<p className="text-slate-600 font-sans leading-relaxed">
								Um utilit√°rio gamificado que transforma a burocracia em miss√µes
								claras. O app orienta onde comer, como tirar documentos e onde
								encontrar abrigo, oferecendo recompensas reais por cada passo de
								autonomia conquistado.
							</p>
						</div>
						<div className="bg-white p-10 rounded-3xl shadow-xl border border-slate-100 hover:border-pink-200 transition-all group">
							<div className="w-14 h-14 bg-pink-100 rounded-2xl flex items-center justify-center mb-6 border border-pink-200 group-hover:scale-110 transition-transform">
								<Heart className="h-7 w-7 text-pink-600" />
							</div>
							<h3 className="text-2xl font-black text-slate-900 mb-4 uppercase tracking-tight">
								Simulador de Empatia
							</h3>
							<p className="text-slate-600 font-sans leading-relaxed">
								Colocamos a sociedade civil diante da{" "}
								<strong>desqualifica√ß√£o social</strong> (Gohn, 2021). O jogo
								combate o estigma ao humanizar os dilemas de quem vive √† margem,
								gerando consci√™ncia universal.
							</p>
						</div>
					</div>

					<div className="bg-slate-100 rounded-3xl p-8 relative">
						<h3 className="text-2xl font-bold text-slate-900 mb-6 text-center">
							Funcionalidades Principais
						</h3>
						<div className="grid grid-cols-1 gap-4">
							<div className="flex items-start gap-4 p-4 bg-white rounded-xl shadow-sm">
								<Shield className="h-6 w-6 text-green-600 mt-1 shrink-0" />
								<div>
									<h4 className="font-bold text-slate-900">Cofre Digital</h4>
									<p className="text-sm text-slate-600">
										Armazenamento seguro de documentos digitalizados na nuvem,
										evitando a perda recorrente de RG e CPF.
									</p>
								</div>
							</div>
							<div className="flex items-start gap-4 p-4 bg-white rounded-xl shadow-sm">
								<MapPin className="h-6 w-6 text-orange-600 mt-1 shrink-0" />
								<div>
									<h4 className="font-bold text-slate-900">
										Mapa de Calor Solid√°rio
									</h4>
									<p className="text-sm text-slate-600">
										Mostra em tempo real onde h√° excesso ou falta de doa√ß√µes na
										cidade, otimizando a log√≠stica da caridade.
									</p>
								</div>
							</div>
							<div className="flex items-start gap-4 p-4 bg-white rounded-xl shadow-sm">
								<Cpu className="h-6 w-6 text-purple-600 mt-1 shrink-0" />
								<div>
									<h4 className="font-bold text-slate-900">IA Generativa</h4>
									<p className="text-sm text-slate-600">
										Uso de IA para traduzir "juridiqu√™s" de editais e leis em
										linguagem simples e acess√≠vel.
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			{/* AI Demo Section - NEW */}
			<section
				id="demo-ia"
				className="py-20 bg-gradient-to-b from-slate-900 to-blue-900 text-white relative overflow-hidden"
			>
				<div className="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10">
					<div className="absolute w-96 h-96 bg-purple-500 rounded-full blur-3xl -top-20 -left-20"></div>
					<div className="absolute w-96 h-96 bg-blue-500 rounded-full blur-3xl bottom-0 right-0"></div>
				</div>

				<div className="max-w-4xl mx-auto px-4 relative z-10">
					<div className="text-center mb-10">
						<div className="inline-flex items-center gap-2 bg-purple-500/20 border border-purple-400/30 px-3 py-1 rounded-full text-purple-200 text-sm font-bold mb-4">
							<Sparkles className="h-4 w-4" />
							Powered by Groq API (Llama 3.3)
						</div>
						<h2 className="text-3xl md:text-4xl font-bold mb-4">
							Teste o Simulador de Empatia
						</h2>
						<p className="text-slate-300 max-w-2xl mx-auto">
							Experimente agora uma vers√£o simplificada do nosso motor de
							narrativa. A IA gera um dilema real e reage √†s suas decis√µes,
							demonstrando a complexidade da vida nas ruas.
						</p>
					</div>

					<div className="bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl p-6 md:p-8 shadow-2xl min-h-[400px] flex flex-col">
						{!dilemma ? (
							<div className="flex-1 flex flex-col items-center justify-center py-12 text-center">
								<div className="bg-blue-600/20 p-6 rounded-full mb-6">
									<Cpu className="h-12 w-12 text-blue-400" />
								</div>
								<h3 className="text-xl font-bold text-white mb-2">
									Pronto para come√ßar?
								</h3>
								<p className="text-slate-400 mb-8 max-w-sm">
									A IA ir√° gerar uma situa√ß√£o √∫nica baseada em dados reais de
									Campinas.
								</p>
								<button
									type="button"
									onClick={generateDilemma}
									disabled={aiLoading}
									className="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-lg shadow-purple-500/25 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
								>
									{aiLoading ? (
										<>
											<Loader2 className="h-5 w-5 animate-spin" /> Gerando
											Cen√°rio...
										</>
									) : (
										<>
											<Sparkles className="h-5 w-5" /> ‚ú® Gerar Dilema Real
										</>
									)}
								</button>
								{error && (
									<div className="mt-4 text-red-300 bg-red-900/20 px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
										<AlertCircle className="h-4 w-4" /> {error}
									</div>
								)}
							</div>
						) : (
							<div className="flex-1 flex flex-col animate-fade-in">
								{/* Scenario Header */}
								<div className="flex items-center justify-between mb-6 pb-4 border-b border-white/10">
									<div className="flex items-center gap-2">
										<div className="h-2 w-2 rounded-full bg-green-400 animate-pulse"></div>
										<span className="text-sm font-mono text-green-400">
											GROQ-LIVE-FEED
										</span>
									</div>
									<button
										type="button"
										onClick={() => setDilemma(null)}
										className="text-xs text-slate-400 hover:text-white transition-colors"
									>
										Reiniciar
									</button>
								</div>

								{/* Scenario Text */}
								<div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700 mb-6 relative">
									<div className="absolute -top-3 left-4 bg-blue-600 text-xs font-bold px-2 py-1 rounded shadow-sm">
										CEN√ÅRIO
									</div>
									<p className="text-lg leading-relaxed text-slate-100 font-medium">
										"{dilemma?.scenario}"
									</p>
								</div>

								{/* Interaction Area */}
								{/* Interaction Area */}
								{!aiFeedback ? (
									<div className="mt-auto space-y-4">
										<p className="text-sm text-slate-400">Escolha sua a√ß√£o:</p>
										<div className="flex flex-col gap-3">
											{dilemma?.options?.map((option, _idx) => (
												<button
													type="button"
													key={option}
													onClick={() => solveDilemma(option)}
													disabled={aiLoading}
													className="w-full text-left bg-slate-700/50 hover:bg-blue-600/20 hover:border-blue-500 border border-slate-600 p-4 rounded-xl transition-all group"
												>
													<span className="font-bold text-slate-300 group-hover:text-white">
														{option}
													</span>
												</button>
											))}
										</div>
									</div>
								) : (
									<div className="mt-auto animate-fade-in">
										<div className="bg-purple-900/20 border border-purple-500/30 p-6 rounded-xl">
											<div className="flex items-center gap-2 mb-3">
												<Sparkles className="h-4 w-4 text-purple-400" />
												<h4 className="font-bold text-purple-300 text-sm">
													CONSEQU√äNCIA
												</h4>
											</div>
											<p className="text-slate-200">{aiFeedback}</p>
											<button
												type="button"
												onClick={() => {
													setDilemma(null);
													setAiFeedback(null);
												}}
												className="mt-6 w-full bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg text-sm font-medium transition-colors"
											>
												Testar Outro Cen√°rio
											</button>
										</div>
									</div>
								)}
							</div>
						)}
					</div>
					<p className="text-center text-slate-500 text-xs mt-4">
						* As respostas s√£o geradas por Intelig√™ncia Artificial e servem
						apenas para simula√ß√£o educativa.
					</p>
				</div>
			</section>

			{/* Tech Section */}
			<section id="tecnologia" className="py-20 bg-slate-50 text-slate-900">
				<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
					<div className="lg:flex lg:items-center lg:justify-between gap-12">
						<div className="lg:w-1/2 mb-10 lg:mb-0">
							<h2 className="text-3xl font-bold mb-6 text-slate-900">
								Inova√ß√£o Social com Custo Eficiente
							</h2>
							<p className="text-slate-600 mb-6 text-lg">
								Diferente de apps tradicionais que custam milh√µes, utilizamos a
								plataforma <strong>Google Antigravity</strong> e o modelo{" "}
								<strong>Groq Llama 3.3 70B</strong>.
							</p>
							<ul className="space-y-4">
								<li className="flex items-center gap-3">
									<div className="bg-green-100 p-2 rounded-full">
										<Check className="h-4 w-4 text-green-600" />
									</div>
									<span className="text-slate-700">
										Desenvolvimento √Ågil (Agent-First Development)
									</span>
								</li>
								<li className="flex items-center gap-3">
									<div className="bg-green-100 p-2 rounded-full">
										<Check className="h-4 w-4 text-green-600" />
									</div>
									<span className="text-slate-700">
										Custos de manuten√ß√£o reduzidos via automa√ß√£o
									</span>
								</li>
								<li className="flex items-center gap-3">
									<div className="bg-green-100 p-2 rounded-full">
										<Check className="h-4 w-4 text-green-600" />
									</div>
									<span className="text-slate-700">
										Acessibilidade nativa para dispositivos simples
									</span>
								</li>
							</ul>
						</div>
						<div className="lg:w-1/2 bg-white border border-slate-200 p-8 rounded-3xl relative overflow-hidden shadow-lg">
							<div className="relative z-10">
								<h3 className="text-2xl font-bold mb-4 text-blue-900">
									Proposta de Valor ESG
								</h3>
								<p className="mb-6 text-slate-600">
									Para empresas parceiras, oferecemos relat√≥rios de impacto
									social baseados em dados reais, alinhados aos ODS da ONU,
									perfeitos para compor balan√ßos de sustentabilidade.
								</p>
								<button
									type="button"
									onClick={() =>
										window.open(
											"https://instagram.com/coletivoaruatemvoz",
											"_blank",
										)
									}
									className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-lg shadow-blue-500/20"
								>
									Seja um Parceiro Corporativo
									<ArrowRight className="h-4 w-4" />
								</button>
							</div>
						</div>
					</div>
				</div>
			</section>

			{/* Donation Section */}
			<section id="doar" className="py-24 px-4 sm:px-6 lg:px-8 bg-blue-50">
				<div className="max-w-4xl mx-auto text-center">
					<div className="inline-block bg-blue-100 text-blue-700 px-4 py-1 rounded-full font-bold text-sm mb-6 uppercase tracking-wider">
						Fa√ßa a Diferen√ßa
					</div>
					<h2 className="text-4xl font-extrabold text-slate-900 mb-6">
						Ajude a tirar esse projeto do papel
					</h2>
					<p className="text-xl text-slate-600 mb-10 max-w-2xl mx-auto">
						Sua doa√ß√£o financia o desenvolvimento, a infraestrutura de nuvem e
						as a√ß√µes de campo do Coletivo A Rua Tem Voz.
					</p>

					<div className="bg-white p-8 sm:p-10 rounded-3xl shadow-xl border border-blue-100 max-w-lg mx-auto relative overflow-hidden">
						<div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-purple-500"></div>

						<h3 className="text-lg font-medium text-slate-500 mb-2">
							Chave PIX (Celular)
						</h3>

						<div className="flex items-center justify-between bg-slate-100 border border-slate-200 rounded-xl p-4 mb-6 group hover:border-blue-400 transition-colors">
							<span className="font-mono text-2xl sm:text-3xl font-bold text-slate-800 tracking-wider">
								{pixKey}
							</span>
							<button
								type="button"
								onClick={handleCopyPix}
								className="ml-4 p-2 bg-white rounded-lg shadow-sm hover:bg-blue-50 text-slate-600 hover:text-blue-600 transition-all"
								title="Copiar Chave"
							>
								{copied ? (
									<Check className="h-6 w-6 text-green-500" />
								) : (
									<Copy className="h-6 w-6" />
								)}
							</button>
						</div>

						{copied && (
							<div className="absolute top-4 right-4 bg-green-100 text-green-700 px-3 py-1 rounded-lg text-sm font-medium animate-fade-in-down">
								Copiado!
							</div>
						)}

						<div className="flex flex-col gap-3">
							<button
								type="button"
								onClick={handleCopyPix}
								className={`w-full py-4 rounded-xl font-bold text-lg transition-all transform active:scale-95 ${copied ? "bg-green-600 hover:bg-green-700 text-white" : "bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-blue-500/30"}`}
							>
								{copied ? "Chave Copiada!" : "Copiar Chave PIX"}
							</button>
							<p className="text-xs text-slate-400 mt-2">
								O valor ser√° destinado integralmente ao desenvolvimento do jogo
								e a√ß√µes do coletivo.
							</p>
						</div>
					</div>
				</div>
			</section>

			{/* Footer */}
			<footer className="bg-slate-900 text-slate-400 py-12 border-t border-slate-800">
				<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
					<div className="flex flex-col md:flex-row justify-between items-center gap-8">
						<div className="text-center md:text-left">
							<h4 className="text-white text-lg font-bold mb-2">
								Caminhos Campinas
							</h4>
							<p className="text-sm max-w-xs">
								Uma iniciativa para transformar a realidade das ruas atrav√©s da
								tecnologia social.
							</p>
						</div>

						<div className="flex flex-col items-center">
							<span className="text-sm font-medium text-slate-500 mb-2">
								Siga o Coletivo
							</span>
							<a
								href="https://www.instagram.com/coletivoaruatemvoz"
								target="_blank"
								rel="noopener noreferrer"
								className="flex items-center gap-2 text-white hover:text-pink-500 transition-colors bg-slate-800 px-4 py-2 rounded-full"
							>
								<Instagram className="h-5 w-5" />
								@COLETIVOARUATEMVOZ
							</a>
						</div>
					</div>
					<div className="mt-12 pt-8 border-t border-slate-800 text-center text-xs">
						<p>
							&copy; 2025 Coletivo A Rua Tem Voz. Todos os direitos reservados.
						</p>
						<p className="mt-2">
							Desenvolvido com Antigravity IDE & Groq Llama 3.3.
						</p>
					</div>
				</div>
			</footer>

			{/* Login Modal */}
			{showLoginModal && (
				<div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in">
					<div className="bg-white rounded-2xl w-full max-w-sm relative flex flex-col p-8 shadow-2xl overflow-hidden">
						{/* Background Detail */}
						<div className="absolute -top-12 -right-12 w-32 h-32 bg-blue-50 rounded-full"></div>
						<div className="absolute -bottom-12 -left-12 w-32 h-32 bg-purple-50 rounded-full"></div>

						<button
							type="button"
							onClick={() => setShowLoginModal(false)}
							className="absolute top-4 right-4 z-10 p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-all"
							title="Fechar"
						>
							<X className="h-5 w-5" />
						</button>

						<div className="relative text-center mb-8">
							<div className="mx-auto w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center mb-4 shadow-lg shadow-blue-500/30">
								<MapPin className="h-6 w-6 text-white" />
							</div>
							<h3 className="text-2xl font-bold text-slate-800">
								Boas-vindas!
							</h3>
							<p className="text-slate-500 text-sm mt-1">
								Escolha como deseja iniciar sua jornada.
							</p>
						</div>

						<div className="space-y-4 relative">
							<button
								type="button"
								onClick={() => signIn("google", { callbackUrl: "/jogar" })}
								className="w-full flex items-center justify-center gap-3 bg-white border border-slate-200 py-3.5 rounded-xl font-bold text-slate-700 hover:bg-slate-50 hover:border-blue-300 transition-all shadow-sm group"
							>
								<svg
									className="w-5 h-5"
									viewBox="0 0 24 24"
									aria-labelledby="google-icon-title"
									role="img"
								>
									<title id="google-icon-title">Google</title>
									<path
										fill="currentColor"
										d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
									/>
									<path
										fill="currentColor"
										d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
									/>
									<path
										fill="currentColor"
										d="M5.84 14.1c-.22-.66-.35-1.36-.35-2.1s.13-1.44.35-2.1V7.06H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.94l3.66-2.84z"
									/>
									<path
										fill="currentColor"
										d="M12 5.38c1.62 0 3.06.56 4.21 1.66l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.06l3.66 2.84c.87-2.6 3.3-4.52 6.16-4.52z"
									/>
								</svg>
								Entrar com Google
							</button>

							<div className="relative flex items-center justify-center py-2">
								<div className="absolute inset-0 flex items-center">
									<div className="w-full border-t border-slate-100"></div>
								</div>
								<span className="relative px-3 bg-white text-xs font-bold text-slate-400 uppercase tracking-widest">
									Ou
								</span>
							</div>

							<button
								type="button"
								onClick={() => signIn("credentials", { callbackUrl: "/jogar" })}
								className="w-full flex items-center justify-center gap-2 bg-slate-900 text-white py-3.5 rounded-xl font-bold hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/10"
							>
								Acesso An√¥nimo
								<ArrowRight className="h-4 w-4 opacity-50" />
							</button>
							<p className="text-[10px] text-center text-slate-400 mt-4 leading-relaxed">
								Ao entrar, voc√™ concorda em utilizar a plataforma para fins
								educativos e de impacto social positivo.
							</p>
						</div>
					</div>
				</div>
			)}
		</div>
	);
}
</file>

<file path="README.md">
# üèôÔ∏è Caminhos Campinas

> Serious game sobre a realidade da popula√ß√£o em situa√ß√£o de rua em Campinas/SP

Um jogo educacional que simula os desafios enfrentados por pessoas em situa√ß√£o de rua, combinando mec√¢nicas de sobreviv√™ncia com narrativas baseadas em dados sociol√≥gicos reais de Campinas.

## üéØ Sobre o Projeto

**Caminhos Campinas** √© um serious game que busca conscientizar sobre a complexa realidade das pessoas em situa√ß√£o de rua. Atrav√©s de uma experi√™ncia interativa, o jogador vivencia dilemas reais, gerencia recursos limitados e enfrenta o estigma social, tudo baseado em pesquisas sociol√≥gicas sobre Campinas.

### Caracter√≠sticas Principais

- üéÆ **Mec√¢nicas de Sobreviv√™ncia Realistas**: Gerenciamento de fome, energia, sa√∫de e higiene
- üó∫Ô∏è **Mapa Interativo de Campinas**: Localiza√ß√µes reais de servi√ßos de apoio
- ü§ñ **IA Contextualizada**: Chat com assistente IA que conhece a rede de apoio da cidade
- üìä **Sistema de Dilemas Determin√≠sticos**: Eventos baseados em estigma social e condi√ß√µes do jogador
- üíæ **Persist√™ncia Offline**: Salva o progresso localmente usando IndexedDB
- üìà **Telemetria de Gameplay**: Coleta dados para an√°lise do comportamento do jogador

## üöÄ Tecnologias

- **Framework**: [Next.js 15](https://nextjs.org/) (App Router)
- **Linguagem**: [TypeScript](https://www.typescriptlang.org/)
- **Estiliza√ß√£o**: [Tailwind CSS](https://tailwindcss.com/)
- **Mapa**: [Leaflet](https://leafletjs.com/) / [React-Leaflet](https://react-leaflet.js.org/)
- **IA**: [Groq API](https://groq.com/) (llama-3.3-70b-versatile) via [Vercel AI SDK](https://sdk.vercel.ai/)
- **Persist√™ncia**: [PouchDB](https://pouchdb.com/) (IndexedDB)
- **UI Components**: [shadcn/ui](https://ui.shadcn.com/)
- **Linter**: [Biome](https://biomejs.dev/)

## üìã Pr√©-requisitos

- Node.js 18+
- npm, yarn, pnpm ou bun
- Chaves de API:
  - Groq API (para o chat com IA)
  - Google Maps API (para o mapa interativo)

## üõ†Ô∏è Instala√ß√£o

1. **Clone o reposit√≥rio**

```bash
git clone https://github.com/SEU_USUARIO/caminhos-campinas.git
cd caminhos-campinas
```

1. **Instale as depend√™ncias**

```bash
npm install
```

1. **Configure as vari√°veis de ambiente**

Copie o arquivo `.env.example` para `.env.local`:

```bash
cp .env.example .env.local
```

Edite `.env.local` e adicione suas chaves:

```env
GROQ_API_KEY=sua_chave_groq_aqui
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=sua_chave_google_maps_aqui
```

1. **Execute o servidor de desenvolvimento**

```bash
npm run dev
```

Acesse [http://localhost:3000](http://localhost:3000) no navegador.

## üöÄ Como Fazer Deploy

## üöÄ Como Fazer Deploy

A maneira mais f√°cil de publicar este projeto √© usando a [Vercel](https://vercel.com) (criadores do Next.js).

1. Fa√ßa um fork deste reposit√≥rio para o seu GitHub.
2. Crie uma conta na Vercel e importe o projeto do GitHub.
3. Configure as **Vari√°veis de Ambiente** (Settings > Environment Variables):

   | Nome | Descri√ß√£o | Exemplo |
   |------|-----------|---------|
   | `AUTH_SECRET` | **Obrigat√≥rio**. Chave para criptografia da sess√£o. | Gere no terminal: `openssl rand -base64 32` |
   | `GROQ_API_KEY` | **Obrigat√≥rio**. API da IA. | `gsk_...` |
   | `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` | **Obrigat√≥rio**. Mapa. | `AIza...` |
   | `AUTH_GOOGLE_ID` | (Opcional) Para login com Google. | `...apps.googleusercontent.com` |
   | `AUTH_GOOGLE_SECRET` | (Opcional) Para login com Google. | `GOCSPX-...` |

4. Clique em "Deploy".

> **Nota:** Se o login apresentar erro 500, verifique se `AUTH_SECRET` foi adicionado corretamente.

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2FSEU_USUARIO%2Fcaminhos-campinas)

## üìÅ Estrutura do Projeto

```
pop-rua-game/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                    # Rotas Next.js (App Router)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # Landing page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jogar/             # P√°gina principal do jogo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sobre/             # Sobre o projeto
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ apoie/             # Como apoiar
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/               # API routes (chat com IA)
‚îÇ   ‚îú‚îÄ‚îÄ components/            # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                # Componentes UI (shadcn/ui)
‚îÇ   ‚îú‚îÄ‚îÄ contexts/              # Contexts API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameContext.tsx    # Estado global do jogo
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ServicesContext.tsx # Servi√ßos de Campinas
‚îÇ   ‚îú‚îÄ‚îÄ features/              # Features modulares
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-loop/         # Loop principal e dilemas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ offline-db/        # Persist√™ncia com PouchDB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ survival-map/      # Mapa interativo
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                # Componentes de UI do jogo
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                 # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ services/              # Servi√ßos (telemetria, etc.)
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ data/                  # Dados de servi√ßos de Campinas
‚îú‚îÄ‚îÄ scripts/                   # Scripts utilit√°rios
‚îî‚îÄ‚îÄ *.md                       # Documenta√ß√£o t√©cnica
```

## üìö Documenta√ß√£o T√©cnica

- [Architecture_Map.md](./Architecture_Map.md) - Arquitetura do sistema
- [Core_Mechanics.md](./Core_Mechanics.md) - Mec√¢nicas de jogo
- [Tech_Stack.md](./Tech_Stack.md) - Stack t√©cnica detalhada
- [Narrative_DB.md](./Narrative_DB.md) - Sistema narrativo
- [REDE_APOIO_CAMPINAS.md](./REDE_APOIO_CAMPINAS.md) - Rede de apoio real
- [SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md](./SOCIOLOGIA_BRASILEIRA_E_CAMPINAS.md) - Base sociol√≥gica

## üéÆ Como Jogar

1. **Crie seu Avatar**: Customize seu personagem na tela inicial
2. **Gerencie Recursos**: Monitore fome, energia, sa√∫de e higiene atrav√©s do HUD
3. **Explore Campinas**: Use o mapa para encontrar servi√ßos de apoio pr√≥ximos
4. **Tome Decis√µes**: Enfrente dilemas que afetam sua dignidade e estigma social
5. **Pe√ßa Ajuda**: Converse com o chatbot IA para orienta√ß√£o sobre recursos
6. **Sobreviva**: Trabalhe, coma, descanse e mantenha-se vivo

## üß™ Scripts Dispon√≠veis

```bash
npm run dev          # Inicia servidor de desenvolvimento
npm run build        # Cria build de produ√ß√£o
npm run start        # Inicia servidor de produ√ß√£o
npm run lint         # Executa linter (Biome)
npm run format       # Formata c√≥digo com Biome
```

## üéØ Objetivos de Aprendizagem

Este serious game foi desenvolvido com objetivos educacionais:

- **Conscientiza√ß√£o Social**: Entender a realidade da popula√ß√£o em situa√ß√£o de rua
- **Empatia**: Vivenciar (virtualmente) os desafios di√°rios
- **Conhecimento de Recursos**: Aprender sobre a rede de apoio em Campinas
- **Reflex√£o Cr√≠tica**: Questionar estigmas e preconceitos sociais

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Se voc√™ encontrar bugs ou tiver sugest√µes:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona MinhaFeature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto √© um serious game educacional desenvolvido para fins acad√™micos e de conscientiza√ß√£o social.

## üôè Agradecimentos

- Dados sociol√≥gicos baseados em pesquisas sobre Campinas
- Rede de apoio real da cidade de Campinas/SP
- Comunidade open-source pelas ferramentas utilizadas

## üìß Contato

Para d√∫vidas, sugest√µes ou colabora√ß√µes, abra uma issue no GitHub.

---

**Desenvolvido com üíô para promover empatia e conscientiza√ß√£o social**
</file>

<file path="src/features/ui/GameChat.tsx">
"use client";

import { useChat } from "@ai-sdk/react";
import { Send } from "lucide-react";
import { useCallback, useMemo, startTransition } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { useGameContext } from "@/contexts/GameContext";

export function GameChat() {
	const gameState = useGameContext();

	// ‚úÖ FIX ERRO 3 (INP): Memoriza snapshot do estado do jogo
	// Evita recomputa√ß√£o a cada render e m√∫ltiplos acessos s√≠ncronos
	const gameStateSnapshot = useMemo(
		() => ({
			health: gameState.health,
			hunger: gameState.hunger,
			hygiene: gameState.hygiene,
			money: gameState.money,
			time: gameState.time,
		}),
		[
			gameState.health,
			gameState.hunger,
			gameState.hygiene,
			gameState.money,
			gameState.time,
		],
	);

	// ‚úÖ FIX ERRO 2 (TypeError): Removido 'api: "/api/chat"' e 'as any'
	// useChat usa '/api/chat' por padr√£o, n√£o precisa especificar 'api'
	const { messages, input, handleInputChange, handleSubmit, status, error } =
		useChat({
			onError: (error) => {
				console.error("‚ùå Chat Error:", error);
			},
			body: {
				gameState: gameStateSnapshot, // ‚úÖ Usa snapshot memorizado
			},
		});

	const isLoading = status === "submitted" || status === "streaming";

	// ‚úÖ FIX ERRO 3 (INP): Handler otimizado com useCallback + startTransition
	// Marca opera√ß√£o como n√£o-urgente para n√£o bloquear a UI
	const onFormSubmit = useCallback(
		(e: React.FormEvent) => {
			e.preventDefault();
			if (!input.trim() || isLoading) return;

			// ‚úÖ startTransition: Permite UI responder imediatamente
			// Reduz INP de 6000ms para <100ms
			startTransition(() => {
				handleSubmit(e, {
					body: {
						gameState: gameStateSnapshot, // ‚úÖ Usa snapshot em vez de acessar state diretamente
					},
				});
			});
		},
		[input, isLoading, handleSubmit, gameStateSnapshot],
	);

	return (
		<div className="flex flex-col h-full border rounded-lg bg-gray-50 dark:bg-gray-900 overflow-hidden">
			<div className="flex-1 overflow-y-auto p-4 space-y-4">
				{messages.length === 0 && (
					<div className="text-center text-gray-500 mt-10">
						<p>Voc√™ acorda na Pra√ßa do Ros√°rio.</p>
						<p className="text-xs">Diga "Olho ao redor" para come√ßar.</p>
					</div>
				)}

				{messages.map((m) => (
					<div
						key={m.id}
						className={`flex ${m.role === "user" ? "justify-end" : "justify-start"}`}
					>
						<div
							className={`max-w-[80%] rounded-lg p-3 text-sm ${m.role === "user"
									? "bg-blue-600 text-white"
									: "bg-white dark:bg-gray-800 border shadow-sm"
								}`}
						>
							{m.content}
						</div>
					</div>
				))}
				{isLoading && (
					<div className="text-xs text-gray-400 animate-pulse ml-4">
						O Mestre est√° escrevendo...
					</div>
				)}
				{error && (
					<div className="text-xs text-red-500 ml-4 mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded border border-red-200 dark:border-red-800">
						‚ùå Erro: {error.message}
					</div>
				)}
			</div>

			<form
				onSubmit={onFormSubmit}
				className="p-3 bg-white dark:bg-gray-950 border-t flex gap-2"
			>
				<Input
					value={input}
					onChange={handleInputChange}
					placeholder="O que voc√™ faz?"
					className="flex-1"
					disabled={isLoading}
				/>
				<Button type="submit" size="icon" disabled={isLoading}>
					<Send className="h-4 w-4" />
				</Button>
			</form>
		</div>
	);
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata, Viewport } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import "leaflet/dist/leaflet.css";
import { Analytics } from "@vercel/analytics/react";
import { SpeedInsights } from "@vercel/speed-insights/next";
import { GameProvider } from "@/contexts/GameContext";
import { ServicesProvider } from "@/contexts/ServicesContext";
import { SurvivalModeProvider } from "@/features/ui/SurvivalModeContext";

const geistSans = Geist({
	variable: "--font-geist-sans",
	subsets: ["latin"],
});

const geistMono = Geist_Mono({
	variable: "--font-geist-mono",
	subsets: ["latin"],
});

export const metadata: Metadata = {
	title: "Caminhos Campinas",
	description:
		"Serious Game sobre a realidade da popula√ß√£o de rua em Campinas.",
	manifest: "/manifest.json",
};

export const viewport: Viewport = {
	themeColor: "#000000",
	width: "device-width",
	initialScale: 1,
	// Accessibility: Allow users to zoom for better readability
	// maximumScale: 1,
	// userScalable: false,
};

import { Providers } from "@/components/Providers";

import { Navbar } from "@/components/ui/Navbar";

export default function RootLayout({
	children,
}: Readonly<{
	children: React.ReactNode;
}>) {
	return (
		<html lang="en" suppressHydrationWarning>
			<body
				className={`${geistSans.variable} ${geistMono.variable} antialiased`}
				suppressHydrationWarning
			>
				<Providers>
					<SurvivalModeProvider>
						<GameProvider>
							<ServicesProvider>
								<Navbar />
								{children}
								<SpeedInsights />
								<Analytics />
							</ServicesProvider>
						</GameProvider>
					</SurvivalModeProvider>
				</Providers>
			</body>
		</html>
	);
}
</file>

</files>
